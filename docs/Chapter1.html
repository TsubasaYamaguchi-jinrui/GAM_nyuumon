<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>1 Review of multiple linear regressions | Introduction to GAM using R</title>
  <meta name="description" content="1 Review of multiple linear regressions | Introduction to GAM using R" />
  <meta name="generator" content="bookdown 0.31 and GitBook 2.6.7" />

  <meta property="og:title" content="1 Review of multiple linear regressions | Introduction to GAM using R" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="1 Review of multiple linear regressions | Introduction to GAM using R" />
  
  
  

<meta name="author" content="Tsubasa Yamaguchi" />


<meta name="date" content="2023-07-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="Chapter0.html"/>
<link rel="next" href="sessioninfo.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.1/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.27/datatables.js"></script>
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
<link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
<link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
<script src="libs/selectize-0.12.0/selectize.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="custom_style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>本稿の目的</a></li>
<li class="chapter" data-level="" data-path="Chapter0.html"><a href="Chapter0.html"><i class="fa fa-check"></i>0. パッケージの読み込み</a></li>
<li class="chapter" data-level="1" data-path="Chapter1.html"><a href="Chapter1.html"><i class="fa fa-check"></i><b>1</b> Review of multiple linear regressions</a>
<ul>
<li class="chapter" data-level="1.1" data-path="Chapter1.html"><a href="Chapter1.html#light-levels-and-size-of-the-human-visual-system"><i class="fa fa-check"></i><b>1.1</b> Light levels and size of the human visual system</a></li>
<li class="chapter" data-level="1.2" data-path="Chapter1.html"><a href="Chapter1.html#the-variables"><i class="fa fa-check"></i><b>1.2</b> The variables</a></li>
<li class="chapter" data-level="1.3" data-path="Chapter1.html"><a href="Chapter1.html#protocol-for-the-analysis"><i class="fa fa-check"></i><b>1.3</b> Protocol for the analysis</a></li>
<li class="chapter" data-level="1.4" data-path="Chapter1.html"><a href="Chapter1.html#data-exploration"><i class="fa fa-check"></i><b>1.4</b> Data exploration</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="Chapter1.html"><a href="Chapter1.html#欠損値の確認"><i class="fa fa-check"></i><b>1.4.1</b> 欠損値の確認</a></li>
<li class="chapter" data-level="1.4.2" data-path="Chapter1.html"><a href="Chapter1.html#外れ値の確認"><i class="fa fa-check"></i><b>1.4.2</b> 外れ値の確認</a></li>
<li class="chapter" data-level="1.4.3" data-path="Chapter1.html"><a href="Chapter1.html#多重共線性の確認"><i class="fa fa-check"></i><b>1.4.3</b> 多重共線性の確認</a></li>
<li class="chapter" data-level="1.4.4" data-path="Chapter1.html"><a href="Chapter1.html#目的変数と説明変数の関係の確認"><i class="fa fa-check"></i><b>1.4.4</b> 目的変数と説明変数の関係の確認</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="Chapter1.html"><a href="Chapter1.html#multiple-linear-regression"><i class="fa fa-check"></i><b>1.5</b> Multiple linear regression</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="Chapter1.html"><a href="Chapter1.html#underlying-statistical-theory"><i class="fa fa-check"></i><b>1.5.1</b> Underlying statistical theory</a>
<ul>
<li class="chapter" data-level="1.5.1.1" data-path="Chapter1.html"><a href="Chapter1.html#外れ値のチェック"><i class="fa fa-check"></i><b>1.5.1.1</b> 外れ値のチェック</a></li>
<li class="chapter" data-level="1.5.1.2" data-path="Chapter1.html"><a href="Chapter1.html#信頼区間と予測区間の算出"><i class="fa fa-check"></i><b>1.5.1.2</b> 95%信頼区間と予測区間の算出</a></li>
</ul></li>
<li class="chapter" data-level="1.5.2" data-path="Chapter1.html"><a href="Chapter1.html#multiple-linear-regression-1"><i class="fa fa-check"></i><b>1.5.2</b> Multiple linear regression</a></li>
<li class="chapter" data-level="1.5.3" data-path="Chapter1.html"><a href="Chapter1.html#fitting-the-model-in-r-and-estimate-parameters"><i class="fa fa-check"></i><b>1.5.3</b> Fitting the model in R and estimate parameters</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="Chapter1.html"><a href="Chapter1.html#finding-the-optimal-model"><i class="fa fa-check"></i><b>1.6</b> Finding the optimal model</a></li>
<li class="chapter" data-level="1.7" data-path="Chapter1.html"><a href="Chapter1.html#degree-of-freedom"><i class="fa fa-check"></i><b>1.7</b> Degree of freedom</a></li>
<li class="chapter" data-level="1.8" data-path="Chapter1.html"><a href="Chapter1.html#model-validation"><i class="fa fa-check"></i><b>1.8</b> Model validation</a></li>
<li class="chapter" data-level="1.9" data-path="Chapter1.html"><a href="Chapter1.html#model-interpretation"><i class="fa fa-check"></i><b>1.9</b> Model interpretation</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="sessioninfo.html"><a href="sessioninfo.html"><i class="fa fa-check"></i>実行環境</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to GAM using R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="review-of-multiple-linear-regressions" class="section level1 hasAnchor" number="1">
<h1><span class="header-section-number">1</span> Review of multiple linear regressions<a href="Chapter1.html#review-of-multiple-linear-regressions" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>本章では、一般化加法モデル(GAM)の説明に入る前に、多くの人に馴染みのある重回帰分析(multiple linear regression)について説明する、なぜなら、GAMは重回帰分析を拡張したものだからである。</p>
<div id="light-levels-and-size-of-the-human-visual-system" class="section level2 hasAnchor" number="1.1">
<h2><span class="header-section-number">1.1</span> Light levels and size of the human visual system<a href="Chapter1.html#light-levels-and-size-of-the-human-visual-system" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><span class="citation">Pearce &amp; Dunbar (<a href="#ref-Pearce2012">2012</a>)</span> は、ヒトの集団が住んでいる標高と眼窩の容量に正の関連があることから、住んでいる環境の光量がヒトの視覚システムの進化の原動力になっていると結論付けた。本章ではこの論文のデータを用いて重回帰分析について説明を行う。重回帰分析でデータを探索し、モデルを構築し、モデルを当てはめ、モデル選択を行い、モデルの妥当性を確認する方法はGAMでもほとんど同じように適用できる。</p>
</div>
<div id="the-variables" class="section level2 hasAnchor" number="1.2">
<h2><span class="header-section-number">1.2</span> The variables<a href="Chapter1.html#the-variables" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><span class="citation">Pearce &amp; Dunbar (<a href="#ref-Pearce2012">2012</a>)</span> は、オックスフォード大学博物館にある55人の成人の頭蓋骨から、頭蓋の容量(cranial capacity: CC)と眼窩容量(orbital volume)、大後頭孔(foramen magnum: FM)などの測定を行った。</p>
<p>データは以下のとおりである。平均眼窩容量(mean orbital volume)が目的変数であり、それ以外の変数は説明変数である<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>。<code>AbsoluteLatitude</code>と<code>Minimum_Tempreture_celsius</code>はそれぞれ 頭蓋が発見された場所の標高と最低気温、<code>FMarea_intercondyle</code>は体格の大きさを示す指標、<code>Minimum_Illuminance</code>はlogスケールで表した光の強度、<code>Gender</code>は頭蓋の性別である。</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="Chapter1.html#cb2-1" tabindex="-1"></a>hvs <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">&quot;data/HVS.txt&quot;</span>)</span>
<span id="cb2-2"><a href="Chapter1.html#cb2-2" tabindex="-1"></a></span>
<span id="cb2-3"><a href="Chapter1.html#cb2-3" tabindex="-1"></a><span class="fu">datatable</span>(hvs,</span>
<span id="cb2-4"><a href="Chapter1.html#cb2-4" tabindex="-1"></a>          <span class="at">filter =</span> <span class="st">&quot;top&quot;</span>,</span>
<span id="cb2-5"><a href="Chapter1.html#cb2-5" tabindex="-1"></a>          <span class="at">options =</span> <span class="fu">list</span>(<span class="at">scrollX =</span> <span class="dv">20</span>))</span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-3978df898900109449f8" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-3978df898900109449f8">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td><\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"-35.64\" data-max=\"65\" data-scale=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0.02\" data-max=\"65\" data-scale=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1100\" data-max=\"1700\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"434.6\" data-max=\"890.65\" data-scale=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"19.5\" data-max=\"29.8\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1862.09\" data-max=\"112201.85\" data-scale=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"-14.39\" data-max=\"26.67\" data-scale=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55"],["OUM                 ","OUM                 ","OUM                 ","Duckworth           ","OUM                 ","OUM                 ","OUM                 ","Duckworth           ","Duckworth           ","Duckworth           ","Duckworth           ","OUM                 ","Duckworth           ","Duckworth           ","Duckworth           ","Duckworth           ","Duckworth           ","Duckworth           ","Duckworth           ","Duckworth           ","Duckworth           ","Duckworth           ","OUM                 ","OUM                 ","OUM                 ","OUM                 ","OUM                 ","OUM                 ","OUM                 ","OUM                 ","OUM                 ","OUM                 ","OUM                 ","Duckworth           ","OUM                 ","Duckworth           ","Duckworth           ","Duckworth           ","Duckworth           ","Duckworth           ","OUM                 ","Duckworth           ","OUM                 ","OUM                 ","OUM                 ","OUM                 ","OUM                 ","OUM                 ","OUM                 ","OUM                 ","Duckworth           ","Duckworth           ","Duckworth           ","Duckworth           ","Duckworth           "],["Gilbert_kingsmillisl          ","SotoanReefMicronesia          ","SotoanReefMicronesia          ","GuancheCanaryIslands          ","GuancheCanaryIslands          ","GuancheCanaryIslands          ","GuancheCanaryIslands          ","Uganda                        ","TesoUganda                    ","TesoUganda                    ","TesoUganda                    ","Uganda                        ","ErigavoDistrictGallGraveSomali","ElDerEngavoDistSomalia        ","Ainabo_BuraoSomalia           ","EngavoDistSomalia             ","AinaboBuraoDistrictSomalia    ","Kenya                         ","Kenya                         ","Kenya                         ","Kenya                         ","Kenya                         ","China                         ","China                         ","China                         ","CalcuttaIndia                 ","IndiaCeylonVeddah             ","CalcuttaIndiaBengale          ","Kansas_nebraska               ","Kansas_nebraska               ","ComancheWyom         ","Kansas_nebraska               ","Finland                       ","Sweden                        ","UlichtarFinland               ","Scandinavia                   ","Finland                       ","France                        ","ZouareFrance                  ","France                        ","Plestin_UpperBrittanyFrance ","ParisFrance                   ","BrittanyFrance                ","EnglandprobOxford          ","nrMagdColOxford             ","England                       ","England                       ","EnglandprobOxford          ","EnglandprobOxford          ","EnglandprobOxford          ","DampierPeninsularAustralia    ","AdelaideAustralia             ","Queensland                    ","CoorongNamnyeuAustralia       ","Queensland                    "],["Male","Male","Female","Unknown","Male","Male","Male","Unknown","Unknown","Unknown","Unknown","Male","Male","Male","Male","Female","Female","Unknown","Unknown","Unknown","Unknown","Unknown","Male","Male","Male","Male","Male","Female","Male","Male","Male","Female","Male","Male","Male","Female","Female","Male","Male","Male","Male","Female","Female","Unknown","Male","Male","Male","Male","Male","Male","Male","Male","Male","Female","Female"],["Micronesia","Micronesia","Micronesia","CanaryIslands","CanaryIslands","CanaryIslands","CanaryIslands","Uganda","Uganda","Uganda","Uganda","Uganda","Somalia","Somalia","Somalia","Somalia","Somalia","Kenya","Kenya","Kenya","Kenya","Kenya","China","China","China","India","India","India","USA","USA","USA","USA","Scandinavia","Scandinavia","Scandinavia","Scandinavia","Scandinavia","France","France","France","France","France","France","England","England","England","England","England","England","England","Australia","Australia","Australia","Australia","Australia"],[1.33,5.42,5.42,28.51,28.51,28.51,28.51,1.36,1.36,1.36,1.36,1.36,10.62,10.62,9.32,10.62,9.32,-0.02,-0.02,-0.02,-0.02,-0.02,37.37,37.37,37.37,22.57,7.75,22.57,40,40,42.97,40,65,62.54,65,63.54,64.96,46.75,46.75,46.75,48.66,48.82,48.18,51.74,51.74,52.86,51.74,51.74,51.74,51.74,-16.53,-34.94,-13.68,-35.63,-13.68],[1.33,5.42,5.42,28.51,28.51,28.51,28.51,1.36,1.36,1.36,1.36,1.36,10.62,10.62,9.32,10.62,9.32,0.02,0.02,0.02,0.02,0.02,37.37,37.37,37.37,22.57,7.75,22.57,40,40,42.97,40,65,62.54,65,63.54,64.96,46.75,46.75,46.75,48.66,48.82,48.18,51.74,51.74,52.86,51.74,51.74,51.74,51.74,16.53,34.94,13.68,35.63,13.68],[1200,1300,1100,1300,1420,1400,1620,1340,1480,1280,1360,1240,1430,1300,1640,1240,1280,1380,1300,1340,1280,1100,1435,1340,1700,1210,1420,1180,1380,1310,1480,1200,1410,1500,1540,1610,1360,1500,1450,1600,1620,1280,1320,1300,1390,1500,1310,1480,1580,1350,1140,1370,1290,1290,1320],[583.2,637.94,635.89,682.57,851.37,596.4,861.62,736.43,890.65,547.81,615.75,515.81,538.78,521.85,756.52,499.34,694.95,434.6,682.29,562.78,525.04,508.54,719.62,701.52,634.58,614.23,540.2,548.6,614.68,701.47,590.12,484.9,591.2,536.74,745.46,792.99,545.55,625.99,551.54,734.32,644.06,655.23,588.26,582.17,760.33,668.89,521.5,736.16,655.44,702.26,null,596.66,617.24,553.18,475.01],[22.5,21,22,20.5,25,25.5,27.6,24.5,24,25.3,21.6,24.5,21.3,27.5,22,23.3,22.6,25.5,22.5,22.5,19.5,22.9,22,23.4,28,28,22,22.8,27.4,26.8,28.5,23.9,28.3,27.5,26,26.4,26,26.5,27.5,29.4,27.5,25.6,21.1,23.1,27.4,29,23.1,29.8,28.9,22.3,24.6,26.1,26.5,24,23],[109647.82,104712.85,104712.85,64565.42,64565.42,64565.42,64565.42,109647.82,109647.82,109647.82,109647.82,109647.82,97723.72,97723.72,100000,97723.72,100000,112201.85,112201.85,112201.85,112201.85,112201.85,45708.82,45708.82,45708.82,77624.71,102329.3,77624.71,39810.72,39810.72,35481.34,39810.72,1862.09,4168.69,1862.09,3235.94,2187.76,28183.83,28183.83,28183.83,25118.86,24547.09,25703.96,20417.38,20417.38,18197.01,20417.38,20417.38,20417.38,20417.38,89125.09,51286.14,95499.26,50118.72,95499.26],[26.67,24.44,24.44,14.44,14.44,14.44,14.44,16.67,16.67,16.67,16.67,16.67,26.67,26.67,26.67,26.67,26.67,7.78,7.78,7.78,7.78,7.78,-12.78,-12.78,-12.78,13.89,22.78,13.89,-10,-10,-14.39,-10,-13.89,-10.56,-13.89,-10.56,-13.89,0,0,0,1.67,1.11,1.67,1.11,1.11,1.11,1.11,1.11,1.11,1.11,13.33,6.67,18.89,5,18.89]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Museum<\/th>\n      <th>Findsite<\/th>\n      <th>Gender<\/th>\n      <th>Population<\/th>\n      <th>Latitude<\/th>\n      <th>AbsoluteLatitude<\/th>\n      <th>CranialCapacity<\/th>\n      <th>FMarea_intercondyle<\/th>\n      <th>MeanOrbitalVolume<\/th>\n      <th>Minimum_Illuminance<\/th>\n      <th>Minimum_Temperature_celsius<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":20,"columnDefs":[{"className":"dt-right","targets":[5,6,7,8,9,10,11]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true}},"evals":[],"jsHooks":[]}</script>
<p>変数名が長いので、以下のように短く変更する。</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="Chapter1.html#cb3-1" tabindex="-1"></a>hvs <span class="sc">%&gt;%</span> </span>
<span id="cb3-2"><a href="Chapter1.html#cb3-2" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">OrbitalV =</span> MeanOrbitalVolume,</span>
<span id="cb3-3"><a href="Chapter1.html#cb3-3" tabindex="-1"></a>         <span class="at">LatAbs =</span> AbsoluteLatitude,</span>
<span id="cb3-4"><a href="Chapter1.html#cb3-4" tabindex="-1"></a>         <span class="at">CC =</span> CranialCapacity,</span>
<span id="cb3-5"><a href="Chapter1.html#cb3-5" tabindex="-1"></a>         <span class="at">Illuminance =</span> Minimum_Illuminance,</span>
<span id="cb3-6"><a href="Chapter1.html#cb3-6" tabindex="-1"></a>         <span class="at">Temperature =</span> Minimum_Temperature_celsius,</span>
<span id="cb3-7"><a href="Chapter1.html#cb3-7" tabindex="-1"></a>         <span class="at">FM =</span> FMarea_intercondyle) <span class="sc">%&gt;%</span> </span>
<span id="cb3-8"><a href="Chapter1.html#cb3-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fPopulation =</span> <span class="fu">factor</span>(Population),</span>
<span id="cb3-9"><a href="Chapter1.html#cb3-9" tabindex="-1"></a>         <span class="at">fGender =</span> <span class="fu">factor</span>(Gender)) <span class="ot">-&gt;</span> hvs</span></code></pre></div>
<p>新しい列名は以下の通り。</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="Chapter1.html#cb4-1" tabindex="-1"></a><span class="fu">colnames</span>(hvs)</span></code></pre></div>
<pre><code>##  [1] &quot;Museum&quot;      &quot;Findsite&quot;    &quot;Gender&quot;      &quot;Population&quot;  &quot;Latitude&quot;   
##  [6] &quot;LatAbs&quot;      &quot;CC&quot;          &quot;FM&quot;          &quot;OrbitalV&quot;    &quot;Illuminance&quot;
## [11] &quot;Temperature&quot; &quot;fPopulation&quot; &quot;fGender&quot;</code></pre>
</div>
<div id="protocol-for-the-analysis" class="section level2 hasAnchor" number="1.3">
<h2><span class="header-section-number">1.3</span> Protocol for the analysis<a href="Chapter1.html#protocol-for-the-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>いかなるデータ分析も、以下の手順に沿って行わなければならない。</p>
<ol style="list-style-type: decimal">
<li><p><strong>Data exploration</strong><br />
外れ値がないか、多重共線性(説明変数同士の強い相関)がないか、目的変数と説明変数の関係がどうか、ゼロ過剰はないか、サンプリングの収集が時間や場所によってばらついていないか、などをチェックする必要がある。</p></li>
<li><p><strong>Model application</strong><br />
1の作業で分かったことや研究仮説をもとに、適切なモデルを適用する。今回は重回帰分析を行うが、様々なモデルを適用可能である。</p></li>
<li><p><strong>Check the result</strong><br />
モデルを当てはめたら、どの変数が有意な影響を持つかを調べ、そうでなかった変数についてはどうするかを考える。</p></li>
<li><p><strong>Model validation</strong><br />
最後に、作成したモデルが前提を満たしているかをチェックする。満たしていれば結果の解釈や結果の作図を行い、満たしていなければモデルを改善する必要がある(GAM、GLM、GLMを使うなど)。</p></li>
</ol>
</div>
<div id="data-exploration" class="section level2 hasAnchor" number="1.4">
<h2><span class="header-section-number">1.4</span> Data exploration<a href="Chapter1.html#data-exploration" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>まずは手順1のデータ探索を行う。データ探索については <span class="citation">Zuur et al. (<a href="#ref-Zuur2010">2010</a>)</span> に詳しい。</p>
<div id="欠損値の確認" class="section level3 hasAnchor" number="1.4.1">
<h3><span class="header-section-number">1.4.1</span> 欠損値の確認<a href="Chapter1.html#欠損値の確認" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>まず、欠損値がないかを調べる。</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="Chapter1.html#cb6-1" tabindex="-1"></a><span class="fu">colSums</span>(<span class="fu">is.na</span>(hvs))</span></code></pre></div>
<pre><code>##      Museum    Findsite      Gender  Population    Latitude      LatAbs 
##           0           0           0           0           0           0 
##          CC          FM    OrbitalV Illuminance Temperature fPopulation 
##           0           1           0           0           0           0 
##     fGender 
##           0</code></pre>
<p><code>FM</code>の列に1つ欠損値があるので取り除く。</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="Chapter1.html#cb8-1" tabindex="-1"></a>hvs_b <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(hvs)</span></code></pre></div>
</div>
<div id="外れ値の確認" class="section level3 hasAnchor" number="1.4.2">
<h3><span class="header-section-number">1.4.2</span> 外れ値の確認<a href="Chapter1.html#外れ値の確認" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>続いて、外れ値がないかを確認する。ここでは、連続値の説明変数(<code>Latitude</code>、<code>CC</code>、<code>FM</code>、<code>Illuminance</code>、<code>Temperature</code>)についてCleveland Dotplotを作成する。Dotplotは縦軸にサンプル番号、横軸に実際の値をとる。</p>
<p>図は以下のとおりである(図<a href="Chapter1.html#fig:fig-dotplot1">1.1</a>)。図を見る限り、外れ値はなさそうだ。</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="Chapter1.html#cb9-1" tabindex="-1"></a>hvs_b <span class="sc">%&gt;%</span> </span>
<span id="cb9-2"><a href="Chapter1.html#cb9-2" tabindex="-1"></a>  <span class="fu">select</span>(LatAbs, CC, FM, Illuminance, Temperature) <span class="sc">%&gt;%</span> </span>
<span id="cb9-3"><a href="Chapter1.html#cb9-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sample_number =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb9-4"><a href="Chapter1.html#cb9-4" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb9-5"><a href="Chapter1.html#cb9-5" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;var&quot;</span>,</span>
<span id="cb9-6"><a href="Chapter1.html#cb9-6" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;values&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-7"><a href="Chapter1.html#cb9-7" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> values, <span class="at">y =</span> sample_number))<span class="sc">+</span></span>
<span id="cb9-8"><a href="Chapter1.html#cb9-8" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb9-9"><a href="Chapter1.html#cb9-9" tabindex="-1"></a>  <span class="fu">facet_rep_wrap</span>(<span class="sc">~</span>var,</span>
<span id="cb9-10"><a href="Chapter1.html#cb9-10" tabindex="-1"></a>                 <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>)<span class="sc">+</span></span>
<span id="cb9-11"><a href="Chapter1.html#cb9-11" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Values of the variable&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Sample number&quot;</span>)<span class="sc">+</span></span>
<span id="cb9-12"><a href="Chapter1.html#cb9-12" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-dotplot1"></span>
<img src="Introduction-to-GAM-using-R_files/figure-html/fig-dotplot1-1.png" alt="Cleveland dotplot for covariates." width="960" />
<p class="caption">
図1.1: Cleveland dotplot for covariates.
</p>
</div>
</div>
<div id="多重共線性の確認" class="section level3 hasAnchor" number="1.4.3">
<h3><span class="header-section-number">1.4.3</span> 多重共線性の確認<a href="Chapter1.html#多重共線性の確認" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>次に、多重共線性(説明変数同士の強い相関)がないかを調べる。もしあると、推定結果にバイアスが生じてしまう。</p>
<p>説明変数同士の関連を調べたところ(図<a href="Chapter1.html#fig:fig-corvar1">1.2</a>)、<code>LatAbs</code>と<code>Illuminance</code>、<code>Illuminance</code>と<code>Temperature</code>、<code>Temperature</code>と<code>LatAbs</code>に強い相関があることが分かる。また、<code>CC</code>は男性で高い傾向があることが分かったので、<code>CC</code>と<code>fGender</code>を同じモデルに説明変数として入れない方がよさそうである(今回は<code>fGender</code>を用いない)。</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="Chapter1.html#cb10-1" tabindex="-1"></a><span class="fu">ggpairs</span>(hvs_b <span class="sc">%&gt;%</span> <span class="fu">select</span>(LatAbs, CC, FM, Illuminance, Temperature, fGender))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-corvar1"></span>
<img src="Introduction-to-GAM-using-R_files/figure-html/fig-corvar1-1.png" alt="correlation between covariates" width="768" />
<p class="caption">
図1.2: correlation between covariates
</p>
</div>
</div>
<div id="目的変数と説明変数の関係の確認" class="section level3 hasAnchor" number="1.4.4">
<h3><span class="header-section-number">1.4.4</span> 目的変数と説明変数の関係の確認<a href="Chapter1.html#目的変数と説明変数の関係の確認" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>最後に、目的変数と説明変数の関連を調べる(図<a href="Chapter1.html#fig:fig-plotxy1">1.3</a>)。図には局所回帰(LOESS)による回帰曲線を追加している。</p>
<p>図から、<code>LatAbs</code>と<code>OrbitalV</code>の間に線形の関係がありそうだということが分かる(’CC’も?)。<code>Illuminance</code>や<code>Temperature</code>にも同様のことがいえるが、これは変数間に強い相関があることを考えれば当然だろう。多重共線性を考慮し、<span class="citation">Pearce &amp; Dunbar (<a href="#ref-Pearce2012">2012</a>)</span> にもとづいて解析では<code>LatAbs</code>を用いて<code>Illuminance</code>と<code>Temperature</code>は用いないこととする。</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="Chapter1.html#cb11-1" tabindex="-1"></a>hvs_b <span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a href="Chapter1.html#cb11-2" tabindex="-1"></a>  <span class="fu">select</span>(LatAbs, CC, FM, Illuminance, Temperature, OrbitalV) <span class="sc">%&gt;%</span> </span>
<span id="cb11-3"><a href="Chapter1.html#cb11-3" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb11-4"><a href="Chapter1.html#cb11-4" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;var&quot;</span>,</span>
<span id="cb11-5"><a href="Chapter1.html#cb11-5" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;values&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb11-6"><a href="Chapter1.html#cb11-6" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> values, <span class="at">y =</span> OrbitalV))<span class="sc">+</span></span>
<span id="cb11-7"><a href="Chapter1.html#cb11-7" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb11-8"><a href="Chapter1.html#cb11-8" tabindex="-1"></a>  <span class="fu">facet_rep_wrap</span>(<span class="sc">~</span>var,</span>
<span id="cb11-9"><a href="Chapter1.html#cb11-9" tabindex="-1"></a>                 <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>)<span class="sc">+</span></span>
<span id="cb11-10"><a href="Chapter1.html#cb11-10" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Explanatory Variables&quot;</span>, <span class="at">y =</span> <span class="st">&quot;OrbitalV&quot;</span>)<span class="sc">+</span></span>
<span id="cb11-11"><a href="Chapter1.html#cb11-11" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb11-12"><a href="Chapter1.html#cb11-12" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;loess&quot;</span>, <span class="at">se=</span> F, <span class="at">color =</span> <span class="st">&quot;grey32&quot;</span>,</span>
<span id="cb11-13"><a href="Chapter1.html#cb11-13" tabindex="-1"></a>              <span class="at">span =</span> <span class="fl">0.9</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-plotxy1"></span>
<img src="Introduction-to-GAM-using-R_files/figure-html/fig-plotxy1-1.png" alt="Relationship between explanatory variables and orbital volume (OrbitalV). A LOESS smoother was added to the plot." width="960" />
<p class="caption">
図1.3: Relationship between explanatory variables and orbital volume (OrbitalV). A LOESS smoother was added to the plot.
</p>
</div>
</div>
</div>
<div id="multiple-linear-regression" class="section level2 hasAnchor" number="1.5">
<h2><span class="header-section-number">1.5</span> Multiple linear regression<a href="Chapter1.html#multiple-linear-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="underlying-statistical-theory" class="section level3 hasAnchor" number="1.5.1">
<h3><span class="header-section-number">1.5.1</span> Underlying statistical theory<a href="Chapter1.html#underlying-statistical-theory" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>それでは、重回帰分析を行う。まずは説明のために説明変数が1つだけのモデル(= 単回帰)を考えよう。</p>
<p>標高のみを説明変数とする単回帰モデルは以下のように実行できる。</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="Chapter1.html#cb12-1" tabindex="-1"></a>M1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(OrbitalV <span class="sc">~</span> LatAbs, <span class="at">data =</span> hvs_b)</span>
<span id="cb12-2"><a href="Chapter1.html#cb12-2" tabindex="-1"></a></span>
<span id="cb12-3"><a href="Chapter1.html#cb12-3" tabindex="-1"></a><span class="fu">summary</span>(M1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = OrbitalV ~ LatAbs, data = hvs_b)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4.9893 -1.4166 -0.1616  1.5037  3.8887 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 22.91064    0.51412  44.563  &lt; 2e-16 ***
## LatAbs       0.06598    0.01411   4.677 2.11e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.253 on 52 degrees of freedom
## Multiple R-squared:  0.2961, Adjusted R-squared:  0.2825 
## F-statistic: 21.87 on 1 and 52 DF,  p-value: 2.111e-05</code></pre>
<p>これは、実際には何をやっているのだろうか?<br />
<code>lm</code>関数で短回帰を実行するとき、私たちは下記のモデルを実行している。なお、<span class="math inline">\(i\)</span>はサンプル番号(今回は55個の頭蓋がある)を、2行目は<span class="math inline">\(\epsilon_i\)</span>が平均0、分散<span class="math inline">\(\sigma^2\)</span>の正規分布に従うことを表す。</p>
<p><span class="math display">\[
\begin{aligned}
OrvitalV_i &amp;= \alpha + \beta\times LatAbs_i + \epsilon_i \;\; (i = 1,2,\dots, 55)\\
\epsilon_i &amp;\sim N(0,\sigma^2)
\end{aligned}
\]</span></p>
<p>このモデルで推定するパラメータは<span class="math inline">\(\alpha\)</span>、<span class="math inline">\(\beta\)</span>、<span class="math inline">\(\sigma\)</span>である。<span class="math inline">\(\beta\)</span>は標高(<code>LatAbs</code>)が眼窩容量(<code>OrbitalV</code>)に与える影響の大きさを表し、式からわかるように標高が1増えると眼窩容量が<span class="math inline">\(\beta\)</span>増えることを表す。先ほど<code>lm</code>関数で実行した結果で<code>Estimate</code>の下に書かれていた数字(<span class="math inline">\(22.91...と0.065...\)</span>)は<span class="math inline">\(\alphaと\beta\)</span>の推定値を示しているのである。</p>
<p>もし以下のように行列を定義すると、<br />
<span class="math display">\[
\begin{aligned}
\mathbf{y} =
\begin{pmatrix}
OrbitalV_1\\
OrbitalV_2\\
\vdots\\
OrvitalV_{55}
\end{pmatrix} ,
\mathbf{X} = \begin{pmatrix}
1 &amp; LatAbs_1\\
1 &amp; LatAbs_2\\
\vdots &amp; \vdots\\
1 &amp; LatAbs_{55}
\end{pmatrix},
\mathbf{\beta} = \begin{pmatrix}
\alpha\\
\beta
\end{pmatrix},
\mathbf{\epsilon} = \begin{pmatrix}
\epsilon_1\\
\epsilon_2\\
\vdots \\
\epsilon_{55}
\end{pmatrix}
\end{aligned}
\]</span></p>
<p>モデル式は以下のように書ける。<br />
<span class="math display">\[
\mathbf{y = X\times\beta + \epsilon}
\]</span></p>
<p><span class="math inline">\(\mathbf{X}\)</span>はRで以下のように求められる。</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="Chapter1.html#cb14-1" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">model.matrix</span>(M1))</span></code></pre></div>
<pre><code>##   (Intercept) LatAbs
## 1           1   1.33
## 2           1   5.42
## 3           1   5.42
## 4           1  28.51
## 5           1  28.51
## 6           1  28.51</code></pre>
<p>パラメータは<strong>最小二乗法(ordinary least square)</strong>で求められる。最小二乗法は、残差の二乗和(実際の測定値と推定されたモデルによる予測値の差、ここでは<span class="math inline">\(\sum_i^{55}( y_i - \alpha + \beta \times OrbitalV_i)\)</span>)が最小になるようにパラメータを推定する方法である。</p>
<p><span class="math inline">\(bfmath(\beta)\)</span>の推定値は数学的に以下のように求められる。なお、<span class="math inline">\(\mathbf{X^t}\)</span>は<span class="math inline">\(\mathbf{X}\)</span>の転置行列を、<span class="math inline">\(\mathbf{X^{-1}}\)</span>はは<span class="math inline">\(\mathbf{X}\)</span>の逆行列を表す。</p>
<p><span class="math display" id="eq:bhat">\[
\mathbf{\hat{\beta}} = (\mathbf{X^t}\times \mathbf{X})^{-1} \times \mathbf{X^t} \times \mathbf{y} \tag{1.1}  
\]</span></p>
<p>なお、<span class="math inline">\(\mathbf{\hat{\beta}}\)</span>は<span class="math inline">\(\mathbf{\beta}\)</span>の推定値であることを表し、便宜的にここでは<span class="math inline">\(\mathbf{\hat{\beta}} = \begin{pmatrix}a\\b \end{pmatrix}\)</span>とする。</p>
<p>Rでは<span class="math inline">\(\mathbf{\hat{\beta}}\)</span>を以下のように求められ、<code>lm</code>関数で推定した場合と同じ推定値が得られることが分かる。</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="Chapter1.html#cb16-1" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(M1)</span>
<span id="cb16-2"><a href="Chapter1.html#cb16-2" tabindex="-1"></a><span class="fu">solve</span>(<span class="fu">t</span>(X) <span class="sc">%*%</span> X) <span class="sc">%*%</span> <span class="fu">t</span>(X) <span class="sc">%*%</span> hvs_b<span class="sc">$</span>OrbitalV</span></code></pre></div>
<pre><code>##                   [,1]
## (Intercept) 22.9106427
## LatAbs       0.0659754</code></pre>
<p>よって、モデルによって推定された眼窩容量(<span class="math inline">\(\hat{y_i}\)</span>)は以下のように表せる。</p>
<p><span class="math display">\[
Fitted OrbitalV_i = 22.930 + 0.066 \times LatAbs_i
\]</span></p>
<p>すなわち、モデルの推定値から得られた残差<span class="math inline">\(e_i\)</span>は以下のように表せる。</p>
<p><span class="math display">\[
e_i = OrbitalV_i - a + b\times LatAbs_i
\]</span></p>
<p><span class="math inline">\(\mathbf{\hat{y}} = \mathbf{X}\times \mathbf{\beta}\)</span>と書けるので、残差の行列<span class="math inline">\(\mathbf{e}\)</span>は<span class="math inline">\(\mathbf{H} = (\mathbf{X^t}\times \mathbf{X})^{-1} \times \mathbf{X^t}\)</span>とするとき以下のように書ける。</p>
<p><span class="math display" id="eq:yhat">\[
\mathbf{e} = \mathbf{y} - \mathbf{\hat{y}} = \mathbf{y} - \mathbf{H\times y} = \mathbf{(1-H)\times y} \tag{1.2}
\]</span></p>
<p>モデル式より、<span class="math inline">\(\mathbf{y}\)</span>の分散共分散行列は<span class="math inline">\(\sigma^2 \times \mathbf{I}\)</span>と表せるので(<span class="math inline">\(\mathbf{I}\)</span>は単位行列)、<span class="math inline">\(\mathbf{e}\)</span>の分散共分散行列は以下のように表せる。</p>
<p><span class="math display">\[
cov(\mathbf{e}) = \sigma^2 \times (\mathbf{1 - H})
\]</span></p>
<p>また、以下の値を標準化残差(standardized residuals)という。なお、<span class="math inline">\(H_{ii}\)</span>は<span class="math inline">\(\mathbf{H}\)</span>の<span class="math inline">\(i\)</span>番目の対角成分を表す。</p>
<p><span class="math display">\[
e_i ^* = \frac{e_i}{\hat{\sigma} \sqrt{(1-H_{ii})}}
\]</span></p>
<p>もしモデルが正しいとき、標準化残差は標準正規分布に従うので、その値のほとんどは-2から2の間に収まるはずである。</p>
<p>Rでは、残差と標準化残差を以下のように求められる。</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="Chapter1.html#cb18-1" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="fu">resid</span>(M1)</span>
<span id="cb18-2"><a href="Chapter1.html#cb18-2" tabindex="-1"></a>estd <span class="ot">&lt;-</span> <span class="fu">rstandard</span>(M1)</span></code></pre></div>
<p>実際、1つのデータを除いて-2から2の範囲に収まっている(図<a href="Chapter1.html#fig:fig-stdred">1.4</a>)。</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="Chapter1.html#cb19-1" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">estd =</span> estd) <span class="sc">%&gt;%</span> </span>
<span id="cb19-2"><a href="Chapter1.html#cb19-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> estd))<span class="sc">+</span></span>
<span id="cb19-3"><a href="Chapter1.html#cb19-3" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.3</span>)<span class="sc">+</span></span>
<span id="cb19-4"><a href="Chapter1.html#cb19-4" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb19-5"><a href="Chapter1.html#cb19-5" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb19-6"><a href="Chapter1.html#cb19-6" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">1</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-stdred"></span>
<img src="Introduction-to-GAM-using-R_files/figure-html/fig-stdred-1.png" alt="標準化残差の分布" width="432" />
<p class="caption">
図1.4: 標準化残差の分布
</p>
</div>
<p><br/></p>
<div id="外れ値のチェック" class="section level4 hasAnchor" number="1.5.1.1">
<h4><span class="header-section-number">1.5.1.1</span> 外れ値のチェック<a href="Chapter1.html#外れ値のチェック" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>モデルに極端な外れ値がないかを調べるときには、LeverageとCook’s distanceが用いられることが多い。</p>
<p>*everageは<span class="math inline">\(\mathbf{H}\)</span>の対角成分で0から1の値をとり、大きいほどそのデータポイントが結果に大きな影響を与える外れ値であることを示す。特に極端な値はないよう(図<a href="Chapter1.html#fig:fig-leverage">1.5</a>)。</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="Chapter1.html#cb20-1" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">h =</span> <span class="fu">diag</span>(H),</span>
<span id="cb20-2"><a href="Chapter1.html#cb20-2" tabindex="-1"></a>           <span class="at">n =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(hvs_b)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-3"><a href="Chapter1.html#cb20-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> h))<span class="sc">+</span></span>
<span id="cb20-4"><a href="Chapter1.html#cb20-4" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="fl">0.3</span>)<span class="sc">+</span></span>
<span id="cb20-5"><a href="Chapter1.html#cb20-5" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb20-6"><a href="Chapter1.html#cb20-6" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb20-7"><a href="Chapter1.html#cb20-7" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;sample number&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Leverage&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-leverage"></span>
<img src="Introduction-to-GAM-using-R_files/figure-html/fig-leverage-1.png" alt="Leveragevalue for each observation" width="432" />
<p class="caption">
図1.5: Leveragevalue for each observation
</p>
</div>
<p>式<a href="Chapter1.html#eq:yhat">(1.2)</a>より、以下のように書ける。すなわち、<span class="math inline">\(i\)</span>番目の観察に対してモデルから予測される値(fitted value)は元データの観測値の加重平均であり、重みは行列<span class="math inline">\(\mathbf{H}\)</span>により与えられる。</p>
<p><span class="math display" id="eq:yhat2">\[
\hat{y_i} = H_{i1} \times y_1 + H_{i2} \times y_2 + \dots + H_{i55} \times y_55　\tag{1.3}
\]</span></p>
<p>特に<span class="math inline">\(H_{ii}\)</span>は観測値<span class="math inline">\(y_i\)</span>がモデルからの予測値<span class="math inline">\(\hat{y_i}\)</span>に与える影響の大きさを表している。そのため、<span class="math inline">\(H_{ii}\)</span>が高いことは、その観測値がモデルの推定に大きな影響を及ぼしていることを示しているのである。</p>
<p>ある観測値がモデルの推定に影響を与えている度合いを表すのがCook’s distanceで、以下の式で表せる。<span class="math inline">\(\hat{y_{(i)}}\)</span>は式<a href="Chapter1.html#eq:yhat2">(1.3)</a>から<span class="math inline">\(H_{ii}\times y_i\)</span>を除いたものである。また、<span class="math inline">\(p\)</span>はモデルの回帰式の中のパラメータ数である。</p>
<p><span class="math display">\[
D_i = \frac{||\hat{y_i} - \hat{y_{(i)}}||}{p \times \hat{\sigma^2}}
\]</span></p>
<p>Cook’s distanceはRで以下のように取得できる。</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="Chapter1.html#cb21-1" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="fu">cooks.distance</span>(M1)</span>
<span id="cb21-2"><a href="Chapter1.html#cb21-2" tabindex="-1"></a></span>
<span id="cb21-3"><a href="Chapter1.html#cb21-3" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">cookD =</span> D,</span>
<span id="cb21-4"><a href="Chapter1.html#cb21-4" tabindex="-1"></a>           <span class="at">n =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(hvs_b)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-5"><a href="Chapter1.html#cb21-5" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> cookD))<span class="sc">+</span></span>
<span id="cb21-6"><a href="Chapter1.html#cb21-6" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="fl">0.2</span>)<span class="sc">+</span></span>
<span id="cb21-7"><a href="Chapter1.html#cb21-7" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb21-8"><a href="Chapter1.html#cb21-8" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb21-9"><a href="Chapter1.html#cb21-9" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;sample number&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Cook&#39;s distance&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-cook"></span>
<img src="Introduction-to-GAM-using-R_files/figure-html/fig-cook-1.png" alt="Cook's distance for each observation" width="432" />
<p class="caption">
図1.6: Cook’s distance for each observation
</p>
</div>
</div>
<div id="信頼区間と予測区間の算出" class="section level4 hasAnchor" number="1.5.1.2">
<h4><span class="header-section-number">1.5.1.2</span> 95%信頼区間と予測区間の算出<a href="Chapter1.html#信頼区間と予測区間の算出" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><span class="math inline">\(\mathbf{\beta}\)</span>の推定値の分散共分散行列は<span class="math inline">\(\mathbf{y}\)</span>の分散共分散行列が<span class="math inline">\(\mathbf{\sigma^2 \times I}\)</span>であることを考えると、式<a href="Chapter1.html#eq:bhat">(1.1)</a>より以下のようになる。<br />
<span class="math display">\[
\begin{aligned}
cov(\mathbf{\hat{\beta}}) &amp;= \mathbf(X^t \times X)^{-1} \times \mathbf{X^t} \times cov(\mathbf{y}) \times \mathbf{X} \times (\mathbf{X^t} \times \mathbf{X})^{-1} \\
&amp;= \sigma^2 \times (\mathbf{X^t} \times \mathbf{X})^{-1}
\end{aligned}
\]</span></p>
<p><span class="math inline">\(\hat{\beta}\)</span>の標準偏差は上式から得られる行列の対角成分の1/2乗である。この値は、<code>lm</code>関数を利用した結果(<code>Std. Error</code>の下の数値)と一致する。</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="Chapter1.html#cb22-1" tabindex="-1"></a>SE <span class="ot">&lt;-</span><span class="fu">summary</span>(M1)<span class="sc">$</span>sigma <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="fu">diag</span>(<span class="fu">solve</span>(<span class="fu">t</span>(X) <span class="sc">%*%</span> X)))</span>
<span id="cb22-2"><a href="Chapter1.html#cb22-2" tabindex="-1"></a></span>
<span id="cb22-3"><a href="Chapter1.html#cb22-3" tabindex="-1"></a>SE</span></code></pre></div>
<pre><code>## (Intercept)      LatAbs 
##  0.51411731  0.01410749</code></pre>
<p>95%信頼区間は、モデル式より<span class="math inline">\(\beta\)</span>が正規分布に従うので以下のように求められる。</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="Chapter1.html#cb24-1" tabindex="-1"></a>Z <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">coef</span>(M1) <span class="sc">+</span> <span class="fl">1.96</span><span class="sc">*</span>SE,</span>
<span id="cb24-2"><a href="Chapter1.html#cb24-2" tabindex="-1"></a>           <span class="fu">coef</span>(M1) <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span>SE) <span class="sc">%&gt;%</span> </span>
<span id="cb24-3"><a href="Chapter1.html#cb24-3" tabindex="-1"></a>  <span class="fu">data.frame</span>() </span>
<span id="cb24-4"><a href="Chapter1.html#cb24-4" tabindex="-1"></a></span>
<span id="cb24-5"><a href="Chapter1.html#cb24-5" tabindex="-1"></a><span class="fu">rownames</span>(Z) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Upper bound&quot;</span>, <span class="st">&quot;Lower bound&quot;</span>)</span>
<span id="cb24-6"><a href="Chapter1.html#cb24-6" tabindex="-1"></a></span>
<span id="cb24-7"><a href="Chapter1.html#cb24-7" tabindex="-1"></a>Z</span></code></pre></div>
<pre><code>##             X.Intercept.     LatAbs
## Upper bound     23.91831 0.09362607
## Lower bound     21.90297 0.03832472</code></pre>
<p>ただし、これはサンプルサイズが十分に大きいときのみ成り立つ。実際は、<span class="math inline">\(\hat{\beta}\)</span>は自由度<span class="math inline">\(55-2\)</span>(サンプル数 - パラメータ数)のt分布に従うので、より正確に95%信頼区間を求めるには、1.96ではなく2.005746…を用いる必要がある。</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="Chapter1.html#cb26-1" tabindex="-1"></a><span class="fu">qt</span>(<span class="dv">1</span><span class="sc">-</span> <span class="fl">0.05</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">df =</span> <span class="dv">55-2</span>)</span></code></pre></div>
<pre><code>## [1] 2.005746</code></pre>
<p>95％信頼区間は、もし100回同様の方法で実験/観察を行ってそれぞれについて95%信頼区間を算出するとき、そのうち95個には真の値が含まれていることを表す。95%信頼区間に0が含まれていないとき、<span class="math inline">\(\hat{\beta}\)</span>が有意に0とは違うということができる。</p>
<p>同様に、モデルに基づいた予測値の分散共分散行列は以下のように求められ、その対角成分の1/2乗が予測値の標準誤差(SE)になる。　　</p>
<p><span class="math display" id="eq:covy">\[
cov(\mathbf{\hat{y}}) = \mathbf{X} \times cov(\mathbf{\hat{\beta}}) \times \mathbf{X^t} \tag{1.4}
\]</span></p>
<p>予測値の95%信頼区間はある標高(<code>LatAbs</code>)に対して100回データをサンプリングすれば95個のデータが含まれる範囲を表し、予測値が自由度55-2のt分布に従うので、<span class="math inline">\(予測値 ± 2.0057 \times SE\)</span>で求められる。</p>
<p>一方で95%予測区間は新たにデータをサンプリングしたときにデータの95%が収まる範囲を指す。予測区間を求める際の標準誤差には式<a href="Chapter1.html#eq:covy">(1.4)</a>に<span class="math inline">\(\hat{\sigma^2}\)</span>を足したものを用いればよい。</p>
<p>Rでは予測値と95%信頼区間、95%予測区間は以下のように求められる。</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="Chapter1.html#cb28-1" tabindex="-1"></a><span class="do">## 係数の分散共分散行列  </span></span>
<span id="cb28-2"><a href="Chapter1.html#cb28-2" tabindex="-1"></a>covbeta <span class="ot">&lt;-</span> <span class="fu">vcov</span>(M1)</span>
<span id="cb28-3"><a href="Chapter1.html#cb28-3" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">LatAbs =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">65</span>,<span class="at">length.out =</span> <span class="dv">100</span>))</span>
<span id="cb28-4"><a href="Chapter1.html#cb28-4" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span>LatAbs, <span class="at">data =</span> data)</span>
<span id="cb28-5"><a href="Chapter1.html#cb28-5" tabindex="-1"></a></span>
<span id="cb28-6"><a href="Chapter1.html#cb28-6" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">qt</span>(<span class="dv">1</span><span class="fl">-0.05</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">df =</span> <span class="dv">55-2</span>)</span>
<span id="cb28-7"><a href="Chapter1.html#cb28-7" tabindex="-1"></a>  </span>
<span id="cb28-8"><a href="Chapter1.html#cb28-8" tabindex="-1"></a>data <span class="sc">%&gt;%</span> </span>
<span id="cb28-9"><a href="Chapter1.html#cb28-9" tabindex="-1"></a>  <span class="do">## 予測値</span></span>
<span id="cb28-10"><a href="Chapter1.html#cb28-10" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> X <span class="sc">%*%</span> <span class="fu">coef</span>(M1)) <span class="sc">%&gt;%</span> </span>
<span id="cb28-11"><a href="Chapter1.html#cb28-11" tabindex="-1"></a>  <span class="do">## se(信頼区間)</span></span>
<span id="cb28-12"><a href="Chapter1.html#cb28-12" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">se.ci =</span> <span class="fu">sqrt</span>(<span class="fu">diag</span>(X <span class="sc">%*%</span> covbeta <span class="sc">%*%</span> <span class="fu">t</span>(X)))) <span class="sc">%&gt;%</span> </span>
<span id="cb28-13"><a href="Chapter1.html#cb28-13" tabindex="-1"></a>  <span class="do">## se(予測区間)</span></span>
<span id="cb28-14"><a href="Chapter1.html#cb28-14" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">se.pi =</span> <span class="fu">sqrt</span>(<span class="fu">diag</span>(X <span class="sc">%*%</span> covbeta <span class="sc">%*%</span> <span class="fu">t</span>(X)) <span class="sc">+</span> <span class="fu">summary</span>(M1)<span class="sc">$</span>sigma<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb28-15"><a href="Chapter1.html#cb28-15" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ci_upper =</span> p <span class="sc">+</span> t<span class="sc">*</span>se.ci,</span>
<span id="cb28-16"><a href="Chapter1.html#cb28-16" tabindex="-1"></a>         <span class="at">ci_lower =</span> p <span class="sc">-</span> t<span class="sc">*</span>se.ci,</span>
<span id="cb28-17"><a href="Chapter1.html#cb28-17" tabindex="-1"></a>         <span class="at">pi_upper =</span> p <span class="sc">+</span> t<span class="sc">*</span>se.pi,</span>
<span id="cb28-18"><a href="Chapter1.html#cb28-18" tabindex="-1"></a>         <span class="at">pi_lower =</span> p <span class="sc">-</span> t<span class="sc">*</span>se.pi) <span class="ot">-&gt;</span> pred</span></code></pre></div>
<p>図示すると以下のようになる(図<a href="Chapter1.html#fig:fig-result">1.7</a>)。</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="Chapter1.html#cb29-1" tabindex="-1"></a>pred <span class="sc">%&gt;%</span> </span>
<span id="cb29-2"><a href="Chapter1.html#cb29-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> LatAbs, <span class="at">y =</span> p))<span class="sc">+</span></span>
<span id="cb29-3"><a href="Chapter1.html#cb29-3" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb29-4"><a href="Chapter1.html#cb29-4" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> ci_lower, <span class="at">ymax =</span> ci_upper),</span>
<span id="cb29-5"><a href="Chapter1.html#cb29-5" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;grey21&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb29-6"><a href="Chapter1.html#cb29-6" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> pi_lower, <span class="at">ymax =</span> pi_upper),</span>
<span id="cb29-7"><a href="Chapter1.html#cb29-7" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;grey72&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb29-8"><a href="Chapter1.html#cb29-8" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> hvs_b,</span>
<span id="cb29-9"><a href="Chapter1.html#cb29-9" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> OrbitalV))<span class="sc">+</span></span>
<span id="cb29-10"><a href="Chapter1.html#cb29-10" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb29-11"><a href="Chapter1.html#cb29-11" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb29-12"><a href="Chapter1.html#cb29-12" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;OrbitalV&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-result"></span>
<img src="Introduction-to-GAM-using-R_files/figure-html/fig-result-1.png" alt="95%信頼区間と予測区間" width="432" />
<p class="caption">
図1.7: 95%信頼区間と予測区間
</p>
</div>
<p><code>predict</code>関数を用いて簡単に求めることができる。</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="Chapter1.html#cb30-1" tabindex="-1"></a><span class="fu">predict</span>(M1,</span>
<span id="cb30-2"><a href="Chapter1.html#cb30-2" tabindex="-1"></a>        <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">LatAbs =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">65</span>,<span class="fl">0.2</span>)),</span>
<span id="cb30-3"><a href="Chapter1.html#cb30-3" tabindex="-1"></a>        <span class="at">interval =</span> <span class="st">&quot;confidence&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb30-4"><a href="Chapter1.html#cb30-4" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb30-5"><a href="Chapter1.html#cb30-5" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">data.frame</span>(<span class="at">LatAbs =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">65</span>,<span class="fl">0.2</span>))) <span class="ot">-&gt;</span> conf_M1</span>
<span id="cb30-6"><a href="Chapter1.html#cb30-6" tabindex="-1"></a></span>
<span id="cb30-7"><a href="Chapter1.html#cb30-7" tabindex="-1"></a><span class="fu">predict</span>(M1,</span>
<span id="cb30-8"><a href="Chapter1.html#cb30-8" tabindex="-1"></a>        <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">LatAbs =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">65</span>,<span class="fl">0.2</span>)),</span>
<span id="cb30-9"><a href="Chapter1.html#cb30-9" tabindex="-1"></a>        <span class="at">interval =</span> <span class="st">&quot;prediction&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb30-10"><a href="Chapter1.html#cb30-10" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb30-11"><a href="Chapter1.html#cb30-11" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">data.frame</span>(<span class="at">LatAbs =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">65</span>,<span class="fl">0.2</span>))) <span class="ot">-&gt;</span> pred_M1</span>
<span id="cb30-12"><a href="Chapter1.html#cb30-12" tabindex="-1"></a></span>
<span id="cb30-13"><a href="Chapter1.html#cb30-13" tabindex="-1"></a>hvs_b <span class="sc">%&gt;%</span> </span>
<span id="cb30-14"><a href="Chapter1.html#cb30-14" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> LatAbs, <span class="at">y =</span> OrbitalV))<span class="sc">+</span></span>
<span id="cb30-15"><a href="Chapter1.html#cb30-15" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> conf_M1,</span>
<span id="cb30-16"><a href="Chapter1.html#cb30-16" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> fit))<span class="sc">+</span></span>
<span id="cb30-17"><a href="Chapter1.html#cb30-17" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> conf_M1,</span>
<span id="cb30-18"><a href="Chapter1.html#cb30-18" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> fit, <span class="at">ymin =</span> lwr, <span class="at">ymax =</span> upr),</span>
<span id="cb30-19"><a href="Chapter1.html#cb30-19" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;grey21&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb30-20"><a href="Chapter1.html#cb30-20" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> pred_M1,</span>
<span id="cb30-21"><a href="Chapter1.html#cb30-21" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> fit, <span class="at">ymin =</span> lwr, <span class="at">ymax =</span> upr),</span>
<span id="cb30-22"><a href="Chapter1.html#cb30-22" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;grey72&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb30-23"><a href="Chapter1.html#cb30-23" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb30-24"><a href="Chapter1.html#cb30-24" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb30-25"><a href="Chapter1.html#cb30-25" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-result2"></span>
<img src="Introduction-to-GAM-using-R_files/figure-html/fig-result2-1.png" alt="95%信頼区間と予測区間(predict関数を使用)" width="432" />
<p class="caption">
図1.8: 95%信頼区間と予測区間(predict関数を使用)
</p>
</div>
</div>
</div>
<div id="multiple-linear-regression-1" class="section level3 hasAnchor" number="1.5.2">
<h3><span class="header-section-number">1.5.2</span> Multiple linear regression<a href="Chapter1.html#multiple-linear-regression-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>それでは、2つ以上の変数を含めたモデリングを行う。データ探索や先行研究の知見から、モデルには<code>LatAbs</code>、<code>CC</code>、<code>FM</code>を説明変数として入れ、2変数の交互作用を全ての組み合わせについて含めた。</p>
<p><span class="math display">\[
\begin{aligned}
OrbitalV_i &amp;= \alpha + \beta_1 \times LatAbs_i + \beta_2 \times CC_i + \beta_3 \times FM_i \\
&amp; + \beta_4 \times LatAbs_i \times CC_i\\
&amp; + \beta_5 \times LatAbs_i \times FM_i \\
&amp; + \beta_6 \times CC_i \times FM_i + \epsilon_i\\
\epsilon_i &amp;\sim N(0,\sigma^2)
\end{aligned}
\]</span></p>
</div>
<div id="fitting-the-model-in-r-and-estimate-parameters" class="section level3 hasAnchor" number="1.5.3">
<h3><span class="header-section-number">1.5.3</span> Fitting the model in R and estimate parameters<a href="Chapter1.html#fitting-the-model-in-r-and-estimate-parameters" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>モデルのパラメータは、先ほどと同様に<code>lm</code>関数で推定できる。推定は前節で行ったのと全く同じ方法(最小二乗法)で行う。</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="Chapter1.html#cb31-1" tabindex="-1"></a>M2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(OrbitalV <span class="sc">~</span> LatAbs <span class="sc">+</span> CC <span class="sc">+</span> FM <span class="sc">+</span> LatAbs<span class="sc">:</span>CC <span class="sc">+</span> LatAbs<span class="sc">:</span>FM <span class="sc">+</span> CC<span class="sc">:</span>FM,</span>
<span id="cb31-2"><a href="Chapter1.html#cb31-2" tabindex="-1"></a>         <span class="at">data =</span> hvs_b)</span></code></pre></div>
<p>結果は以下の通り。<code>Estimate</code>はパラメータの推定値を、<code>t value</code>は5%水準でパラメータが有意に0と異なっているかを判断する際に用いられる。P値(<code>Pr(&gt;|t|)</code>)を見ると、有意な変数は一つもなかった。</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="Chapter1.html#cb32-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(M2), <span class="at">digits =</span> <span class="dv">3</span>, <span class="at">signif.stars =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = OrbitalV ~ LatAbs + CC + FM + LatAbs:CC + LatAbs:FM + 
##     CC:FM, data = hvs_b)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
##  -3.79  -1.50  -0.23   1.40   4.63 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept)  2.19e+01   2.24e+01    0.97    0.335
## LatAbs      -2.51e-01   1.60e-01   -1.56    0.124
## CC           9.37e-04   1.65e-02    0.06    0.955
## FM           2.16e-03   3.50e-02    0.06    0.951
## LatAbs:CC    2.37e-04   1.30e-04    1.83    0.074
## LatAbs:FM   -4.49e-05   1.57e-04   -0.29    0.776
## CC:FM       -1.56e-06   2.50e-05   -0.06    0.951
## 
## Residual standard error: 2.14 on 47 degrees of freedom
## Multiple R-squared:  0.427,  Adjusted R-squared:  0.354 
## F-statistic: 5.84 on 6 and 47 DF,  p-value: 0.000131</code></pre>
</div>
</div>
<div id="finding-the-optimal-model" class="section level2 hasAnchor" number="1.6">
<h2><span class="header-section-number">1.6</span> Finding the optimal model<a href="Chapter1.html#finding-the-optimal-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>さて、先ほどのモデルでは1つも有意に0と異なるパラメータ(<span class="math inline">\(\alpha, \beta_1 \sim \beta_6\)</span>)はなかった(= 目的変数に有意な影響を持つ説明変数変数がなかった)。このようなとき、選択肢がいくつかある。</p>
<ol style="list-style-type: decimal">
<li>そのままのモデルを採用し、全ての交互作用が5%水準では有意ではなかったと報告する。<br />
</li>
<li>AICを利用して古典的なモデル選択を行う。<br />
</li>
<li>仮説検定の結果に基づいて変数選択を行う(効果のなさそうな変数を外す)。<br />
</li>
<li>交互作用についてのみモデル選択を行う。<br />
</li>
<li>情報理論的アプローチを用い、モデル平均化などを行う(c.f., <span class="citation">Burnham et al. (<a href="#ref-Burnham2011">2011</a>)</span> )。</li>
</ol>
<p>ここでは、 <span class="citation">Pearce &amp; Dunbar (<a href="#ref-Pearce2012">2012</a>)</span> に従い、AICを用いたモデル選択を行うことにする。</p>
<p>Rでは、<code>step</code>関数を用いることでステップワイズ法(AICが最も低くなるまで説明変数を1つずつ増減させる方法)を用いた変数選択を行うことができる。分析の結果、<code>LatAbs</code>、<code>CC</code>、これらの交互作用のみを含むモデルが最もAICが低い(= 予測精度が高い)と判断された。</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="Chapter1.html#cb34-1" tabindex="-1"></a><span class="fu">step</span>(M2)</span></code></pre></div>
<pre><code>## Start:  AIC=88.54
## OrbitalV ~ LatAbs + CC + FM + LatAbs:CC + LatAbs:FM + CC:FM
## 
##             Df Sum of Sq    RSS    AIC
## - CC:FM      1    0.0177 214.75 86.547
## - LatAbs:FM  1    0.3756 215.11 86.637
## &lt;none&gt;                   214.74 88.543
## - LatAbs:CC  1   15.2596 230.00 90.250
## 
## Step:  AIC=86.55
## OrbitalV ~ LatAbs + CC + FM + LatAbs:CC + LatAbs:FM
## 
##             Df Sum of Sq    RSS    AIC
## - LatAbs:FM  1    0.4172 215.17 84.652
## &lt;none&gt;                   214.75 86.547
## - LatAbs:CC  1   15.2501 230.00 88.252
## 
## Step:  AIC=84.65
## OrbitalV ~ LatAbs + CC + FM + LatAbs:CC
## 
##             Df Sum of Sq    RSS    AIC
## - FM         1    0.5409 215.71 82.788
## &lt;none&gt;                   215.17 84.652
## - LatAbs:CC  1   16.8268 232.00 86.718
## 
## Step:  AIC=82.79
## OrbitalV ~ LatAbs + CC + LatAbs:CC
## 
##             Df Sum of Sq    RSS    AIC
## &lt;none&gt;                   215.71 82.788
## - LatAbs:CC  1     17.24 232.95 84.940</code></pre>
<pre><code>## 
## Call:
## lm(formula = OrbitalV ~ LatAbs + CC + LatAbs:CC, data = hvs_b)
## 
## Coefficients:
## (Intercept)       LatAbs           CC    LatAbs:CC  
##   2.323e+01   -2.552e-01   -5.829e-05    2.201e-04</code></pre>
<p>そこで、選ばれた変数のみを用いたモデルを作成し、分析を行う。</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="Chapter1.html#cb37-1" tabindex="-1"></a>M3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(OrbitalV <span class="sc">~</span> LatAbs<span class="sc">*</span>CC, <span class="at">data =</span> hvs_b)</span></code></pre></div>
<p>分析の結果は以下のとおりである。交互作用項の係数の推定値のP値が0.051であり、わずかに交互作用項の影響があることが示唆された?</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="Chapter1.html#cb38-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(M3), <span class="at">digits =</span> <span class="dv">3</span>, <span class="at">signif.stars =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = OrbitalV ~ LatAbs * CC, data = hvs_b)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -3.759 -1.504 -0.098  1.513  4.588 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept)  2.32e+01   5.23e+00    4.44  4.9e-05
## LatAbs      -2.55e-01   1.53e-01   -1.67    0.101
## CC          -5.83e-05   3.94e-03   -0.01    0.988
## LatAbs:CC    2.20e-04   1.10e-04    2.00    0.051
## 
## Residual standard error: 2.08 on 50 degrees of freedom
## Multiple R-squared:  0.425,  Adjusted R-squared:  0.39 
## F-statistic: 12.3 on 3 and 50 DF,  p-value: 3.81e-06</code></pre>
</div>
<div id="degree-of-freedom" class="section level2 hasAnchor" number="1.7">
<h2><span class="header-section-number">1.7</span> Degree of freedom<a href="Chapter1.html#degree-of-freedom" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>モデルの自由度はサンプル数(55)からパラメータ数(今回は4)を引いた値なので51である。しかし、このような自由度の求め方はGAMではできない。一般に、パラメータ数は<span class="math inline">\(\mathbf{H}\)</span>の対角成分の和(= trace)で求めることができる。</p>
<p><span class="math display">\[
p = \sum_{i =1} ^{55} \mathbf{H_{ii}}
\]</span></p>
<p>確かに4になっている。</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="Chapter1.html#cb40-1" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(M3)</span>
<span id="cb40-2"><a href="Chapter1.html#cb40-2" tabindex="-1"></a>H <span class="ot">&lt;-</span> X <span class="sc">%*%</span> <span class="fu">solve</span>(<span class="fu">t</span>(X) <span class="sc">%*%</span> X) <span class="sc">%*%</span> <span class="fu">t</span>(X)</span>
<span id="cb40-3"><a href="Chapter1.html#cb40-3" tabindex="-1"></a></span>
<span id="cb40-4"><a href="Chapter1.html#cb40-4" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">diag</span>(H))</span></code></pre></div>
<pre><code>## [1] 4</code></pre>
</div>
<div id="model-validation" class="section level2 hasAnchor" number="1.8">
<h2><span class="header-section-number">1.8</span> Model validation<a href="Chapter1.html#model-validation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>最後に、作成したモデルが前提を満たしているかをチェックする。残差には普通の残差のほかに、標準化残差、スチューデント化残差などがあるが、ここでは標準化残差を用いる。</p>
<ol style="list-style-type: decimal">
<li>等分散性が成り立つか (→ モデルに基づく予測値と残差をプロットする)<br />
</li>
<li>モデルがデータに当てはまっているか (→ 残差とモデルに含まれる説明変数、モデルに含まれない説明変数の関係をプロットする)<br />
</li>
<li>データの独立性があるか(→ 自己相関があるかを確認する)<br />
</li>
<li>残差が正規分布に従うかを確認する(→ QQプロットを書く)<br />
</li>
<li>モデルへの影響が大きいデータがないか確認する(→ Cook’s distanceやLeverage)</li>
</ol>
<p>まず、モデルによる予測値と標準化残差の関係をプロットする(図<a href="Chapter1.html#fig:fig-fitted-resid">1.9</a>)。このときプロットにパターンがあってはいけない(e.g., 広がっていく、ばらつきが不均等など)。もし前提を満たしていれば、0を中心に均等にばらつくはずである。図からは、明確なパターンは見られない(横軸が26~27で負の残差がほとんどないなどを除けば)。</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="Chapter1.html#cb42-1" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">fitted =</span> <span class="fu">fitted</span>(M3),</span>
<span id="cb42-2"><a href="Chapter1.html#cb42-2" tabindex="-1"></a>           <span class="at">resstd =</span> <span class="fu">rstandard</span>(M3)) <span class="sc">%&gt;%</span> </span>
<span id="cb42-3"><a href="Chapter1.html#cb42-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fitted, <span class="at">y =</span> resstd))<span class="sc">+</span></span>
<span id="cb42-4"><a href="Chapter1.html#cb42-4" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb42-5"><a href="Chapter1.html#cb42-5" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb42-6"><a href="Chapter1.html#cb42-6" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb42-7"><a href="Chapter1.html#cb42-7" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb42-8"><a href="Chapter1.html#cb42-8" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Fitted values&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Standardized residuals&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-fitted-resid"></span>
<img src="Introduction-to-GAM-using-R_files/figure-html/fig-fitted-resid-1.png" alt="Standardized residuals versus fitted values to assess homogeneity" width="432" />
<p class="caption">
図1.9: Standardized residuals versus fitted values to assess homogeneity
</p>
</div>
<p><br/></p>
<p>続いて、Cook`s distanceを用いて影響の大きいデータがないか確認する。Cook’s distanceは通常1を超えると影響が大きいと判断される<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>。ほんもでるではそのような値をとる観測値はない(図<a href="Chapter1.html#fig:fig-cook2">1.10</a>)。</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="Chapter1.html#cb43-1" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">cook =</span> <span class="fu">cooks.distance</span>(M3),</span>
<span id="cb43-2"><a href="Chapter1.html#cb43-2" tabindex="-1"></a>           <span class="at">n =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(hvs_b)) <span class="sc">%&gt;%</span> </span>
<span id="cb43-3"><a href="Chapter1.html#cb43-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> cook))<span class="sc">+</span></span>
<span id="cb43-4"><a href="Chapter1.html#cb43-4" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="fl">0.2</span>)<span class="sc">+</span></span>
<span id="cb43-5"><a href="Chapter1.html#cb43-5" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>)<span class="sc">+</span></span>
<span id="cb43-6"><a href="Chapter1.html#cb43-6" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb43-7"><a href="Chapter1.html#cb43-7" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb43-8"><a href="Chapter1.html#cb43-8" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Observations&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Cook&#39;s distance&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-cook2"></span>
<img src="Introduction-to-GAM-using-R_files/figure-html/fig-cook2-1.png" alt="Cook's disance for each observation" width="432" />
<p class="caption">
図1.10: Cook’s disance for each observation
</p>
</div>
<p>残差の正規性は、ヒストグラムとQQプロットを基に判断される。QQプロットとは、「得られたデータ(今回の場合は標準化残差)と理論分布(今回の場合は標準正規分布)を比較し、その類似度を調べるためのグラフ」である。詳細については<a href="https://qiita.com/kenmatsu4/items/59605dc745707e8701e0">こちら</a>。もし類似度が高ければ、点が直線上に乗る。そこまで大きくは外れていなさそう。</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="Chapter1.html#cb44-1" tabindex="-1"></a><span class="fu">qqnorm</span>(<span class="fu">rstandard</span>(M3))</span>
<span id="cb44-2"><a href="Chapter1.html#cb44-2" tabindex="-1"></a><span class="fu">qqline</span>(<span class="fu">rstandard</span>(M3))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-qqplot"></span>
<img src="Introduction-to-GAM-using-R_files/figure-html/fig-qqplot-1.png" alt="QQplot for M3" width="432" />
<p class="caption">
図1.11: QQplot for M3
</p>
</div>
<p>続いて、(モデルに入れていない説明変数を含めた)各連続変数と標準化残差の関連を図示する(図<a href="Chapter1.html#fig:fig-multiscatter">1.12</a>)。いずれも関連はないようで、これは<strong>モデルによって説明できない部分(= 残差)はこうした変数とも関連がないことを示している</strong>。</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="Chapter1.html#cb45-1" tabindex="-1"></a>hvs_b <span class="sc">%&gt;%</span> </span>
<span id="cb45-2"><a href="Chapter1.html#cb45-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">resstd =</span> <span class="fu">rstandard</span>(M3)) <span class="sc">%&gt;%</span> </span>
<span id="cb45-3"><a href="Chapter1.html#cb45-3" tabindex="-1"></a>  <span class="fu">select</span>(CC, LatAbs, FM, Illuminance, Temperature, resstd) <span class="sc">%&gt;%</span> </span>
<span id="cb45-4"><a href="Chapter1.html#cb45-4" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">names_to =</span> <span class="st">&quot;var&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;values&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb45-5"><a href="Chapter1.html#cb45-5" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> values, <span class="at">y =</span> resstd))<span class="sc">+</span></span>
<span id="cb45-6"><a href="Chapter1.html#cb45-6" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb45-7"><a href="Chapter1.html#cb45-7" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb45-8"><a href="Chapter1.html#cb45-8" tabindex="-1"></a>  <span class="fu">facet_rep_wrap</span>(<span class="sc">~</span>var, <span class="at">repeat.tick.labels =</span> <span class="cn">TRUE</span>, <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>)<span class="sc">+</span></span>
<span id="cb45-9"><a href="Chapter1.html#cb45-9" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb45-10"><a href="Chapter1.html#cb45-10" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb45-11"><a href="Chapter1.html#cb45-11" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Explanatory variables&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Standardized residuals&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-multiscatter"></span>
<img src="Introduction-to-GAM-using-R_files/figure-html/fig-multiscatter-1.png" alt="Multiple scatterplots of the standardized residuals versus each continuous variables" width="960" />
<p class="caption">
図1.12: Multiple scatterplots of the standardized residuals versus each continuous variables
</p>
</div>
<p><br/></p>
<p>これは、離散的な変数についても同様のようである(図<a href="Chapter1.html#fig:fig-multiboxplot">1.13</a>)。</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="Chapter1.html#cb46-1" tabindex="-1"></a>hvs_b <span class="sc">%&gt;%</span> </span>
<span id="cb46-2"><a href="Chapter1.html#cb46-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">resstd =</span> <span class="fu">rstandard</span>(M3)) <span class="sc">%&gt;%</span> </span>
<span id="cb46-3"><a href="Chapter1.html#cb46-3" tabindex="-1"></a>  <span class="fu">select</span>(fPopulation, fGender, resstd) <span class="sc">%&gt;%</span> </span>
<span id="cb46-4"><a href="Chapter1.html#cb46-4" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">names_to =</span> <span class="st">&quot;var&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;values&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb46-5"><a href="Chapter1.html#cb46-5" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> values, <span class="at">y =</span> resstd))<span class="sc">+</span></span>
<span id="cb46-6"><a href="Chapter1.html#cb46-6" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()<span class="sc">+</span></span>
<span id="cb46-7"><a href="Chapter1.html#cb46-7" tabindex="-1"></a>  <span class="fu">facet_rep_wrap</span>(<span class="sc">~</span>var, <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>)<span class="sc">+</span></span>
<span id="cb46-8"><a href="Chapter1.html#cb46-8" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb46-9"><a href="Chapter1.html#cb46-9" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb46-10"><a href="Chapter1.html#cb46-10" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Explanatory variables&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Standardized residuals&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-multiboxplot"></span>
<img src="Introduction-to-GAM-using-R_files/figure-html/fig-multiboxplot-1.png" alt="Boxplot of standardized residuals versus discrete variable" width="864" />
<p class="caption">
図1.13: Boxplot of standardized residuals versus discrete variable
</p>
</div>
<p><br/></p>
<p>自己相関も大きくなさそうである。</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="Chapter1.html#cb47-1" tabindex="-1"></a><span class="fu">acf</span>(hvs_b<span class="sc">$</span>OrbitalV)</span></code></pre></div>
<p><img src="Introduction-to-GAM-using-R_files/figure-html/unnamed-chunk-22-1.png" width="432" style="display: block; margin: auto;" /></p>
</div>
<div id="model-interpretation" class="section level2 hasAnchor" number="1.9">
<h2><span class="header-section-number">1.9</span> Model interpretation<a href="Chapter1.html#model-interpretation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>モデルの推定値に基づくと、眼窩容量の予測値は以下のように書ける。</p>
<p><span class="math display">\[
OrbitalV_i = 23.23 -0.25 \times LatAbs_i -0.000058 \times CC_i + 0.00022 \times LatAbs_i \times CC_i
\]</span></p>
<p>モデルに基づく回帰平面を描くと以下のようになる(図<a href="Chapter1.html#fig:fig-3dplot">1.14</a>)。</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="Chapter1.html#cb48-1" tabindex="-1"></a>data_M3 <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">LatAbs =</span> <span class="fu">seq</span>(<span class="fl">0.02</span>,<span class="dv">65</span>, <span class="at">length.out =</span> <span class="dv">100</span>),</span>
<span id="cb48-2"><a href="Chapter1.html#cb48-2" tabindex="-1"></a>                    <span class="at">CC =</span> <span class="fu">seq</span>(<span class="dv">1100</span>,<span class="dv">1700</span>, <span class="at">length.out =</span> <span class="dv">100</span>))</span>
<span id="cb48-3"><a href="Chapter1.html#cb48-3" tabindex="-1"></a></span>
<span id="cb48-4"><a href="Chapter1.html#cb48-4" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(M3, <span class="at">newdata =</span> data_M3) <span class="sc">%&gt;%</span> </span>
<span id="cb48-5"><a href="Chapter1.html#cb48-5" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb48-6"><a href="Chapter1.html#cb48-6" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">pred =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb48-7"><a href="Chapter1.html#cb48-7" tabindex="-1"></a>  <span class="fu">bind_cols</span>(data_M3) <span class="sc">%&gt;%</span> </span>
<span id="cb48-8"><a href="Chapter1.html#cb48-8" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> CC, <span class="at">values_from =</span> pred) <span class="sc">%&gt;%</span> </span>
<span id="cb48-9"><a href="Chapter1.html#cb48-9" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="dv">1</span>) </span>
<span id="cb48-10"><a href="Chapter1.html#cb48-10" tabindex="-1"></a></span>
<span id="cb48-11"><a href="Chapter1.html#cb48-11" tabindex="-1"></a><span class="fu">plot_ly</span>(hvs_b,</span>
<span id="cb48-12"><a href="Chapter1.html#cb48-12" tabindex="-1"></a>        <span class="at">x =</span> <span class="sc">~</span>LatAbs,</span>
<span id="cb48-13"><a href="Chapter1.html#cb48-13" tabindex="-1"></a>        <span class="at">y =</span> <span class="sc">~</span>CC,</span>
<span id="cb48-14"><a href="Chapter1.html#cb48-14" tabindex="-1"></a>        <span class="at">z =</span> <span class="sc">~</span>OrbitalV,</span>
<span id="cb48-15"><a href="Chapter1.html#cb48-15" tabindex="-1"></a>        <span class="at">type =</span> <span class="st">&quot;scatter3d&quot;</span>,</span>
<span id="cb48-16"><a href="Chapter1.html#cb48-16" tabindex="-1"></a>        <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb48-17"><a href="Chapter1.html#cb48-17" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">z =</span> <span class="fu">as.matrix</span>(pred),</span>
<span id="cb48-18"><a href="Chapter1.html#cb48-18" tabindex="-1"></a>            <span class="at">x =</span> <span class="fu">seq</span>(<span class="fl">0.02</span>,<span class="dv">65</span>, <span class="at">length.out =</span> <span class="dv">100</span>),</span>
<span id="cb48-19"><a href="Chapter1.html#cb48-19" tabindex="-1"></a>            <span class="at">y =</span> <span class="fu">seq</span>(<span class="dv">1100</span>,<span class="dv">1700</span>, <span class="at">length.out =</span><span class="dv">100</span>),</span>
<span id="cb48-20"><a href="Chapter1.html#cb48-20" tabindex="-1"></a>            <span class="at">type =</span> <span class="st">&quot;surface&quot;</span>) <span class="ot">-&gt;</span> p</span></code></pre></div>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="Chapter1.html#cb49-1" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;image/newplot.png&quot;</span>) </span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-3dplot"></span>
<img src="image/newplot.png" alt="Regression surface from the result of the model" width="85%" />
<p class="caption">
図1.14: Regression surface from the result of the model
</p>
</div>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent" line-spacing="2">
<div id="ref-Burnham2011" class="csl-entry">
Burnham, K. P., Anderson, D. R., &amp; Huyvaert, K. P. (2011). <span>AIC</span> model selection and multimodel inference in behavioral ecology: Some background, observations, and comparisons. <em>Behav. Ecol. Sociobiol.</em>, <em>65</em>(1), 23–35.
</div>
<div id="ref-Dunn2018" class="csl-entry">
Dunn, P. K., &amp; Smyth, G. K. (2018). <em>Generalized linear models with examples in <span>R</span></em>. Springer New York.
</div>
<div id="ref-Pearce2012" class="csl-entry">
Pearce, E., &amp; Dunbar, R. (2012). Latitudinal variation in light levels drives human visual system size. <em>Biol. Lett.</em>, <em>8</em>(1), 90–93.
</div>
<div id="ref-Zuur2010" class="csl-entry">
Zuur, A. F., Ieno, E. N., &amp; Elphick, C. S. (2010). A protocol for data exploration to avoid common statistical problems. <em>Methods Ecol. Evol.</em>, <em>1</em>(1), 3–14.
</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>説明変数(独立変数)とは、物事の原因となっている変数のこと、目的変数(応答変数)とは説明変数の影響を受けて発生した結果となっている変数のことである。今回の場合は、様々な標高など(= 説明変数)が眼窩容量(= 目的変数)に与える影響をモデリングする。<a href="Chapter1.html#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>　より正確には、F分布の50パーセンタイルが基準になるが、多くの場合その値は1に近い<span class="citation">(<a href="#ref-Dunn2018">Dunn &amp; Smyth, 2018</a>)</span>。<a href="Chapter1.html#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="Chapter0.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="sessioninfo.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
