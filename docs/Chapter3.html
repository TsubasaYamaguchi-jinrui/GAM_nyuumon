<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Technical aspects of GAM using pelagic bioluminescent organisms | Introduction to GAM using R</title>
  <meta name="description" content="3 Technical aspects of GAM using pelagic bioluminescent organisms | Introduction to GAM using R" />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Technical aspects of GAM using pelagic bioluminescent organisms | Introduction to GAM using R" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Technical aspects of GAM using pelagic bioluminescent organisms | Introduction to GAM using R" />
  
  
  

<meta name="author" content="Tsubasa Yamaguchi" />


<meta name="date" content="2023-07-31" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="Chapter2.html"/>
<link rel="next" href="sessioninfo.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.27/datatables.js"></script>
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
<link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
<link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
<script src="libs/selectize-0.12.0/selectize.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<script src="libs/plotly-binding-4.10.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="custom_style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>本稿の目的</a></li>
<li class="chapter" data-level="" data-path="Chapter0.html"><a href="Chapter0.html"><i class="fa fa-check"></i>0. パッケージの読み込み</a></li>
<li class="chapter" data-level="1" data-path="Chapter1.html"><a href="Chapter1.html"><i class="fa fa-check"></i><b>1</b> Review of multiple linear regressions</a>
<ul>
<li class="chapter" data-level="1.1" data-path="Chapter1.html"><a href="Chapter1.html#light-levels-and-size-of-the-human-visual-system"><i class="fa fa-check"></i><b>1.1</b> Light levels and size of the human visual system</a></li>
<li class="chapter" data-level="1.2" data-path="Chapter1.html"><a href="Chapter1.html#the-variables"><i class="fa fa-check"></i><b>1.2</b> The variables</a></li>
<li class="chapter" data-level="1.3" data-path="Chapter1.html"><a href="Chapter1.html#protocol-for-the-analysis"><i class="fa fa-check"></i><b>1.3</b> Protocol for the analysis</a></li>
<li class="chapter" data-level="1.4" data-path="Chapter1.html"><a href="Chapter1.html#data-exploration"><i class="fa fa-check"></i><b>1.4</b> Data exploration</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="Chapter1.html"><a href="Chapter1.html#欠損値の確認"><i class="fa fa-check"></i><b>1.4.1</b> 欠損値の確認</a></li>
<li class="chapter" data-level="1.4.2" data-path="Chapter1.html"><a href="Chapter1.html#外れ値の確認"><i class="fa fa-check"></i><b>1.4.2</b> 外れ値の確認</a></li>
<li class="chapter" data-level="1.4.3" data-path="Chapter1.html"><a href="Chapter1.html#多重共線性の確認"><i class="fa fa-check"></i><b>1.4.3</b> 多重共線性の確認</a></li>
<li class="chapter" data-level="1.4.4" data-path="Chapter1.html"><a href="Chapter1.html#目的変数と説明変数の関係の確認"><i class="fa fa-check"></i><b>1.4.4</b> 目的変数と説明変数の関係の確認</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="Chapter1.html"><a href="Chapter1.html#multiple-linear-regression"><i class="fa fa-check"></i><b>1.5</b> Multiple linear regression</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="Chapter1.html"><a href="Chapter1.html#underlying-statistical-theory"><i class="fa fa-check"></i><b>1.5.1</b> Underlying statistical theory</a>
<ul>
<li class="chapter" data-level="1.5.1.1" data-path="Chapter1.html"><a href="Chapter1.html#外れ値のチェック"><i class="fa fa-check"></i><b>1.5.1.1</b> 外れ値のチェック</a></li>
<li class="chapter" data-level="1.5.1.2" data-path="Chapter1.html"><a href="Chapter1.html#信頼区間と予測区間の算出"><i class="fa fa-check"></i><b>1.5.1.2</b> 95%信頼区間と予測区間の算出</a></li>
</ul></li>
<li class="chapter" data-level="1.5.2" data-path="Chapter1.html"><a href="Chapter1.html#multiple-linear-regression-1"><i class="fa fa-check"></i><b>1.5.2</b> Multiple linear regression</a></li>
<li class="chapter" data-level="1.5.3" data-path="Chapter1.html"><a href="Chapter1.html#fitting-the-model-in-r-and-estimate-parameters"><i class="fa fa-check"></i><b>1.5.3</b> Fitting the model in R and estimate parameters</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="Chapter1.html"><a href="Chapter1.html#finding-the-optimal-model"><i class="fa fa-check"></i><b>1.6</b> Finding the optimal model</a></li>
<li class="chapter" data-level="1.7" data-path="Chapter1.html"><a href="Chapter1.html#degree-of-freedom"><i class="fa fa-check"></i><b>1.7</b> Degree of freedom</a></li>
<li class="chapter" data-level="1.8" data-path="Chapter1.html"><a href="Chapter1.html#c1-8"><i class="fa fa-check"></i><b>1.8</b> Model validation</a></li>
<li class="chapter" data-level="1.9" data-path="Chapter1.html"><a href="Chapter1.html#model-interpretation"><i class="fa fa-check"></i><b>1.9</b> Model interpretation</a></li>
<li class="chapter" data-level="1.10" data-path="Chapter1.html"><a href="Chapter1.html#what-to-do-if-things-go-wrong"><i class="fa fa-check"></i><b>1.10</b> What to do if things go wrong</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="Chapter2.html"><a href="Chapter2.html"><i class="fa fa-check"></i><b>2</b> Introduction to additive models using deep-sea fisheries data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="Chapter2.html"><a href="Chapter2.html#impact-of-deep-sea-fisheries"><i class="fa fa-check"></i><b>2.1</b> Impact of deep-sea fisheries</a></li>
<li class="chapter" data-level="2.2" data-path="Chapter2.html"><a href="Chapter2.html#first-encounter-with-smoothers"><i class="fa fa-check"></i><b>2.2</b> First encounter with smoothers</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="Chapter2.html"><a href="Chapter2.html#applying-linear-regression"><i class="fa fa-check"></i><b>2.2.1</b> Applying linear regression</a>
<ul>
<li class="chapter" data-level="2.2.1.1" data-path="Chapter2.html"><a href="Chapter2.html#当てはめるモデル"><i class="fa fa-check"></i><b>2.2.1.1</b> 当てはめるモデル</a></li>
<li class="chapter" data-level="2.2.1.2" data-path="Chapter2.html"><a href="Chapter2.html#data-exploration-1"><i class="fa fa-check"></i><b>2.2.1.2</b> data exploration</a></li>
<li class="chapter" data-level="2.2.1.3" data-path="Chapter2.html"><a href="Chapter2.html#model-diagnosis"><i class="fa fa-check"></i><b>2.2.1.3</b> model diagnosis</a></li>
</ul></li>
<li class="chapter" data-level="2.2.2" data-path="Chapter2.html"><a href="Chapter2.html#applying-cubic-polynomials"><i class="fa fa-check"></i><b>2.2.2</b> Applying cubic polynomials</a></li>
<li class="chapter" data-level="2.2.3" data-path="Chapter2.html"><a href="Chapter2.html#a-simple-gam"><i class="fa fa-check"></i><b>2.2.3</b> A simple GAM</a></li>
<li class="chapter" data-level="2.2.4" data-path="Chapter2.html"><a href="Chapter2.html#moving-average-and-loess-smoother"><i class="fa fa-check"></i><b>2.2.4</b> Moving average and LOESS smoother</a>
<ul>
<li class="chapter" data-level="2.2.4.1" data-path="Chapter2.html"><a href="Chapter2.html#移動平均"><i class="fa fa-check"></i><b>2.2.4.1</b> 移動平均</a></li>
<li class="chapter" data-level="2.2.4.2" data-path="Chapter2.html"><a href="Chapter2.html#局所回帰loess"><i class="fa fa-check"></i><b>2.2.4.2</b> 局所回帰(LOESS)</a></li>
</ul></li>
<li class="chapter" data-level="2.2.5" data-path="Chapter2.html"><a href="Chapter2.html#packages-for-smoothing"><i class="fa fa-check"></i><b>2.2.5</b> Packages for smoothing</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="Chapter2.html"><a href="Chapter2.html#allpying-gam-in-r-using-the-mgcv-package"><i class="fa fa-check"></i><b>2.3</b> Allpying GAM in R using the mgcv package</a></li>
<li class="chapter" data-level="2.4" data-path="Chapter2.html"><a href="Chapter2.html#s2-4"><i class="fa fa-check"></i><b>2.4</b> Cross validation</a></li>
<li class="chapter" data-level="2.5" data-path="Chapter2.html"><a href="Chapter2.html#model-validation"><i class="fa fa-check"></i><b>2.5</b> Model validation</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="Chapter2.html"><a href="Chapter2.html#normality-and-homogeneity"><i class="fa fa-check"></i><b>2.5.1</b> Normality and homogeneity</a></li>
<li class="chapter" data-level="2.5.2" data-path="Chapter2.html"><a href="Chapter2.html#independence"><i class="fa fa-check"></i><b>2.5.2</b> Independence</a></li>
<li class="chapter" data-level="2.5.3" data-path="Chapter2.html"><a href="Chapter2.html#influential-observations"><i class="fa fa-check"></i><b>2.5.3</b> Influential observations</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="Chapter2.html"><a href="Chapter2.html#s2-6"><i class="fa fa-check"></i><b>2.6</b> Extending the GAM with more covariates</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="Chapter2.html"><a href="Chapter2.html#gam-with-smoother-and-a-normal-covariate"><i class="fa fa-check"></i><b>2.6.1</b> GAM with smoother and a normal covariate</a></li>
<li class="chapter" data-level="2.6.2" data-path="Chapter2.html"><a href="Chapter2.html#gam-with-interaction-terms-first-implement"><i class="fa fa-check"></i><b>2.6.2</b> GAM with interaction terms; first implement</a></li>
<li class="chapter" data-level="2.6.3" data-path="Chapter2.html"><a href="Chapter2.html#gam-with-interaction-third-implementation"><i class="fa fa-check"></i><b>2.6.3</b> GAM with interaction; third implementation</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="Chapter2.html"><a href="Chapter2.html#transforming-the-density-data"><i class="fa fa-check"></i><b>2.7</b> Transforming the density data</a></li>
<li class="chapter" data-level="2.8" data-path="Chapter2.html"><a href="Chapter2.html#allowing-for-heterogeneity"><i class="fa fa-check"></i><b>2.8</b> Allowing for heterogeneity</a></li>
<li class="chapter" data-level="2.9" data-path="Chapter2.html"><a href="Chapter2.html#transforming-and-allowing-for-heterogeinity"><i class="fa fa-check"></i><b>2.9</b> Transforming and allowing for heterogeinity</a></li>
<li class="chapter" data-level="2.10" data-path="Chapter2.html"><a href="Chapter2.html#what-to-present-in-paper"><i class="fa fa-check"></i><b>2.10</b> What to present in paper</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="Chapter3.html"><a href="Chapter3.html"><i class="fa fa-check"></i><b>3</b> Technical aspects of GAM using pelagic bioluminescent organisms</a>
<ul>
<li class="chapter" data-level="3.1" data-path="Chapter3.html"><a href="Chapter3.html#s3-1"><i class="fa fa-check"></i><b>3.1</b> Pelagic bioluminescent organism data</a></li>
<li class="chapter" data-level="3.2" data-path="Chapter3.html"><a href="Chapter3.html#s3-2"><i class="fa fa-check"></i><b>3.2</b> Lineaar regression</a></li>
<li class="chapter" data-level="3.3" data-path="Chapter3.html"><a href="Chapter3.html#polynomial-regression-model"><i class="fa fa-check"></i><b>3.3</b> Polynomial regression model</a></li>
<li class="chapter" data-level="3.4" data-path="Chapter3.html"><a href="Chapter3.html#s3-4"><i class="fa fa-check"></i><b>3.4</b> Linear spline regression</a></li>
<li class="chapter" data-level="3.5" data-path="Chapter3.html"><a href="Chapter3.html#s3-5"><i class="fa fa-check"></i><b>3.5</b> Quadratic spline regression</a></li>
<li class="chapter" data-level="3.6" data-path="Chapter3.html"><a href="Chapter3.html#s3-6"><i class="fa fa-check"></i><b>3.6</b> Cubic regression splines</a></li>
<li class="chapter" data-level="3.7" data-path="Chapter3.html"><a href="Chapter3.html#the-number-of-knots"><i class="fa fa-check"></i><b>3.7</b> The number of knots</a></li>
<li class="chapter" data-level="3.8" data-path="Chapter3.html"><a href="Chapter3.html#s3-8"><i class="fa fa-check"></i><b>3.8</b> Penalized quadratic spline regression</a></li>
<li class="chapter" data-level="3.9" data-path="Chapter3.html"><a href="Chapter3.html#other-smoothers"><i class="fa fa-check"></i><b>3.9</b> Other smoothers</a></li>
<li class="chapter" data-level="3.10" data-path="Chapter3.html"><a href="Chapter3.html#s3-10"><i class="fa fa-check"></i><b>3.10</b> Cubic smoothing spline</a></li>
<li class="chapter" data-level="3.11" data-path="Chapter3.html"><a href="Chapter3.html#summary-of-smoother-types"><i class="fa fa-check"></i><b>3.11</b> Summary of smoother types</a></li>
<li class="chapter" data-level="3.12" data-path="Chapter3.html"><a href="Chapter3.html#degree-of-freedom-of-smoother"><i class="fa fa-check"></i><b>3.12</b> Degree of freedom of smoother</a></li>
<li class="chapter" data-level="3.13" data-path="Chapter3.html"><a href="Chapter3.html#bias-variance-trade-off"><i class="fa fa-check"></i><b>3.13</b> Bias-variance trade-off</a></li>
<li class="chapter" data-level="3.14" data-path="Chapter3.html"><a href="Chapter3.html#confidence-intervals"><i class="fa fa-check"></i><b>3.14</b> Confidence intervals</a></li>
<li class="chapter" data-level="3.15" data-path="Chapter3.html"><a href="Chapter3.html#using-the-function-gam-in-mgcv"><i class="fa fa-check"></i><b>3.15</b> Using the function gam in mgcv</a></li>
<li class="chapter" data-level="3.16" data-path="Chapter3.html"><a href="Chapter3.html#the-danger-of-using-gam"><i class="fa fa-check"></i><b>3.16</b> The danger of using GAM</a></li>
<li class="chapter" data-level="3.17" data-path="Chapter3.html"><a href="Chapter3.html#additive-models-with-multiple-smoothers"><i class="fa fa-check"></i><b>3.17</b> Additive models with multiple smoothers</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="sessioninfo.html"><a href="sessioninfo.html"><i class="fa fa-check"></i>実行環境</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to GAM using R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="c3" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">3</span> Technical aspects of GAM using pelagic bioluminescent organisms<a href="Chapter3.html#c3" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>本章では、GAMの技術的な側面について説明を行う。</p>
<div id="s3-1" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Pelagic bioluminescent organism data<a href="Chapter3.html#s3-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>GAMの技術的な側面を解説するため、本章では <span class="citation">Heger et al. (<a href="#ref-Heger2008">2008</a>)</span> が2004年夏に海洋生物の発光について調べた研究を用いる。船で海洋を航行中に検出した蛍光の強度(<code>Source</code>)と、水深(<code>Depth</code>)、温度(<code>Temp</code>)、塩分(<code>Salinity</code>)、酸素(<code>Oxgen</code>)などを測定している。</p>
<p>データは14のステーションでサンプルされている。データは以下の通り。</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="Chapter3.html#cb107-1" tabindex="-1"></a>BL <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">&quot;data/HegerPierce.txt&quot;</span>)</span>
<span id="cb107-2"><a href="Chapter3.html#cb107-2" tabindex="-1"></a></span>
<span id="cb107-3"><a href="Chapter3.html#cb107-3" tabindex="-1"></a><span class="fu">datatable</span>(BL,</span>
<span id="cb107-4"><a href="Chapter3.html#cb107-4" tabindex="-1"></a>          <span class="at">options =</span> <span class="fu">list</span>(<span class="at">scrollX =</span> <span class="dv">20</span>),</span>
<span id="cb107-5"><a href="Chapter3.html#cb107-5" tabindex="-1"></a>          <span class="at">filter =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-6b66a857ca25af6f8278" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-6b66a857ca25af6f8278">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td><\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"52\" data-max=\"76\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0.683090705\" data-max=\"128.6748787\" data-scale=\"9\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"310\" data-max=\"3005\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"2.9018\" data-max=\"13.1871\" data-scale=\"4\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"34.8652\" data-max=\"35.7673\" data-scale=\"4\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"4.13694\" data-max=\"6.22987\" data-scale=\"5\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0.005\" data-max=\"0.034\" data-scale=\"4\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"42.9337\" data-max=\"53.3025\" data-scale=\"4\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"-36.7673\" data-max=\"-28.152\" data-scale=\"4\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1\" data-max=\"4\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319","320","321","322","323","324","325","326","327","328","329","330","331","332","333","334","335","336","337","338","339","340","341","342","343","344","345","346","347","348","349","350","351","352","353","354","355","356","357","358","359","360","361","362","363","364","365","366","367","368","369","370","371","372","373","374","375","376","377","378","379","380","381","382","383","384","385","386","387","388","389","390","391","392","393","394","395","396","397","398","399","400","401","402","403","404","405","406","407","408","409","410","411","412","413","414","415","416","417","418","419","420","421","422","423","424","425","426","427","428","429","430","431","432","433","434","435","436","437","438","439","440","441","442","443","444","445","446","447","448","449","450","451","452","453","454","455","456","457","458","459","460","461","462","463","464","465","466","467","468","469","470","471","472","473","474","475","476","477","478","479","480","481","482","483","484","485","486","487","488","489","490","491","492","493","494","495","496","497","498","499","500","501","502","503","504","505","506","507","508","509","510","511","512","513","514","515","516","517","518","519","520","521","522","523","524","525","526","527","528","529","530","531","532","533","534","535","536","537","538","539","540","541","542","543","544","545","546","547","548","549","550","551","552","553","554","555","556","557","558","559","560","561","562","563","564","565","566","567","568","569","570","571","572","573","574","575","576","577","578","579","580","581","582","583","584","585","586","587","588","589","590","591","592","593","594","595","596","597","598","599","600","601","602","603","604","605","606","607","608","609","610","611","612","613","614","615","616","617","618","619","620","621","622","623","624","625","626","627","628","629","630","631","632","633","634","635","636","637","638","639","640","641","642","643","644","645","646","647","648","649","650","651","652","653","654","655","656","657","658","659","660","661","662","663","664","665","666","667","668","669","670","671","672","673","674","675","676","677","678","679","680","681","682","683","684","685","686","687","688","689","690","691","692","693","694","695","696","697","698","699","700","701","702","703","704","705","706","707","708","709","710","711","712","713","714","715","716","717","718","719","720","721","722","723","724","725","726","727","728","729","730","731","732","733","734","735","736","737","738","739","740","741","742","743","744","745","746","747","748","749","750","751","752","753","754","755","756","757","758","759","760","761","762","763","764","765","766","767","768","769","770","771","772","773","774","775","776","777","778","779","780","781","782","783","784","785","786","787","788","789","790","791","792","793","794","795","796","797","798","799","800","801","802","803","804","805","806","807","808","809","810","811","812","813","814","815","816","817","818","819","820","821","822","823","824","825","826","827","828","829","830","831","832","833","834","835","836","837","838","839","840","841","842","843","844","845","846","847","848","849","850","851","852","853","854","855","856","857","858","859","860","861","862","863","864","865","866","867","868","869","870","871","872","873","874","875","876","877","878","879","880","881","882","883","884","885","886","887","888","889","890","891","892","893","894","895","896","897","898","899","900","901","902","903","904","905","906","907","908","909","910","911","912","913","914","915","916","917","918","919","920","921","922","923","924","925","926","927","928","929","930","931","932","933","934","935","936","937","938","939","940","941","942","943","944","945","946","947","948","949","950","951","952","953","954","955","956","957","958","959","960","961","962","963","964","965","966","967","968","969","970","971","972","973","974","975","976","977","978","979","980","981","982","983","984","985","986","987","988","989","990","991","992","993","994","995","996","997","998","999","1000","1001","1002","1003","1004","1005","1006","1007","1008","1009","1010","1011","1012","1013","1014","1015","1016","1017","1018","1019","1020","1021","1022","1023","1024","1025","1026","1027","1028","1029","1030","1031","1032","1033","1034","1035","1036","1037","1038","1039","1040","1041","1042","1043","1044","1045","1046","1047","1048","1049"],[52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,52,53,53,53,53,53,53,53,53,53,53,53,53,53,53,53,53,53,53,53,53,53,53,53,53,53,53,53,53,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,56,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,62,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,66,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,70,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,74,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76,76],[50.45166107,38.4173199,31.47443076,29.39156402,35.64016424,42.1201941,40.03732736,41.42590519,40.73161627,40.268757,40.268757,36.10302352,43.74020157,41.19447555,41.65733483,35.17730496,36.56588279,32.16871967,31.93729003,33.5572975,41.88876446,38.88017917,35.17730496,38.64874953,30.54871221,30.08585293,29.62299365,21.06009705,21.75438596,22.91153415,22.91153415,20.59723778,22.68010452,22.44867488,19.20865995,24.06868234,23.60582307,34.02015677,32.86300859,26.61440836,28.6972751,24.06868234,36.56588279,20.59723778,16.66293393,16.20007465,15.73721538,19.20865995,15.73721538,12.49720045,10.18290407,10.87719298,9.257185517,9.488615155,11.10862262,9.257185517,9.025755879,9.951474431,10.87719298,6.942889138,6.7114595,5.55431131,5.785740948,5.55431131,5.785740948,9.488615155,6.942889138,5.091452034,6.480029862,9.720044793,10.64576334,10.64576334,8.331466965,9.488615155,5.785740948,6.942889138,6.017170586,4.165733483,5.322881672,4.397163121,4.628592758,62.02314296,69.66032102,57.62597984,51.8402389,40.73161627,41.19447555,45.82306831,37.95446062,33.5572975,26.61440836,22.21724524,19.44008959,18.2829414,19.90294886,20.1343785,27.07726764,20.1343785,24.76297126,29.62299365,28.23441583,23.83725271,26.15154909,27.30869728,31.24300112,31.24300112,30.31728257,22.44867488,10.41433371,85.30048526,56.28966032,48.27920866,48.06270997,41.56774916,35.72228443,24.46435237,28.14483016,27.06233669,22.29936543,21.86636805,29.01082493,20.78387458,19.05188503,16.8868981,17.10339679,15.15490855,10.82493468,11.47443076,10.60843598,12.77342292,13.63941769,13.422919,13.85591639,13.20642031,10.82493468,12.77342292,13.20642031,11.90742814,14.50541247,16.8868981,14.93840985,10.1754386,12.34042553,11.47443076,11.47443076,11.47443076,10.82493468,11.47443076,11.04143337,9.958939903,9.742441209,10.39193729,14.72191116,10.1754386,8.010451661,12.55692423,9.958939903,9.525942516,9.092945129,8.226950355,9.092945129,11.04143337,8.443449048,6.061963419,8.876446435,8.226950355,5.845464726,8.443449048,6.7114595,5.195968645,6.061963419,5.845464726,4.979469951,5.628966032,4.546472564,6.061963419,6.927958193,4.546472564,5.412467339,6.278462113,5.195968645,5.412467339,5.412467339,6.927958193,4.329973871,3.68047779,6.7114595,3.68047779,4.113475177,6.927958193,8.010451661,3.896976484,4.979469951,4.546472564,4.546472564,5.195968645,4.546472564,4.762971258,5.412467339,4.979469951,5.628966032,5.628966032,7.793952968,3.896976484,4.546472564,5.628966032,4.762971258,4.113475177,5.412467339,4.762971258,3.03098171,2.597984323,3.03098171,3.68047779,3.463979097,22.68010452,21.06009705,35.17730496,46.28592758,44.43449048,44.66592012,38.64874953,43.50877193,33.09443822,49.06308324,54.61739455,60.63456514,48.13736469,37.02874207,38.88017917,40.03732736,44.43449048,45.36020903,44.43449048,38.4173199,37.95446062,36.56588279,37.26017171,35.64016424,27.54012691,31.7058604,45.59163867,44.66592012,53.691676,61.56028369,62.94886152,67.114595,62.2545726,61.32885405,49.52594252,56.70026129,46.9802165,43.50877193,34.25158641,30.78014184,26.38297872,23.37439343,25.22583053,16.66293393,15.96864502,20.82866741,13.88577828,12.03434117,15.2743561,13.65434864,13.422919,15.2743561,10.64576334,16.43150429,21.52295633,18.97723031,10.64576334,11.80291153,12.49720045,12.26577081,14.11720791,9.488615155,8.794326241,10.18290407,8.794326241,9.488615155,44.17319895,82.19858156,113.8484509,83.56476297,60.33967898,56.01343785,62.8443449,49.8656215,36.8868981,34.60992908,38.25307951,37.114595,40.30235162,41.21313923,33.24374767,35.52071669,39.61926092,31.42217245,30.05599104,33.01605077,25.0466592,27.09593132,26.64053751,26.64053751,23.22508399,19.58193356,22.08659948,18.44344905,23.90817469,22.54199328,24.3635685,21.85890258,25.95744681,26.64053751,28.00671892,26.64053751,24.13587159,25.2743561,23.68047779,17.07726764,23.45278089,17.76035834,16.62187383,12.5233296,16.84957074,14.11720791,12.0679358,12.9787234,15.02799552,14.57260172,12.0679358,14.80029862,14.80029862,19.80963046,13.43411721,13.20642031,9.563269877,11.61254199,10.47405748,7.969391564,9.107876073,7.969391564,7.969391564,10.01866368,6.375513251,6.375513251,6.375513251,5.00933184,7.058603957,5.237028742,5.692422546,6.147816349,4.781634938,7.969391564,6.375513251,5.920119448,7.51399776,6.147816349,5.237028742,7.058603957,4.098544233,5.692422546,4.098544233,8.424785368,8.197088466,4.781634938,5.692422546,2.50466592,5.692422546,7.286300859,5.00933184,4.781634938,5.237028742,4.326241135,8.197088466,6.147816349,7.058603957,8.197088466,5.00933184,4.326241135,56.23740202,74.28891377,76.37178052,47.21164614,44.43449048,39.11160881,46.28592758,54.15453527,43.50877193,37.02874207,39.57446809,28.23441583,30.31728257,34.94587533,37.26017171,38.4173199,27.77155655,31.47443076,36.79731243,34.48301605,32.40014931,34.48301605,24.53154162,31.7058604,32.63157895,27.77155655,26.61440836,31.47443076,29.39156402,22.91153415,22.21724524,24.30011198,19.09294513,31.47443076,40.268757,46.9802165,55.77454274,46.74878686,43.97163121,44.89734976,35.87159388,34.02015677,34.25158641,31.47443076,34.94587533,34.02015677,29.62299365,27.30869728,26.845838,23.60582307,26.61440836,23.83725271,24.30011198,19.90294886,20.59723778,20.36580814,14.34863755,12.26577081,12.49720045,12.49720045,13.422919,16.43150429,14.58006719,15.96864502,17.35722284,18.51437103,16.89436357,18.05151176,16.89436357,18.51437103,8.794326241,9.488615155,12.26577081,9.951474431,10.64576334,9.951474431,15.73721538,19.20865995,16.66293393,12.03434117,13.65434864,11.5714819,10.18290407,10.41433371,12.96005972,7.637178052,15.50578574,12.72863009,12.03434117,81.06009705,52.37028742,51.91489362,47.81634938,43.71780515,49.6379246,42.12392684,35.06532288,30.05599104,25.2743561,24.8189623,18.67114595,19.12653975,22.31429638,20.94811497,21.40350877,20.49272116,17.76035834,12.9787234,14.80029862,15.48338932,19.35423666,19.80963046,27.09593132,29.82829414,28.23441583,27.09593132,22.76969018,18.44344905,13.66181411,17.98805524,19.35423666,15.93878313,14.57260172,13.66181411,14.11720791,10.24636058,8.424785368,7.286300859,14.11720791,8.424785368,10.92945129,11.15714819,9.790966779,5.692422546,7.51399776,6.603210153,6.375513251,7.058603957,6.147816349,7.741694662,7.969391564,7.51399776,6.603210153,4.553938037,5.920119448,5.692422546,4.553938037,7.058603957,5.464725644,4.098544233,4.326241135,4.553938037,6.375513251,5.692422546,7.286300859,3.415453527,5.00933184,4.553938037,4.098544233,3.870847331,3.643150429,3.643150429,5.00933184,5.237028742,4.781634938,4.098544233,6.147816349,5.920119448,3.415453527,2.50466592,4.781634938,4.098544233,3.415453527,4.781634938,4.098544233,2.732362822,3.870847331,4.326241135,6.147816349,3.643150429,4.098544233,3.643150429,4.326241135,2.276969018,4.098544233,2.960059724,3.870847331,4.553938037,1.593878313,3.643150429,2.049272116,1.366181411,1.593878313,1.138484509,2.276969018,2.276969018,2.276969018,1.366181411,1.593878313,0.683090705,1.821575215,87.89100411,65.12131392,47.58865248,43.49010825,26.86823442,24.5912654,19.80963046,16.39417693,16.16648003,15.71108623,11.15714819,11.61254199,16.84957074,12.9787234,13.20642031,9.790966779,13.43411721,10.92945129,15.02799552,12.2956327,12.9787234,19.12653975,14.11720791,17.30496454,19.12653975,10.24636058,14.11720791,13.88951101,13.66181411,12.0679358,9.107876073,11.61254199,8.424785368,9.107876073,8.424785368,8.880179171,9.107876073,10.47405748,9.107876073,10.01866368,9.563269877,7.969391564,7.969391564,7.741694662,9.563269877,6.603210153,8.197088466,5.464725644,6.603210153,5.00933184,7.51399776,5.464725644,4.781634938,5.464725644,4.326241135,3.870847331,4.781634938,3.643150429,5.237028742,3.643150429,4.553938037,4.553938037,4.098544233,6.375513251,3.870847331,4.326241135,4.326241135,5.464725644,3.643150429,3.643150429,4.326241135,3.643150429,4.326241135,4.781634938,6.830907055,5.00933184,1.821575215,2.276969018,2.732362822,4.553938037,3.415453527,4.781634938,4.326241135,4.326241135,5.464725644,3.643150429,5.692422546,4.553938037,3.415453527,3.187756626,3.187756626,3.187756626,3.870847331,4.098544233,3.187756626,3.415453527,2.960059724,2.049272116,71.97461739,48.60022396,48.36879433,41.19447555,40.73161627,30.08585293,22.44867488,18.51437103,19.67151922,15.04292647,17.12579321,16.66293393,14.81149683,14.34863755,13.422919,10.18290407,15.50578574,12.72863009,14.58006719,12.26577081,11.5714819,15.50578574,13.88577828,18.2829414,13.19148936,12.26577081,17.35722284,13.422919,13.422919,14.34863755,14.58006719,12.49720045,13.88577828,9.951474431,11.34005226,10.64576334,16.89436357,9.257185517,5.322881672,7.637178052,7.405748414,8.331466965,5.785740948,5.55431131,5.322881672,5.55431131,4.860022396,4.860022396,4.397163121,5.55431131,4.397163121,4.165733483,6.7114595,5.322881672,3.240014931,2.545726017,4.628592758,7.868607689,7.174318776,2.545726017,4.165733483,6.480029862,4.397163121,5.55431131,4.860022396,4.628592758,4.165733483,4.165733483,4.397163121,3.240014931,2.545726017,2.314296379,4.628592758,3.008585293,4.628592758,128.6748787,111.3176558,75.90892124,63.64315043,49.52594252,37.49160134,30.31728257,26.845838,32.16871967,21.9858156,22.68010452,22.21724524,18.74580067,17.12579321,16.66293393,16.89436357,14.81149683,17.82008212,13.88577828,17.35722284,14.58006719,16.20007465,16.66293393,14.34863755,16.20007465,15.50578574,18.97723031,15.04292647,16.43150429,17.58865248,16.43150429,13.19148936,11.80291153,12.49720045,15.73721538,8.562896603,9.951474431,11.5714819,8.794326241,8.331466965,9.257185517,11.34005226,10.41433371,9.951474431,7.405748414,6.248600224,7.637178052,5.785740948,3.471444569,5.091452034,5.785740948,4.397163121,5.785740948,4.165733483,3.240014931,5.785740948,6.480029862,4.397163121,2.545726017,33.78872714,44.43449048,44.20306084,47.21164614,48.60022396,37.49160134,35.87159388,35.17730496,34.25158641,24.76297126,15.73721538,17.35722284,16.89436357,14.11720791,18.74580067,14.11720791,15.50578574,11.80291153,12.03434117,13.422919,12.72863009,13.19148936,14.58006719,9.951474431,9.025755879,11.5714819,9.025755879,10.41433371,12.03434117,9.951474431,11.80291153,11.80291153,9.720044793,12.96005972,9.720044793,8.100037327,7.174318776,11.80291153,5.55431131,7.405748414,6.248600224,7.637178052,6.942889138,5.55431131,4.860022396,3.702874207,4.165733483,4.860022396,3.471444569,4.397163121,4.397163121,3.934303845,3.934303845,3.008585293,2.314296379,4.397163121,3.934303845,4.165733483,3.702874207,5.55431131,5.785740948,2.777155655,4.165733483,2.777155655,2.314296379,2.082866741,3.702874207,2.545726017,3.471444569,3.240014931,4.628592758,1.388577828,2.314296379,2.777155655,3.008585293,3.702874207,2.314296379,2.314296379,2.777155655,3.702874207,2.082866741,2.082866741,0.925718552,2.777155655,2.545726017,1.388577828,2.545726017,1.388577828,68.30907055,68.53676745,66.94288914,57.83501306,49.8656215,37.3422919,28.46211273,28.46211273,17.53266144,13.66181411,17.30496454,14.34490482,16.16648003,17.53266144,13.20642031,13.43411721,11.61254199,11.15714819,12.0679358,12.7510265,11.38484509,11.15714819,13.20642031,10.24636058,14.57260172,10.92945129,13.20642031,11.8402389,13.43411721,8.197088466,11.8402389,8.424785368,10.47405748,9.563269877,4.781634938,7.058603957,8.197088466,8.197088466,3.870847331,5.237028742,5.920119448,8.880179171,6.830907055,5.692422546,3.415453527,3.643150429,5.464725644,4.781634938,2.276969018,2.50466592,5.00933184,3.643150429,3.870847331,4.553938037,4.098544233,5.692422546,3.415453527,5.920119448,3.187756626,3.870847331,5.464725644,2.276969018,3.870847331,4.326241135,4.553938037,5.237028742,5.00933184,4.781634938,5.464725644,3.643150429,2.50466592,3.187756626,2.50466592,3.643150429,2.960059724,3.415453527,2.50466592,2.049272116,4.098544233,4.553938037,1.593878313,3.643150429,2.276969018,1.366181411,2.50466592,3.187756626,2.732362822,2.732362822,2.732362822,3.187756626,3.415453527,2.276969018,0.910787607,1.593878313,1.821575215,2.732362822,2.049272116,2.049272116,2.276969018,1.593878313,2.50466592,2.960059724,2.276969018,2.50466592,2.732362822,1.366181411,1.821575215,2.049272116,0.853863386,57.85740948,59.24598731,55.77454274,44.43449048,47.67450541,34.48301605,34.94587533,29.39156402,28.00298619,23.37439343,18.97723031,20.1343785,15.73721538,15.2743561,18.05151176,11.80291153,12.49720045,10.64576334,11.34005226,11.10862262,10.18290407,8.100037327,9.257185517,9.488615155,8.794326241,7.174318776,8.100037327,11.10862262,11.10862262,8.100037327,12.72863009,9.257185517,8.100037327,7.405748414,7.637178052,7.637178052,7.868607689,7.637178052],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[310,335,360,380,405,430,455,480,500,525,550,575,600,625,650,675,695,720,745,770,795,820,845,865,890,915,940,965,990,1015,1040,1065,1085,1110,1135,1160,1185,1210,1235,1260,1285,1305,1330,1355,1380,1405,1430,1455,1480,1505,1525,1550,1575,1600,1625,1650,1675,1700,1725,1750,1770,1795,1820,1845,1870,1895,1920,1945,1965,1995,2015,2040,2065,2090,2115,2140,2165,2190,2215,2240,2265,310,335,360,380,405,430,455,480,505,530,550,575,600,625,650,675,700,725,745,770,795,820,845,870,890,915,940,965,310,335,360,385,405,430,455,480,505,525,550,575,600,625,650,675,700,725,745,770,795,820,845,870,895,920,940,965,990,1015,1040,1065,1085,1110,1135,1160,1185,1210,1235,1260,1285,1310,1330,1355,1380,1405,1430,1455,1480,1500,1525,1550,1575,1600,1625,1650,1670,1695,1720,1745,1770,1795,1820,1845,1870,1895,1915,1940,1965,1990,2015,2040,2065,2090,2115,2140,2165,2185,2210,2235,2260,2285,2310,2335,2360,2385,2410,2435,2460,2485,2510,2535,2560,2580,2605,2630,2655,2680,2705,2730,2755,2780,2805,2830,2855,2880,310,335,360,385,410,430,455,480,505,530,555,580,600,625,650,675,700,725,750,775,795,820,845,870,895,920,945,970,995,1015,1040,1065,1090,1115,1140,1165,1190,1215,1240,1265,1285,1310,1335,1360,1385,1410,1435,1460,1485,1505,1530,1555,1580,1605,1630,1655,1680,1705,1730,1755,1775,1800,1825,1850,1860,1870,310,335,360,385,405,430,455,480,505,525,550,575,600,625,650,675,700,725,745,770,795,820,845,870,895,920,945,965,990,1015,1040,1065,1090,1110,1135,1160,1185,1210,1235,1260,1285,1310,1330,1355,1380,1405,1430,1455,1480,1505,1530,1550,1575,1600,1625,1650,1675,1700,1725,1750,1775,1795,1820,1845,1870,1895,1920,1945,1970,1995,2020,2045,2065,2090,2115,2140,2165,2190,2215,2240,2265,2290,2315,2340,2365,2385,2410,2435,2460,2485,2510,2535,2560,2585,2610,2635,2660,2685,2710,2735,310,335,360,380,405,430,455,480,505,525,550,575,600,625,650,675,700,725,745,770,795,820,845,870,895,920,945,970,990,1015,1040,1065,1090,310,335,355,380,405,430,450,475,500,525,550,575,600,625,650,670,695,720,745,770,795,820,845,870,895,920,945,970,990,1015,1040,1065,1090,1115,1135,1165,1190,1215,1235,1260,1285,1310,1335,1360,1385,1410,1435,1455,1480,1505,1530,1555,1580,1605,1630,1655,310,335,360,380,405,430,455,480,505,530,555,580,605,630,655,675,700,725,750,775,800,825,845,870,895,920,945,970,995,1020,1045,1070,1090,1120,1140,1165,1195,1215,1240,1265,1290,1315,1340,1365,1390,1410,1435,1460,1485,1510,1535,1560,1585,1610,1635,1655,1680,1705,1730,1755,1780,1805,1830,1855,1880,1905,1930,1955,1980,2005,2030,2050,2075,2100,2125,2150,2175,2200,2225,2250,2275,2300,2320,2345,2370,2395,2420,2445,2470,2495,2520,2545,2570,2595,2620,2645,2670,2690,2720,2745,2765,2795,2815,2840,2865,2890,2915,2940,2965,2990,3000,3005,310,335,360,385,405,430,455,480,505,525,550,575,600,625,650,675,700,720,745,770,795,820,845,870,890,915,940,965,990,1015,1040,1060,1085,1110,1135,1160,1185,1210,1235,1260,1285,1305,1330,1355,1380,1405,1430,1455,1480,1505,1525,1550,1575,1600,1625,1650,1675,1700,1725,1745,1770,1795,1820,1845,1870,1895,1920,1945,1970,1995,2020,2040,2065,2090,2115,2140,2165,2190,2215,2240,2265,2290,2315,2335,2360,2385,2410,2435,2460,2485,2510,2535,2560,2585,2610,2630,2655,2680,310,335,360,385,405,430,455,480,505,525,550,575,600,625,650,675,700,720,745,770,795,820,845,865,890,915,940,965,990,1015,1035,1060,1085,1110,1135,1160,1185,1210,1235,1255,1280,1305,1330,1355,1380,1405,1430,1450,1475,1500,1525,1550,1575,1600,1625,1645,1670,1695,1720,1745,1770,1795,1820,1845,1870,1890,1915,1940,1965,1990,2015,2040,2065,2090,2115,310,335,360,385,405,430,455,480,505,525,550,575,600,625,650,675,700,725,745,770,795,820,845,865,890,915,940,965,990,1015,1040,1060,1085,1110,1135,1160,1185,1210,1235,1255,1280,1305,1330,1355,1380,1400,1425,1450,1475,1500,1525,1550,1575,1600,1625,1645,1670,1695,1720,310,335,360,380,405,430,455,480,500,525,550,575,600,625,650,675,700,720,745,770,795,820,840,865,880,905,930,950,975,1000,1025,1050,1075,1095,1120,1145,1170,1195,1220,1245,1270,1290,1315,1340,1365,1390,1415,1440,1465,1490,1510,1535,1560,1585,1610,1635,1655,1680,1705,1730,1755,1780,1805,1830,1855,1880,1900,1925,1950,1975,2000,2025,2050,2075,2100,2125,2150,2170,2195,2220,2245,2270,2295,2320,2345,2370,2395,2405,310,335,360,385,405,430,455,480,505,530,550,575,600,625,650,675,700,720,745,770,795,820,845,865,890,915,940,965,990,1015,1040,1060,1085,1110,1135,1160,1185,1210,1235,1255,1280,1305,1330,1355,1380,1405,1425,1450,1475,1500,1525,1550,1575,1600,1625,1645,1670,1695,1720,1745,1770,1795,1820,1845,1870,1890,1915,1940,1965,1990,2015,2040,2065,2090,2115,2140,2165,2190,2215,2240,2265,2290,2315,2340,2365,2390,2415,2440,2465,2490,2515,2540,2565,2590,2615,2640,2665,2690,2715,2740,2765,2790,2815,2840,2865,2890,2915,2940,2965,310,335,360,380,405,430,455,480,500,525,550,575,600,625,650,670,695,720,745,770,795,820,840,865,890,920,940,965,990,1015,1040,1065,1085,1110,1135,1160,1185,1210],[13.1871,13.0224,12.8085,12.6393,12.3728,12.1451,11.9836,11.7718,11.6067,11.4423,11.1734,10.9213,10.6129,10.3068,9.9867,9.8409,9.9035,9.3655,9.2245,8.7953,7.9489,7.2107,7.1619,7.2136,7.3603,7.3627,7.3806,7.1977,6.9261,6.7309,6.6163,6.4012,6.1952,6.1395,5.9321,5.8192,5.5776,5.464,5.2614,5.0264,4.9324,4.8912,4.7941,4.656,4.43,4.3637,4.2811,4.2411,4.1895,4.1539,4.1192,4.1014,4.0364,4.0079,3.9918,3.9563,3.9074,3.8529,3.8192,3.8084,3.7997,3.7944,3.7587,3.7516,3.7455,3.7313,3.7151,3.6848,3.6754,3.6231,3.6034,3.576,3.5455,3.485,3.4208,3.4202,3.3965,3.3817,3.3679,3.3353,3.3247,5.6407,5.4405,5.341,5.2544,5.1702,5.056,4.9147,4.8175,4.6544,4.4499,4.3459,4.2887,4.2251,4.1942,4.1656,4.1068,4.0419,4.0116,3.9453,3.8859,3.8556,3.8566,3.8598,3.8631,3.8566,3.8378,3.8287,3.8211,6.1697,5.7841,5.5369,5.6177,6.0621,6.2178,5.6922,5.1503,5.0331,4.9652,4.5398,4.4945,4.3146,4.2467,4.1997,4.0948,4.0268,3.983,3.9515,3.9195,3.8795,3.8493,3.8253,3.7956,3.7691,3.7478,3.7262,3.7047,3.6928,3.6673,3.6561,3.6195,3.5977,3.6032,3.5889,3.5871,3.5864,3.5789,3.551,3.5538,3.5654,3.559,3.552,3.5491,3.5448,3.528,3.5134,3.5101,3.5024,3.4769,3.4561,3.4387,3.4188,3.3961,3.3824,3.3671,3.3602,3.3486,3.3236,3.3101,3.2936,3.2785,3.2619,3.2503,3.2369,3.2259,3.2197,3.2112,3.2015,3.194,3.1813,3.172,3.1667,3.1588,3.1551,3.1486,3.1416,3.1359,3.1299,3.1231,3.1193,3.1178,3.1137,3.1081,3.1048,3.1012,3.0978,3.0832,3.0724,3.0716,3.0716,3.0702,3.0701,3.0655,3.0602,3.057,3.0565,3.053,3.0441,3.0372,3.0307,3.0301,3.0258,3.0229,3.008,2.9938,9.0058,8.4234,8.1844,8.0296,7.7301,7.3463,6.9986,6.5326,6.1961,6.0483,5.7042,5.5368,5.4218,5.2994,5.1305,4.9714,4.778,4.6091,4.5561,4.4851,4.4042,4.3393,4.2802,4.1939,4.1022,4.076,4.0534,3.9926,3.9568,3.9247,3.9057,3.881,3.8687,3.843,3.8074,3.7799,3.7523,3.7321,3.6941,3.6722,3.656,3.6485,3.6346,3.6309,3.6246,3.6164,3.6053,3.597,3.5968,3.5955,3.5944,3.5891,3.5784,3.57,3.5561,3.5422,3.527,3.5051,3.4829,3.4747,3.4642,3.4651,3.4534,3.4432,3.4401,3.4356,9.2655,8.8622,8.4817,8.1423,8.0081,7.8035,7.1018,6.8677,6.584,6.4044,6.0997,5.6838,5.58,5.2539,5.062,4.9703,4.8385,4.7527,4.6627,4.5401,4.4588,4.3746,4.282,4.2547,4.1691,4.0663,4.011,3.9982,3.9735,3.9584,3.9193,3.9093,3.8559,3.8383,3.8301,3.809,3.786,3.7398,3.7343,3.7085,3.6988,3.6798,3.6709,3.6546,3.6519,3.6438,3.624,3.6089,3.6009,3.5905,3.5812,3.5818,3.5784,3.5632,3.5432,3.5224,3.487,3.4637,3.4352,3.4109,3.3963,3.3862,3.3833,3.3612,3.335,3.3187,3.3071,3.3019,3.2887,3.2867,3.2708,3.2729,3.2662,3.2516,3.2385,3.2238,3.2186,3.2102,3.1986,3.1924,3.1888,3.1832,3.1791,3.1662,3.1502,3.1448,3.1376,3.1344,3.1267,3.1254,3.1158,3.0971,3.091,3.0871,3.0774,3.0712,3.069,3.0578,3.0453,3.018,9.1775,8.8703,8.5545,8.433,8.1422,7.8086,7.4471,7.0414,6.624,6.4441,6.1795,5.9177,5.642,5.461,5.2161,5.0784,4.9884,4.7091,4.6636,4.4857,4.3936,4.2815,4.1958,4.1675,4.1497,4.1345,4.0915,4.0146,4.0152,3.9377,3.9204,3.9228,3.9054,8.2315,7.9314,7.6756,7.2642,6.8863,6.5497,6.357,6.0954,5.745,5.4886,5.2833,5.0169,4.7535,4.6841,4.6236,4.571,4.4863,4.4299,4.4353,4.2941,4.1925,4.124,4.0796,4.0135,3.9719,3.9236,3.8801,3.8551,3.8319,3.8172,3.7824,3.7606,3.7436,3.7111,3.6962,3.6763,3.6641,3.6508,3.6365,3.634,3.6167,3.594,3.5869,3.6028,3.6028,3.5888,3.5729,3.5549,3.5447,3.5303,3.5145,3.4999,3.4765,3.4669,3.4555,3.4364,5.9283,5.8184,5.747,5.5902,5.3723,5.3227,5.102,4.9624,4.8447,4.9183,4.695,4.415,4.2576,4.1973,4.127,4.0723,4.0313,3.9828,3.9704,3.945,3.9174,3.8705,3.857,3.8285,3.8307,3.8159,3.751,3.7131,3.6869,3.661,3.6272,3.6167,3.6074,3.5966,3.5964,3.5983,3.595,3.598,3.6021,3.5982,3.5959,3.5869,3.5749,3.5674,3.5606,3.5487,3.54,3.5188,3.5059,3.4949,3.4865,3.4537,3.4346,3.4188,3.4082,3.3946,3.3803,3.3524,3.3403,3.3205,3.2946,3.2786,3.2602,3.2471,3.2365,3.22,3.2102,3.1953,3.1843,3.1768,3.1632,3.1587,3.1514,3.1436,3.1343,3.1258,3.1196,3.1146,3.096,3.0936,3.0892,3.0827,3.0829,3.0681,3.0501,3.0406,3.0387,3.0304,3.0246,3.0232,3.02,3.0148,3.0076,3.0028,3.0006,2.987,2.9856,2.9764,2.964,2.9591,2.9554,2.9479,2.946,2.9358,2.9237,2.9178,2.9165,2.9075,2.9079,2.9039,2.9035,2.9018,5.5402,5.3717,5.2686,5.1639,5.0602,4.9297,4.8211,4.7142,4.534,4.4901,4.4422,4.3483,4.2704,4.2326,4.2184,4.1223,4.0412,3.9383,3.8968,3.8228,3.7962,3.7679,3.7295,3.7057,3.6815,3.6672,3.6315,3.6314,3.6022,3.6074,3.5935,3.5584,3.5327,3.507,3.4837,3.4606,3.453,3.4218,3.3862,3.376,3.3641,3.3452,3.3257,3.3079,3.2922,3.2693,3.24,3.2199,3.2156,3.2076,3.2132,3.2387,3.2296,3.2243,3.1702,3.1597,3.1523,3.1374,3.1618,3.1327,3.1322,3.1332,3.1418,3.1144,3.1086,3.0996,3.1262,3.1076,3.1075,3.0951,3.1057,3.0997,3.1008,3.0624,3.0504,3.0541,3.0307,3.0105,3.0054,3.0042,3.006,3.003,2.9985,2.9897,2.9875,2.9835,2.9754,2.9674,2.9576,2.9445,2.9422,2.9287,2.9218,2.9165,2.9082,2.9082,2.9046,2.9033,5.5764,5.3904,5.1775,5.1253,5.0661,4.9315,4.7847,4.7176,4.6066,4.5569,4.5128,4.4196,4.3356,4.232,4.2037,4.1178,4.0127,4.0026,3.9535,3.8985,3.851,3.8198,3.7725,3.7602,3.764,3.7361,3.7201,3.6999,3.6821,3.649,3.6349,3.603,3.5651,3.5462,3.5121,3.4906,3.458,3.4322,3.4174,3.4048,3.381,3.3641,3.3377,3.3289,3.3151,3.2905,3.2574,3.243,3.2269,3.2154,3.2021,3.201,3.1927,3.1858,3.1713,3.1664,3.1631,3.1512,3.1472,3.1363,3.1315,3.1267,3.1104,3.1007,3.0796,3.0666,3.0596,3.0448,3.0388,3.0295,3.0132,3.0083,3.0056,2.9861,2.9846,5.6501,5.431,5.2948,5.2409,5.2201,5.0031,5.0089,4.9157,4.8515,4.7508,4.601,4.4696,4.3886,4.2977,4.2519,4.1363,4.0481,3.965,3.9331,3.8758,3.856,3.8244,3.8012,3.7763,3.7539,3.7351,3.7159,3.7037,3.6367,3.6247,3.5992,3.5874,3.5713,3.5422,3.5264,3.4848,3.4244,3.3787,3.3588,3.3367,3.3265,3.3165,3.3091,3.295,3.2634,3.2391,3.2346,3.2233,3.2207,3.2227,3.2216,3.2212,3.2163,3.193,3.1702,3.1683,3.1673,3.1537,3.1335,6.2288,6.0465,5.9278,5.8163,5.6744,5.4965,5.3413,5.2888,5.2005,4.9549,4.7724,4.6517,4.5348,4.4118,4.3389,4.2486,4.2293,4.1646,4.1389,4.082,4.049,3.9753,3.9441,3.8891,3.8716,3.8339,3.8147,3.8058,3.7929,3.7572,3.7405,3.7252,3.699,3.6675,3.6237,3.6051,3.586,3.5544,3.5367,3.5081,3.4924,3.4636,3.4269,3.399,3.37,3.3572,3.3474,3.3275,3.3128,3.3054,3.2888,3.28,3.2747,3.2657,3.2593,3.2504,3.2456,3.2428,3.2325,3.2158,3.2031,3.1944,3.1786,3.1607,3.146,3.1259,3.1197,3.1126,3.1084,3.1033,3.0939,3.0928,3.0884,3.0885,3.0806,3.0818,3.0755,3.0731,3.0728,3.0731,3.0752,3.0772,3.0776,3.0765,3.0767,3.0774,3.0794,3.0785,5.3457,5.1525,4.9808,4.8732,4.8372,4.7484,4.6678,4.5495,4.4091,4.3214,4.2751,4.1641,4.0911,4.0661,3.9992,3.8702,3.7894,3.8533,3.834,3.7582,3.7112,3.6636,3.6385,3.6118,3.5677,3.5606,3.6079,3.5967,3.5848,3.5966,3.5203,3.5348,3.503,3.5115,3.4641,3.4362,3.4376,3.415,3.4212,3.3792,3.3476,3.3422,3.3139,3.2861,3.2693,3.2487,3.2334,3.2084,3.1995,3.1911,3.1796,3.167,3.1593,3.1539,3.1479,3.1436,3.1419,3.1431,3.1425,3.1394,3.1233,3.1117,3.1106,3.1052,3.0935,3.0941,3.1001,3.1124,3.1323,3.1395,3.104,3.0896,3.1034,3.115,3.1185,3.1196,3.1255,3.142,3.1161,3.0968,3.0952,3.0564,3.0285,3.0271,3.0266,3.0336,3.0287,3.0274,3.0295,3.0317,3.0298,3.0276,3.0259,3.0238,3.0195,3.0188,3.0221,3.028,3.0279,3.0306,3.0312,3.0323,3.0334,3.0327,3.0318,3.022,3.0268,3.0313,3.0258,6.0625,5.5833,5.3607,5.256,5.126,5.0807,4.9602,4.9458,4.9064,4.7144,4.6186,4.4993,4.4299,4.3152,4.2131,4.1907,4.0813,4.0186,3.9677,3.9053,3.8844,3.8656,3.8455,3.8117,3.7814,3.7375,3.7318,3.6983,3.667,3.6593,3.6484,3.6254,3.5879,3.5792,3.5725,3.4886,3.4771,3.4492],[35.7673,35.7404,35.7069,35.6778,35.6359,35.6046,35.5843,35.5557,35.5334,35.5119,35.4745,35.4356,35.3907,35.3558,35.3333,35.3449,35.3881,35.3084,35.3247,35.2644,35.1292,35.0617,35.074,35.1213,35.2077,35.2245,35.2693,35.2563,35.2402,35.2221,35.2222,35.203,35.1789,35.1814,35.1612,35.1557,35.126,35.1169,35.094,35.0673,35.0582,35.0538,35.0422,35.0276,35.0054,35.0004,34.9912,34.9873,34.9826,34.9803,34.9778,34.9758,34.9717,34.9698,34.9687,34.966,34.9639,34.9595,34.9567,34.9559,34.955,34.9543,34.9508,34.9504,34.9498,34.9484,34.9468,34.9443,34.9434,34.9387,34.9371,34.9339,34.93,34.924,34.9165,34.9195,34.9195,34.9197,34.9193,34.9189,34.9196,34.8931,34.8923,34.8931,34.8945,34.8969,34.9063,34.9152,34.9168,34.9153,34.9057,34.9058,34.9062,34.9072,34.9094,34.9107,34.9109,34.9078,34.9063,34.9039,34.9018,34.9005,34.9006,34.9004,34.9006,34.9004,34.8996,34.8992,34.899,34.8972,34.8942,34.9027,34.9536,35.0367,35.0959,35.0235,34.9655,34.9608,34.9636,34.9172,34.917,34.9051,34.9011,34.9002,34.8936,34.8913,34.8901,34.8894,34.8892,34.8895,34.8894,34.8896,34.8887,34.8868,34.8875,34.8874,34.8871,34.8865,34.8838,34.8838,34.8806,34.8801,34.8839,34.8853,34.8863,34.8895,34.8904,34.8881,34.8899,34.8926,34.895,34.8959,34.8969,34.8973,34.8982,34.8982,34.8982,34.8988,34.8981,34.8974,34.8972,34.8962,34.8956,34.8953,34.8949,34.8946,34.8942,34.8936,34.8934,34.893,34.8928,34.8927,34.8922,34.8924,34.8929,34.8931,34.8938,34.894,34.8945,34.8964,34.8974,34.8981,34.8991,34.9,34.9003,34.9016,34.9028,34.904,34.9052,34.906,34.9063,34.9074,34.9086,34.9104,34.9117,34.913,34.9143,34.9156,34.9161,34.9168,34.9173,34.9178,34.919,34.9205,34.9212,34.9236,34.9249,34.9256,34.9266,34.9281,34.9298,34.9307,34.9311,34.9325,34.9347,35.1041,35.0378,35.0176,35.0184,35.0074,34.9871,34.9665,34.9307,34.9286,34.9257,34.92,34.9159,34.9171,34.9213,34.9229,34.923,34.9146,34.9157,34.9184,34.9182,34.9158,34.9149,34.9127,34.9084,34.9051,34.9045,34.9038,34.9009,34.8996,34.8991,34.899,34.8974,34.8969,34.8955,34.8934,34.892,34.8906,34.8895,34.8872,34.8861,34.8855,34.8863,34.8866,34.8869,34.8874,34.8878,34.8893,34.8917,34.8926,34.8945,34.8958,34.8968,34.8979,34.8985,34.8988,34.8989,34.8988,34.8983,34.8978,34.8975,34.8971,34.8972,34.8969,34.8965,34.8964,34.8962,35.1376,35.0827,35.0355,35.0104,35.01,35.0098,34.9462,34.9449,34.9375,34.9286,34.9297,34.9213,34.9199,34.9197,34.9167,34.9144,34.912,34.9176,34.9228,34.9199,34.9184,34.9144,34.9115,34.911,34.9067,34.9,34.8987,34.8985,34.9006,34.9009,34.8991,34.8984,34.8955,34.8953,34.8959,34.8945,34.8934,34.8918,34.8922,34.8916,34.8916,34.8916,34.8923,34.8908,34.8929,34.8933,34.8937,34.8944,34.895,34.8958,34.8965,34.897,34.8986,34.8988,34.8987,34.8986,34.898,34.8975,34.8969,34.8963,34.8959,34.8957,34.8957,34.8954,34.895,34.8949,34.8948,34.8948,34.8948,34.8949,34.8954,34.8956,34.8961,34.8962,34.8957,34.8958,34.8963,34.897,34.8979,34.8985,34.8991,34.8996,34.9012,34.9026,34.9046,34.9054,34.9064,34.9071,34.9085,34.9088,34.9101,34.9118,34.9129,34.9135,34.9146,34.9154,34.9159,34.9171,34.9186,34.9211,35.1244,35.0873,35.0533,35.0463,35.0296,35.0196,34.9926,34.9637,34.9464,34.9392,34.9307,34.9222,34.922,34.9214,34.9224,34.9221,34.9209,34.9198,34.9189,34.9161,34.9144,34.9115,34.9089,34.9074,34.9072,34.9064,34.9056,34.9038,34.9043,34.9026,34.9023,34.9023,34.9021,35.0108,34.996,34.9885,34.9612,34.9409,34.925,34.9239,34.9265,34.9,34.8932,34.8946,34.8923,34.8943,34.8979,34.8993,34.8994,34.8986,34.8982,34.9061,34.9021,34.8992,34.8971,34.896,34.8952,34.8962,34.8978,34.896,34.895,34.894,34.8938,34.8926,34.8927,34.8926,34.8916,34.8913,34.8911,34.891,34.8912,34.8918,34.892,34.8922,34.8925,34.8936,34.8955,34.897,34.8968,34.8976,34.8981,34.898,34.8981,34.8984,34.8982,34.898,34.8979,34.8975,34.897,34.8652,34.8991,34.9111,34.9157,34.9166,34.9409,34.9249,34.9243,34.9365,34.9695,34.9515,34.9209,34.9063,34.9059,34.9013,34.8982,34.8968,34.8943,34.8968,34.898,34.8984,34.8964,34.8955,34.8939,34.8968,34.8962,34.8899,34.8884,34.8872,34.8864,34.883,34.8836,34.884,34.8854,34.8868,34.8884,34.8899,34.8919,34.8946,34.8957,34.8963,34.8979,34.8992,34.901,34.9014,34.9017,34.9026,34.9011,34.9008,34.901,34.9019,34.9003,34.8998,34.8985,34.8978,34.8973,34.8966,34.8962,34.8959,34.8955,34.8939,34.8928,34.8923,34.8923,34.8925,34.891,34.8911,34.8913,34.8915,34.8921,34.8927,34.8934,34.8949,34.8962,34.8979,34.8996,34.9007,34.9019,34.905,34.9055,34.9065,34.9069,34.9068,34.9079,34.9099,34.9102,34.9116,34.9122,34.9132,34.9139,34.9143,34.9146,34.9152,34.9159,34.9172,34.9199,34.9203,34.9208,34.9214,34.9219,34.9227,34.9231,34.9236,34.924,34.9239,34.9244,34.9246,34.9254,34.9258,34.9262,34.9262,34.9264,34.9151,34.9199,34.9324,34.9399,34.9397,34.9376,34.9397,34.9354,34.9182,34.9243,34.9255,34.9214,34.9188,34.9191,34.9266,34.9189,34.9145,34.9032,34.9032,34.8967,34.8972,34.8976,34.897,34.8989,34.8974,34.8995,34.8977,34.9008,34.8995,34.9039,34.9052,34.9029,34.9026,34.9027,34.9027,34.9021,34.9031,34.9016,34.8998,34.9001,34.9019,34.9,34.8993,34.8991,34.8993,34.8999,34.8999,34.9,34.9022,34.903,34.9055,34.9125,34.9158,34.9181,34.9125,34.9145,34.9167,34.9174,34.924,34.9223,34.925,34.9297,34.9352,34.9347,34.936,34.938,34.9477,34.9472,34.9503,34.9534,34.9575,34.9576,34.9608,34.9591,34.962,34.964,34.9634,34.9634,34.9642,34.9669,34.9687,34.9703,34.9715,34.9725,34.9744,34.9751,34.9754,34.9759,34.9761,34.9765,34.9768,34.9766,34.9766,34.9765,34.9769,34.977,34.9771,34.977,34.9275,34.9254,34.9266,34.9371,34.9356,34.9294,34.9268,34.9305,34.9285,34.9275,34.9279,34.9262,34.9244,34.9249,34.9253,34.9217,34.9143,34.9134,34.9115,34.91,34.9082,34.9081,34.9063,34.9075,34.9102,34.91,34.9106,34.9104,34.9106,34.9111,34.9108,34.9098,34.9095,34.9108,34.9094,34.909,34.9076,34.9071,34.9073,34.9081,34.908,34.9085,34.9095,34.9097,34.9116,34.9114,34.9098,34.9111,34.9141,34.9164,34.9182,34.9203,34.9223,34.9231,34.9249,34.9259,34.9287,34.9312,34.9363,34.9422,34.9478,34.9506,34.9539,34.9572,34.9605,34.9624,34.964,34.9666,34.9682,34.9698,34.9722,34.9733,34.9739,34.975,34.9751,34.9336,34.9311,34.9372,34.9453,34.9557,34.9456,34.9577,34.9584,34.9571,34.9544,34.948,34.9397,34.9342,34.9305,34.9331,34.9277,34.9201,34.9167,34.9162,34.9153,34.9144,34.9176,34.9164,34.9146,34.9154,34.9156,34.9153,34.9145,34.9105,34.9107,34.9094,34.9095,34.9113,34.9096,34.9101,34.9083,34.9075,34.9054,34.9043,34.9028,34.9026,34.9027,34.9049,34.9044,34.9042,34.904,34.9051,34.9054,34.91,34.9115,34.9151,34.9173,34.9182,34.9207,34.925,34.9257,34.9272,34.9324,34.9417,34.9618,34.9733,34.9787,34.9853,34.9843,34.9777,34.9794,34.9787,34.9764,34.9673,34.9546,34.9476,34.9382,34.933,34.9308,34.9266,34.9295,34.9262,34.9273,34.9247,34.9252,34.9218,34.922,34.92,34.9199,34.9177,34.9179,34.9202,34.9201,34.921,34.9207,34.9198,34.9191,34.9178,34.9163,34.9167,34.9175,34.9167,34.9172,34.9166,34.9167,34.9165,34.917,34.9181,34.9172,34.9178,34.9199,34.9254,34.9287,34.9304,34.9346,34.9378,34.9396,34.9424,34.9444,34.9465,34.9482,34.9526,34.9548,34.9579,34.9601,34.9615,34.9632,34.9661,34.9676,34.9695,34.9705,34.9711,34.9714,34.9721,34.9726,34.9731,34.9737,34.9735,34.9743,34.9746,34.9748,34.975,34.975,34.9751,34.9752,34.9753,34.9752,34.9749,34.9751,34.9752,34.9753,34.9752,34.9029,34.9089,34.8996,34.9033,34.9103,34.9104,34.9122,34.9192,34.9141,34.9109,34.9103,34.9026,34.902,34.9044,34.9,34.885,34.88,34.894,34.894,34.887,34.8855,34.8815,34.881,34.8789,34.8766,34.878,34.8909,34.8932,34.8956,34.9014,34.8937,34.8989,34.896,34.9013,34.8977,34.896,34.9005,34.8994,34.9036,34.9001,34.8988,34.8994,34.8977,34.8968,34.8968,34.8962,34.8965,34.8947,34.8964,34.8961,34.8971,34.8991,34.9,34.9015,34.9032,34.9047,34.908,34.9109,34.9132,34.9163,34.9173,34.9193,34.92,34.9218,34.9256,34.9263,34.9288,34.9333,34.9403,34.9458,34.9417,34.9412,34.9458,34.9509,34.9524,34.954,34.9559,34.9613,34.958,34.9569,34.9583,34.9549,34.9527,34.9537,34.9545,34.9571,34.957,34.9583,34.9594,34.9603,34.9613,34.962,34.9624,34.9626,34.963,34.964,34.9654,34.9676,34.9688,34.9691,34.9697,34.9701,34.9708,34.9711,34.9714,34.9697,34.9708,34.9715,34.9706,34.9672,34.9214,34.9194,34.9213,34.9273,34.9287,34.9315,34.9449,34.9554,34.948,34.9456,34.9415,34.938,34.9275,34.923,34.9221,34.9175,34.9163,34.9139,34.9123,34.9123,34.9132,34.9138,34.9126,34.9127,34.9124,34.9122,34.9113,34.9107,34.911,34.911,34.9107,34.9103,34.9104,34.9097,34.9098,34.9101,34.9098],[5.18181,5.17089,4.99763,5.0478,5.04343,4.92832,4.89,4.76505,4.70517,4.66618,4.72733,4.8269,4.79493,4.67654,4.49721,4.27366,4.19711,4.14735,4.13695,4.2016,4.37708,4.50779,4.53948,4.52943,4.50502,4.50354,4.52422,4.56929,4.65319,4.73863,4.78787,4.85592,4.93976,4.97637,5.04984,5.09337,5.17937,5.2456,5.31407,5.40536,5.44672,5.47014,5.49098,5.54362,5.62153,5.66482,5.70161,5.71839,5.73476,5.74119,5.75483,5.76164,5.7725,5.78355,5.7872,5.79455,5.80313,5.8194,5.83191,5.83995,5.84329,5.84356,5.85519,5.86,5.86092,5.86403,5.86955,5.88212,5.8885,5.90306,5.91333,5.92686,5.94147,5.96673,6.0085,5.99513,5.99548,5.9843,5.98835,5.99284,5.98238,5.21682,5.29838,5.31948,5.35779,5.37072,5.38949,5.45761,5.4924,5.59311,5.70592,5.7837,5.82227,5.84903,5.88147,5.89799,5.93688,5.9762,5.98987,6.03021,6.05453,6.07145,6.07051,6.06911,6.07126,6.06939,6.0822,6.08407,6.0872,5.12827,5.18913,5.23303,5.21375,4.98151,4.91964,5.05796,5.26541,5.36038,5.38353,5.61127,5.67778,5.75364,5.82003,5.85667,5.91678,5.98063,6.00893,6.03159,6.05262,6.07653,6.09343,6.10533,6.12038,6.13778,6.1582,6.15507,6.16495,6.1664,6.18889,6.19902,6.21822,6.2182,6.20717,6.20629,6.19874,6.18435,6.17684,6.18883,6.1816,6.16975,6.15189,6.14199,6.13625,6.13059,6.12912,6.12332,6.12601,6.12212,6.12682,6.13245,6.13685,6.14465,6.15023,6.15474,6.15776,6.16111,6.1636,6.17087,6.17618,6.1788,6.18468,6.19035,6.19742,6.19866,6.19683,6.196,6.19423,6.19476,6.1972,6.18705,6.18184,6.17948,6.17376,6.17257,6.17152,6.17007,6.16475,6.16201,6.15406,6.15057,6.14501,6.14181,6.13532,6.13224,6.12548,6.12319,6.11309,6.10438,6.1004,6.09802,6.09627,6.09448,6.08983,6.08635,6.08149,6.08129,6.07683,6.07224,6.06514,6.06181,6.0558,6.04834,6.04439,6.03618,6.0227,5.40257,5.16645,5.09081,4.95789,4.84688,4.83014,4.85106,4.91414,4.99607,5.01094,5.08203,5.18288,5.22316,5.26599,5.33634,5.41501,5.51649,5.61541,5.64948,5.6883,5.73865,5.77504,5.8129,5.86339,5.91502,5.94562,5.96045,5.99618,6.01789,6.03488,6.04479,6.06215,6.07109,6.08904,6.10362,6.12206,6.14027,6.15171,6.17446,6.18898,6.18926,6.18682,6.18623,6.18477,6.18449,6.18342,6.18103,6.16831,6.16138,6.15413,6.148,6.14035,6.1349,6.12711,6.12323,6.12308,6.12321,6.12944,6.13351,6.13378,6.13532,6.13832,6.13705,6.14096,6.13799,6.13749,5.50726,5.36913,5.27461,5.08466,4.94356,4.86307,4.8774,4.89044,4.8802,4.93135,4.9898,5.09535,5.15623,5.26405,5.38253,5.43644,5.50641,5.54556,5.58475,5.64494,5.70552,5.74741,5.80785,5.83397,5.87908,5.94698,5.98621,6.00181,6.01205,6.02158,6.04018,6.04865,6.07339,6.08709,6.08881,6.0994,6.11067,6.13,6.13626,6.14701,6.15035,6.15494,6.1533,6.15332,6.14849,6.14665,6.14643,6.14618,6.14659,6.13948,6.13833,6.13331,6.12699,6.12222,6.12249,6.12439,6.12962,6.13694,6.14403,6.14726,6.15633,6.15559,6.15858,6.16414,6.16786,6.17132,6.17635,6.1774,6.17695,6.17782,6.17971,6.17807,6.17333,6.17398,6.18527,6.18714,6.18632,6.18507,6.18625,6.184,6.17929,6.1756,6.16876,6.15874,6.15293,6.14936,6.13937,6.13368,6.12993,6.12716,6.12049,6.11004,6.10252,6.09801,6.09087,6.08498,6.08124,6.0766,6.06885,6.05394,5.46341,5.36567,5.20473,5.10097,4.9688,4.84527,4.81465,4.82853,4.87235,4.90433,4.96524,5.0624,5.146,5.20225,5.28657,5.37029,5.41358,5.54833,5.58942,5.69196,5.74123,5.81345,5.86885,5.88462,5.89531,5.90702,5.9253,5.95364,5.97262,6.00264,6.01407,6.01553,6.0217,5.12091,5.00396,4.85084,4.88146,4.88046,4.95146,4.97276,4.94737,5.09233,5.23041,5.28606,5.45132,5.56554,5.61079,5.63699,5.65764,5.70616,5.74298,5.74135,5.78022,5.8592,5.91313,5.95598,5.98534,6.01249,6.01909,6.05081,6.06593,6.08467,6.09251,6.10993,6.119,6.12627,6.1414,6.14477,6.14986,6.15311,6.15321,6.15576,6.15375,6.15401,6.15436,6.16739,6.14757,6.13025,6.12888,6.1301,6.12891,6.12755,6.1273,6.12987,6.1308,6.13145,6.13579,6.13561,6.14121,5.15592,5.10704,5.09753,5.14433,5.25684,5.26759,5.35137,5.41708,5.44844,5.41573,5.5193,5.69722,5.81733,5.85587,5.89955,5.94408,5.98128,6.00718,6.02176,6.03388,6.04289,6.06911,6.08171,6.11075,6.10766,6.11148,6.14406,6.17411,6.18896,6.19527,6.21565,6.22831,6.22381,6.22142,6.21709,6.20504,6.20403,6.19417,6.17459,6.16592,6.15869,6.14932,6.14257,6.13624,6.12637,6.12641,6.11943,6.12161,6.13181,6.13236,6.12284,6.12257,6.12669,6.13959,6.14482,6.14708,6.15003,6.15467,6.16087,6.16473,6.17518,6.18379,6.19425,6.19998,6.19886,6.20431,6.201,6.21191,6.21482,6.2156,6.21479,6.21063,6.20787,6.20444,6.19731,6.19204,6.1851,6.1845,6.17125,6.1631,6.16072,6.15306,6.15057,6.14531,6.13461,6.12545,6.12615,6.12354,6.11672,6.11062,6.11089,6.10666,6.10313,6.10033,6.09301,6.08271,6.08033,6.07699,6.07376,6.0697,6.06881,6.06748,6.0628,6.06168,6.06013,6.05533,6.05058,6.04975,6.0474,6.04619,6.04627,6.03825,5.42496,5.41302,5.37759,5.37017,5.37724,5.40706,5.4651,5.49709,5.57074,5.59965,5.632,5.66972,5.71713,5.75278,5.75269,5.79926,5.85302,5.91846,5.95986,6.01678,6.03859,6.04962,6.03658,6.04744,6.07034,6.06139,6.07861,6.06662,6.0774,6.06196,6.05863,6.06812,6.07714,6.08947,6.0939,6.1053,6.10368,6.11221,6.1322,6.13865,6.13492,6.1446,6.15461,6.16596,6.16917,6.17511,6.18294,6.18642,6.18451,6.18151,6.1781,6.16979,6.15416,6.14839,6.14982,6.15335,6.14903,6.13972,6.12886,6.12675,6.12583,6.11348,6.10333,6.09952,6.09743,6.09043,6.07944,6.07377,6.07087,6.06369,6.05977,6.05803,6.05145,6.05296,6.04833,6.04327,6.04297,6.04126,6.03841,6.03479,6.03188,6.03022,6.02924,6.02593,6.02457,6.02353,6.02367,6.02328,6.02189,6.02175,6.01822,6.01902,6.01478,6.01392,6.0117,6.01027,6.00971,6.00712,5.36674,5.34947,5.35171,5.33864,5.34984,5.38371,5.44854,5.46086,5.51555,5.53674,5.56244,5.61258,5.66318,5.7204,5.75171,5.78742,5.86345,5.87149,5.90041,5.9296,5.95078,5.97084,5.98895,5.99677,5.9819,5.98937,5.99007,5.99553,6.00301,6.01272,6.01644,6.03026,6.0481,6.05394,6.06892,6.07645,6.09361,6.10736,6.10968,6.11478,6.12473,6.12977,6.13794,6.14192,6.14533,6.14955,6.15971,6.161,6.15946,6.15189,6.1483,6.14479,6.13814,6.13522,6.13286,6.12825,6.12089,6.11629,6.10688,6.09792,6.08923,6.07887,6.07294,6.06463,6.06112,6.05684,6.05392,6.04813,6.04737,6.04387,6.0437,6.04013,6.04013,6.03544,6.03453,5.32288,5.31631,5.32633,5.32,5.30114,5.38003,5.35276,5.39017,5.42828,5.46727,5.54034,5.61758,5.65897,5.70326,5.74236,5.78876,5.85587,5.89846,5.91915,5.93881,5.95313,5.97169,5.96584,5.97774,5.98833,5.99002,6.00128,6.00415,6.03675,6.04259,6.04797,6.0552,6.06031,6.06933,6.07422,6.09534,6.11346,6.13669,6.1472,6.15557,6.16257,6.16266,6.16563,6.17057,6.17732,6.18388,6.18644,6.18806,6.17557,6.17046,6.16293,6.15553,6.15212,6.14842,6.14285,6.13553,6.13387,6.12609,6.10668,5.3183,5.22214,5.1584,5.11239,5.10701,5.142,5.18006,5.20064,5.22586,5.31063,5.41701,5.49544,5.54483,5.61497,5.66619,5.70349,5.73591,5.76492,5.78731,5.815,5.83875,5.87155,5.88929,5.91054,5.92111,5.93557,5.94454,5.94859,5.95192,5.96407,5.97621,5.98016,5.9913,6.00368,6.01785,6.02778,6.03867,6.05137,6.05919,6.07107,6.08175,6.0888,6.10436,6.11419,6.11975,6.12798,6.12609,6.12685,6.11839,6.11595,6.11028,6.10742,6.09956,6.09504,6.08839,6.0836,6.0819,6.07216,6.06883,6.06391,6.05895,6.05541,6.05017,6.05172,6.04535,6.04297,6.04258,6.04056,6.03899,6.03873,6.03939,6.03441,6.0334,6.03135,6.03167,6.03136,6.03059,6.02832,6.02856,6.02897,6.02814,6.02572,6.02577,6.02433,6.02434,6.02313,6.02169,6.02299,5.68721,5.57427,5.59459,5.59156,5.58064,5.59719,5.6008,5.61141,5.69692,5.76474,5.7642,5.82793,5.86815,5.91601,5.96265,6.02379,6.12029,6.07614,6.06496,6.12432,6.12142,6.16028,6.18405,6.2067,6.22471,6.21944,6.18018,6.13961,6.17187,6.09956,6.15075,6.12123,6.14079,6.12223,6.14549,6.15703,6.14694,6.15147,6.14157,6.1542,6.17776,6.17992,6.18792,6.19975,6.20721,6.21451,6.2162,6.22259,6.2224,6.22889,6.22987,6.22057,6.21667,6.209,6.20468,6.20102,6.18902,6.18138,6.17489,6.16454,6.16252,6.15482,6.14844,6.14516,6.13719,6.13185,6.12571,6.11587,6.10154,6.0916,6.09223,6.09352,6.08524,6.0753,6.06987,6.06784,6.06552,6.05954,6.06129,6.06201,6.06192,6.06044,6.05898,6.05578,6.05234,6.05099,6.049,6.04684,6.0467,6.04494,6.04542,6.04404,6.0424,6.03987,6.03862,6.03756,6.03768,6.03621,6.03448,6.03312,6.03266,6.03189,6.03207,6.02999,6.02963,6.02775,6.02812,6.02563,6.02789,5.28532,5.37025,5.37511,5.35634,5.35477,5.36392,5.38367,5.38144,5.37922,5.44831,5.51578,5.58423,5.61957,5.6893,5.75244,5.76709,5.83218,5.86782,5.90417,5.92923,5.94938,5.95061,5.95623,5.97355,5.98132,5.99328,5.99763,6.00406,6.01888,6.02459,6.0278,6.03771,6.04561,6.05598,6.06001,6.09067,6.0993,6.10661],[0.0116,0.0098,0.0088,0.0097,0.0061,0.0085,0.0099,0.0097,0.0079,0.0117,0.0096,0.0095,0.0116,0.0183,0.0133,0.0104,0.0103,0.0115,0.0134,0.01,0.0138,0.0122,0.0142,0.0113,0.0099,0.0091,0.0111,0.0126,0.0107,0.0129,0.0096,0.0109,0.0156,0.0093,0.0116,0.0128,0.0134,0.0111,0.0145,0.0104,0.0106,0.0065,0.0107,0.015,0.0112,0.0125,0.0122,0.0098,0.014,0.015,0.0116,0.01,0.0116,0.0121,0.0127,0.0116,0.0136,0.0132,0.0136,0.0088,0.0103,0.0097,0.0119,0.0103,0.0091,0.0133,0.0112,0.0111,0.0114,0.0119,0.0065,0.0142,0.0069,0.0101,0.0118,0.0092,0.0082,0.01,0.0092,0.0132,0.0111,0.017,0.0158,0.0126,0.0163,0.0145,0.0118,0.0123,0.0138,0.0135,0.0147,0.0148,0.0156,0.0137,0.0137,0.0133,0.0171,0.0138,0.0125,0.0084,0.0106,0.0146,0.0096,0.011,0.0116,0.0142,0.0118,0.0142,0.0143,0.0151,0.0158,0.0163,0.0176,0.0155,0.016,0.0173,0.0201,0.0203,0.0195,0.0171,0.0172,0.016,0.0134,0.0149,0.0171,0.0128,0.0122,0.0158,0.0121,0.0134,0.0121,0.0137,0.0149,0.0122,0.0152,0.0134,0.0105,0.0148,0.0127,0.0158,0.0082,0.0127,0.0105,0.0127,0.0143,0.0118,0.0121,0.0104,0.0117,0.0156,0.0086,0.014,0.0094,0.0149,0.0128,0.0125,0.0104,0.0134,0.0111,0.0085,0.0142,0.0129,0.0143,0.0109,0.0137,0.0123,0.0122,0.0133,0.0125,0.0113,0.0131,0.0137,0.0109,0.0094,0.0113,0.0121,0.0098,0.0125,0.011,0.0107,0.0126,0.0127,0.0109,0.0107,0.0095,0.0103,0.0103,0.0095,0.013,0.0076,0.0139,0.0106,0.0094,0.0101,0.0125,0.0139,0.0102,0.0112,0.0121,0.0144,0.0131,0.0092,0.0097,0.01,0.0129,0.012,0.009,0.0112,0.0141,0.0132,0.0082,0.0131,0.0099,0.0127,0.0114,0.0223,0.0216,0.0214,0.0158,0.0198,0.0159,0.0171,0.0183,0.0176,0.0203,0.0202,0.0188,0.021,0.017,0.0157,0.016,0.0193,0.0148,0.0167,0.0156,0.0135,0.0182,0.0203,0.0161,0.0152,0.0135,0.015,0.0158,0.015,0.0187,0.0117,0.015,0.02,0.0134,0.0169,0.0153,0.0119,0.0146,0.0135,0.0114,0.0144,0.012,0.0128,0.013,0.0106,0.0113,0.016,0.0138,0.0135,0.0121,0.011,0.0145,0.0136,0.0116,0.0136,0.0138,0.0139,0.0101,0.0093,0.0126,0.0113,0.0138,0.0131,0.0107,0.0121,0.0122,0.0228,0.0216,0.0174,0.0203,0.0173,0.015,0.019,0.0149,0.0193,0.0163,0.0167,0.0172,0.0169,0.0187,0.0174,0.0166,0.0133,0.0179,0.0188,0.0176,0.015,0.0181,0.0152,0.013,0.0167,0.0155,0.0165,0.015,0.0137,0.0148,0.0182,0.0152,0.0142,0.0138,0.0107,0.0136,0.0122,0.0112,0.0154,0.0125,0.0122,0.0133,0.0153,0.0119,0.0137,0.0124,0.0135,0.011,0.0109,0.0122,0.0082,0.0129,0.012,0.0153,0.0122,0.0128,0.0118,0.0115,0.0108,0.011,0.0146,0.0109,0.0132,0.0102,0.0106,0.013,0.0087,0.0081,0.012,0.0125,0.0149,0.0107,0.0107,0.0091,0.0116,0.0109,0.0145,0.0122,0.0095,0.013,0.0139,0.0112,0.0127,0.0123,0.0123,0.0124,0.0139,0.0121,0.0086,0.0121,0.0132,0.0127,0.0106,0.0161,0.0109,0.0122,0.0138,0.0142,0.0143,0.012,0.0205,0.0237,0.0182,0.0173,0.0205,0.0159,0.0174,0.019,0.0165,0.0205,0.0229,0.0132,0.0175,0.0161,0.0159,0.0146,0.0157,0.0146,0.0147,0.0178,0.0139,0.0164,0.0153,0.0129,0.0178,0.0173,0.0147,0.0161,0.0154,0.0158,0.0148,0.0139,0.0152,0.0255,0.0217,0.0245,0.0176,0.021,0.0167,0.0205,0.0179,0.0206,0.0178,0.016,0.0174,0.0137,0.0177,0.0157,0.0134,0.0162,0.0132,0.0133,0.0135,0.0135,0.0174,0.0159,0.0118,0.0127,0.0118,0.0105,0.0086,0.0117,0.0137,0.0158,0.0156,0.0118,0.0163,0.0155,0.0149,0.0132,0.0104,0.0156,0.0144,0.0086,0.0117,0.0152,0.0124,0.0122,0.0137,0.016,0.0138,0.0158,0.0083,0.0084,0.0118,0.0118,0.0117,0.0136,0.0119,0.0174,0.016,0.0163,0.0134,0.0164,0.0148,0.0165,0.0155,0.017,0.0174,0.0137,0.0142,0.0161,0.0147,0.0112,0.0132,0.0122,0.015,0.0153,0.0136,0.0125,0.0107,0.0133,0.0111,0.0149,0.0137,0.0123,0.0143,0.01,0.0132,0.0097,0.0133,0.0153,0.0114,0.0125,0.0132,0.0111,0.0108,0.0138,0.0153,0.0137,0.0116,0.011,0.0119,0.0138,0.0111,0.0121,0.013,0.0116,0.0115,0.0112,0.0131,0.0095,0.0085,0.0102,0.0142,0.0116,0.0102,0.012,0.0101,0.009,0.0125,0.0102,0.0114,0.0095,0.0132,0.0106,0.0108,0.0096,0.0102,0.0121,0.0088,0.0136,0.0102,0.0095,0.0128,0.0093,0.0109,0.0096,0.0116,0.0095,0.011,0.0122,0.0124,0.0113,0.0153,0.01,0.0103,0.0124,0.0112,0.0157,0.0118,0.0112,0.0127,0.0148,0.012,0.0117,0.0109,0.0116,0.0102,0.0138,0.0133,0.0118,0.0152,0.0148,0.0112,0.0108,0.013,0.0109,0.0113,0.0139,0.0118,0.0138,0.0169,0.0137,0.0161,0.0189,0.0117,0.0106,0.0138,0.0117,0.0174,0.0112,0.0112,0.0164,0.0145,0.0103,0.0135,0.0152,0.0144,0.0154,0.0148,0.0121,0.0155,0.0158,0.0097,0.0108,0.0117,0.0093,0.005,0.0113,0.011,0.0139,0.0135,0.0119,0.0115,0.009,0.0104,0.0136,0.0093,0.0099,0.0104,0.0125,0.0128,0.0115,0.0113,0.0125,0.0155,0.0117,0.0118,0.0125,0.0131,0.0101,0.0147,0.0125,0.0117,0.012,0.0121,0.0115,0.013,0.0136,0.0145,0.0132,0.0121,0.0102,0.0106,0.0106,0.0109,0.0096,0.0121,0.0101,0.0102,0.0093,0.016,0.0144,0.0128,0.0157,0.0128,0.0139,0.011,0.0125,0.0151,0.0125,0.0132,0.0141,0.0098,0.0129,0.0146,0.0138,0.0156,0.012,0.0133,0.0166,0.0179,0.0125,0.0134,0.0149,0.0159,0.0149,0.0128,0.0147,0.0148,0.0122,0.0175,0.0173,0.015,0.0172,0.0182,0.0099,0.0101,0.0161,0.0138,0.0145,0.0174,0.0155,0.0159,0.0142,0.012,0.0133,0.0154,0.0138,0.0118,0.0144,0.0119,0.0124,0.0115,0.0114,0.0117,0.0133,0.0112,0.0113,0.0111,0.0095,0.012,0.0155,0.0128,0.0124,0.0125,0.0133,0.0103,0.013,0.0107,0.012,0.0088,0.009,0.0116,0.0131,0.0122,0.0112,0.0119,0.011,0.0121,0.0096,0.0091,0.0147,0.0119,0.0135,0.01,0.0106,0.0127,0.0101,0.0128,0.0128,0.015,0.0171,0.0152,0.0147,0.0119,0.0112,0.0123,0.0172,0.0129,0.0117,0.0157,0.0142,0.0153,0.0153,0.0169,0.0152,0.0157,0.0131,0.0154,0.018,0.0146,0.0163,0.016,0.0141,0.0122,0.0131,0.0127,0.0126,0.0157,0.0129,0.0125,0.015,0.0136,0.0127,0.0088,0.0106,0.0132,0.014,0.0137,0.0112,0.011,0.0153,0.0139,0.0082,0.0119,0.0083,0.0125,0.0097,0.0097,0.0127,0.0118,0.0137,0.0095,0.0125,0.009,0.011,0.0107,0.0104,0.0103,0.015,0.0141,0.0114,0.0095,0.0111,0.0109,0.0136,0.0122,0.014,0.0107,0.0129,0.0125,0.016,0.0153,0.0176,0.0142,0.0161,0.0157,0.0183,0.0155,0.0149,0.0159,0.014,0.0158,0.0147,0.0138,0.0134,0.0122,0.0173,0.0133,0.0129,0.0136,0.0134,0.0164,0.012,0.0118,0.0113,0.0087,0.0115,0.0134,0.0125,0.0151,0.0129,0.013,0.0145,0.0107,0.0103,0.0099,0.0104,0.0121,0.0116,0.0108,0.0092,0.0131,0.0124,0.0108,0.0122,0.014,0.0104,0.0109,0.0101,0.0104,0.0084,0.0124,0.0117,0.0141,0.0144,0.0094,0.0099,0.0137,0.0083,0.0129,0.0122,0.0154,0.013,0.0124,0.0111,0.0126,0.0119,0.016,0.0127,0.0127,0.0114,0.0151,0.0113,0.0114,0.0117,0.0108,0.0128,0.0139,0.0112,0.014,0.0144,0.0149,0.0124,0.0152,0.0125,0.0124,0.0122,0.0144,0.0162,0.0127,0.0114,0.0121,0.012,0.0149,0.0161,0.0171,0.0133,0.0141,0.0154,0.0158,0.0109,0.0123,0.0113,0.0133,0.014,0.0121,0.0132,0.012,0.0135,0.0098,0.0122,0.0107,0.0112,0.0123,0.009,0.0134,0.0116,0.015,0.0116,0.0114,0.01,0.013,0.0111,0.0128,0.0117,0.0115,0.0098,0.006,0.0089,0.0126,0.0138,0.0101,0.0122,0.0113,0.0119,0.0102,0.0121,0.0111,0.034,0.0106,0.0115,0.0082,0.0109,0.011,0.0145,0.0105,0.0122,0.0085,0.0122,0.0126,0.0149,0.0102,0.0114,0.0122,0.0102,0.0163,0.0161,0.0142,0.0126,0.0133,0.0136,0.013,0.0123,0.0108,0.0137,0.0125,0.0125,0.0123,0.0141,0.0132,0.0099,0.0117,0.0135,0.0176,0.0128,0.0106,0.0087,0.0107,0.013,0.0134,0.0153,0.0141,0.015,0.0118,0.0125,0.0112,0.0112,0.0101,0.0132,0.0116,0.0172,0.014,0.0128,0.0155,0.0132,0.0109,0.01,0.0159,0.02,0.0126,0.0165,0.0158,0.0143,0.014,0.0167,0.0162,0.0156,0.0175,0.0158,0.013,0.0145,0.0149,0.0154,0.0152,0.0121,0.0118,0.0132,0.0122,0.0134,0.0131,0.0152,0.0116,0.0098,0.0116,0.0076,0.0161,0.0135,0.0095,0.0121,0.0118,0.0112,0.0115,0.0119,0.0116,0.0108],[42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,42.9337,49.8498,49.8498,49.8498,49.8498,49.8498,49.8498,49.8498,49.8498,49.8498,49.8498,49.8498,49.8498,49.8498,49.8498,49.8498,49.8498,49.8498,49.8498,49.8498,49.8498,49.8498,49.8498,49.8498,49.8498,49.8498,49.8498,49.8498,49.8498,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.3427,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.7548,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.4235,51.5285,51.5285,51.5285,51.5285,51.5285,51.5285,51.5285,51.5285,51.5285,51.5285,51.5285,51.5285,51.5285,51.5285,51.5285,51.5285,51.5285,51.5285,51.5285,51.5285,51.5285,51.5285,51.5285,51.5285,51.5285,51.5285,51.5285,51.5285,51.5285,51.5285,51.5285,51.5285,51.5285,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.8965,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,51.876,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.0425,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.1238,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.0043,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.3025,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.2925,53.0993,53.0993,53.0993,53.0993,53.0993,53.0993,53.0993,53.0993,53.0993,53.0993,53.0993,53.0993,53.0993,53.0993,53.0993,53.0993,53.0993,53.0993,53.0993,53.0993,53.0993,53.0993,53.0993,53.0993,53.0993,53.0993,53.0993,53.0993,53.0993,53.0993,53.0993,53.0993,53.0993,53.0993,53.0993,53.0993,53.0993,53.0993],[-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-28.152,-29.615,-29.615,-29.615,-29.615,-29.615,-29.615,-29.615,-29.615,-29.615,-29.615,-29.615,-29.615,-29.615,-29.615,-29.615,-29.615,-29.615,-29.615,-29.615,-29.615,-29.615,-29.615,-29.615,-29.615,-29.615,-29.615,-29.615,-29.615,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-28.892,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.5345,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-29.9668,-30.3173,-30.3173,-30.3173,-30.3173,-30.3173,-30.3173,-30.3173,-30.3173,-30.3173,-30.3173,-30.3173,-30.3173,-30.3173,-30.3173,-30.3173,-30.3173,-30.3173,-30.3173,-30.3173,-30.3173,-30.3173,-30.3173,-30.3173,-30.3173,-30.3173,-30.3173,-30.3173,-30.3173,-30.3173,-30.3173,-30.3173,-30.3173,-30.3173,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.3953,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-30.9937,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-33.5578,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.7467,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-34.9157,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-35.5097,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-36.7673,-35.4697,-35.4697,-35.4697,-35.4697,-35.4697,-35.4697,-35.4697,-35.4697,-35.4697,-35.4697,-35.4697,-35.4697,-35.4697,-35.4697,-35.4697,-35.4697,-35.4697,-35.4697,-35.4697,-35.4697,-35.4697,-35.4697,-35.4697,-35.4697,-35.4697,-35.4697,-35.4697,-35.4697,-35.4697,-35.4697,-35.4697,-35.4697,-35.4697,-35.4697,-35.4697,-35.4697,-35.4697,-35.4697],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[null,null,null,null,null,null,null,null,null,null,null,null,null,null," ",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Station<\/th>\n      <th>Sources<\/th>\n      <th>Eddy<\/th>\n      <th>Depth<\/th>\n      <th>Temp<\/th>\n      <th>Salinity<\/th>\n      <th>Oxgen<\/th>\n      <th>flcugl<\/th>\n      <th>Latitude<\/th>\n      <th>Longitude<\/th>\n      <th>Location<\/th>\n      <th>...12<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":20,"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6,7,8,9,10,11]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true}},"evals":[],"jsHooks":[]}</script>
<p><br/></p>
</div>
<div id="s3-2" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Lineaar regression<a href="Chapter3.html#s3-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>まずは線形回帰を行う。ひとまず、ステーションの違いは無視して分析を行う。</p>
<p>図<a href="Chapter3.html#fig:fig-dataexplore">3.1</a>は水深(<code>Depth</code>)と<span class="math inline">\(1m^3\)</span>あたりに確認した生物発光の数をプロットしたものである。データを見る限り直線的な関係があるわけではないことが分かる。</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="Chapter3.html#cb108-1" tabindex="-1"></a>BL <span class="sc">%&gt;%</span> </span>
<span id="cb108-2"><a href="Chapter3.html#cb108-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Depth, <span class="at">y =</span> Sources)) <span class="sc">+</span></span>
<span id="cb108-3"><a href="Chapter3.html#cb108-3" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb108-4"><a href="Chapter3.html#cb108-4" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)<span class="sc">+</span></span>
<span id="cb108-5"><a href="Chapter3.html#cb108-5" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-dataexplore"></span>
<img src="Introduction-to-GAM-using-R_files/figure-html/fig-dataexplore-1.png" alt="Scatterplot of depth versus bioluminescence sources per m^3" width="432" />
<p class="caption">
図3.1: Scatterplot of depth versus bioluminescence sources per m^3
</p>
</div>
<p><br/></p>
<p>以下のモデリングでは、水深を0から1にスケーリングする(モデルがうまく回らなくなるため)。</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="Chapter3.html#cb109-1" tabindex="-1"></a>BL <span class="sc">%&gt;%</span> </span>
<span id="cb109-2"><a href="Chapter3.html#cb109-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Original_Depth =</span> Depth,</span>
<span id="cb109-3"><a href="Chapter3.html#cb109-3" tabindex="-1"></a>         <span class="at">Depth =</span> Depth<span class="sc">/</span><span class="fu">max</span>(Depth)) <span class="ot">-&gt;</span> BL</span></code></pre></div>
<p>明確に直線的な関係はないが、まずは線形回帰を行う。データには様々な変数があるが、いくつかの変数は強く相関しているため、水深のみを説明変数として用いる(図<a href="Chapter3.html#fig:fig-dataexplore2">3.2</a>)。</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="Chapter3.html#cb110-1" tabindex="-1"></a><span class="fu">ggpairs</span>(BL <span class="sc">%&gt;%</span> <span class="fu">select</span>(Sources, Depth, Salinity, Temp, Oxgen))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-dataexplore2"></span>
<img src="Introduction-to-GAM-using-R_files/figure-html/fig-dataexplore2-1.png" alt="Pair plot of the data." width="960" />
<p class="caption">
図3.2: Pair plot of the data.
</p>
</div>
<p><br/></p>
<p>モデル式は以下のようになる。<br />
<span class="math display">\[
\begin{aligned}
Sources_i &amp;= \alpha + \beta \times Depth_i + \epsilon_i\\
\epsilon_i &amp;\sim N(0, \sigma^2)
\end{aligned}
\]</span></p>
<p>Rでは以下のように実行する。</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="Chapter3.html#cb111-1" tabindex="-1"></a>M3_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Sources <span class="sc">~</span> Depth, <span class="at">data =</span> BL)</span></code></pre></div>
<p>モデルによって推定された回帰直線をデータに当てはめると、明らかに当てはまりが悪いことが分かる(図<a href="Chapter3.html#fig:fig-fitted-M3-1">3.3</a>)。</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="Chapter3.html#cb112-1" tabindex="-1"></a>nd_M3 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Depth =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">length.out =</span> <span class="dv">100</span>))</span>
<span id="cb112-2"><a href="Chapter3.html#cb112-2" tabindex="-1"></a></span>
<span id="cb112-3"><a href="Chapter3.html#cb112-3" tabindex="-1"></a>fitted_M3_1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(M3_1, <span class="at">newdata =</span> nd_M3) <span class="sc">%&gt;%</span> </span>
<span id="cb112-4"><a href="Chapter3.html#cb112-4" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb112-5"><a href="Chapter3.html#cb112-5" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">fitted =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb112-6"><a href="Chapter3.html#cb112-6" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd_M3)</span>
<span id="cb112-7"><a href="Chapter3.html#cb112-7" tabindex="-1"></a></span>
<span id="cb112-8"><a href="Chapter3.html#cb112-8" tabindex="-1"></a>BL <span class="sc">%&gt;%</span> </span>
<span id="cb112-9"><a href="Chapter3.html#cb112-9" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Depth, <span class="at">y =</span> Sources))<span class="sc">+</span></span>
<span id="cb112-10"><a href="Chapter3.html#cb112-10" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">&quot;grey54&quot;</span>)<span class="sc">+</span></span>
<span id="cb112-11"><a href="Chapter3.html#cb112-11" tabindex="-1"></a>   <span class="fu">geom_line</span>(<span class="at">data =</span> fitted_M3_1,</span>
<span id="cb112-12"><a href="Chapter3.html#cb112-12" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">y =</span> fitted),</span>
<span id="cb112-13"><a href="Chapter3.html#cb112-13" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb112-14"><a href="Chapter3.html#cb112-14" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)<span class="sc">+</span></span>
<span id="cb112-15"><a href="Chapter3.html#cb112-15" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb112-16"><a href="Chapter3.html#cb112-16" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">120</span>))<span class="sc">+</span></span>
<span id="cb112-17"><a href="Chapter3.html#cb112-17" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Scaled depth&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Sources&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-fitted-M3-1"></span>
<img src="Introduction-to-GAM-using-R_files/figure-html/fig-fitted-M3-1-1.png" alt="Fitted line estimated from M3_1" width="432" />
<p class="caption">
図3.3: Fitted line estimated from M3_1
</p>
</div>
<p><br/></p>
<p>本章の目的は、以下のような式を書いたときに<span class="math inline">\(Depth\)</span>と<span class="math inline">\(Sources\)</span>の関係をうまく説明できる<span class="math inline">\(f(Depth_i)\)</span>という関数を見つけることである。先ほどの線形回帰では<span class="math inline">\(f(Depth_i) = \beta \times Depth_i\)</span>だった。次節以降では、<span class="math inline">\(f(Depth_i)\)</span>として何が最適かを探っていき、最終的にGAMの解説を行う。</p>
<p><span class="math display" id="eq:fdepth">\[
Sources_i = \alpha + f(Depth_i) + \epsilon_i \tag{3.1}
\]</span></p>
</div>
<div id="polynomial-regression-model" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> Polynomial regression model<a href="Chapter3.html#polynomial-regression-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>続いて、多項式回帰を行ってみる。モデル式は以下のとおりである。</p>
<p><span class="math display">\[
\begin{aligned}
Sources_i &amp;= \alpha + \beta_1 \times Depth_i + \beta_2 \times Depth_i^2 + \beta_3 \times Depth^3 +  \epsilon_i\\
\epsilon_i &amp;\sim N(0, \sigma^2)
\end{aligned}
\]</span></p>
<p>Rでは以下のコードで実行できる。</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="Chapter3.html#cb113-1" tabindex="-1"></a>M3_2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Sources <span class="sc">~</span> <span class="fu">poly</span>(Depth,<span class="dv">3</span>), <span class="at">data =</span> BL)</span></code></pre></div>
<p>モデルによって推定された曲線をデータの上に描いたのが図<a href="Chapter3.html#fig:fig-fitted-M3-2">3.4</a>である。先ほどよりは当てはまりがよくなったが、左上と右下の当てはまりが悪いことが分かる。</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="Chapter3.html#cb114-1" tabindex="-1"></a>fitted_M3_2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(M3_2, <span class="at">newdata =</span> nd_M3,) <span class="sc">%&gt;%</span> </span>
<span id="cb114-2"><a href="Chapter3.html#cb114-2" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb114-3"><a href="Chapter3.html#cb114-3" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">fitted =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb114-4"><a href="Chapter3.html#cb114-4" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd_M3)</span>
<span id="cb114-5"><a href="Chapter3.html#cb114-5" tabindex="-1"></a></span>
<span id="cb114-6"><a href="Chapter3.html#cb114-6" tabindex="-1"></a>BL <span class="sc">%&gt;%</span> </span>
<span id="cb114-7"><a href="Chapter3.html#cb114-7" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Depth, <span class="at">y =</span> Sources))<span class="sc">+</span></span>
<span id="cb114-8"><a href="Chapter3.html#cb114-8" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">&quot;grey54&quot;</span>)<span class="sc">+</span></span>
<span id="cb114-9"><a href="Chapter3.html#cb114-9" tabindex="-1"></a>   <span class="fu">geom_line</span>(<span class="at">data =</span> fitted_M3_2,</span>
<span id="cb114-10"><a href="Chapter3.html#cb114-10" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">y =</span> fitted),</span>
<span id="cb114-11"><a href="Chapter3.html#cb114-11" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb114-12"><a href="Chapter3.html#cb114-12" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)<span class="sc">+</span></span>
<span id="cb114-13"><a href="Chapter3.html#cb114-13" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb114-14"><a href="Chapter3.html#cb114-14" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">120</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="fl">0.1</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb114-15"><a href="Chapter3.html#cb114-15" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Scaled depth&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Sources&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-fitted-M3-2"></span>
<img src="Introduction-to-GAM-using-R_files/figure-html/fig-fitted-M3-2-1.png" alt="Fitted line estimated from M3_2" width="432" />
<p class="caption">
図3.4: Fitted line estimated from M3_2
</p>
</div>
<p><br/></p>
<p>次節からは、GAMの数理的な基礎を理解するためにも以下を解説する。</p>
<ol style="list-style-type: decimal">
<li>線形スプライン回帰(linear spline regression)<br />
</li>
<li>二次スプライン回帰(quadratic spline regression)<br />
</li>
<li>ノット数(numer of knots)<br />
</li>
<li>罰則付きスプライン回帰(penalized spline regression)</li>
</ol>
</div>
<div id="s3-4" class="section level2 hasAnchor" number="3.4">
<h2><span class="header-section-number">3.4</span> Linear spline regression<a href="Chapter3.html#s3-4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>線形スプライン回帰とは、x軸をいくつかのセグメントに分け、それぞれのセグメントごとに線形回帰を行う方法である。問題は、いくつのセグメントにどのように分けるべきかということである。</p>
<p>図<a href="Chapter3.html#fig:fig-fitted-M3-1">3.3</a>や図<a href="Chapter3.html#fig:fig-fitted-M3-2">3.4</a>からは、スケール化された水深がだいたい0.2くらいで傾きが変わっている印象を受ける。そこで、0.2を境に傾きが変わるモデルを考える。ただし、このとき回帰直線は0.2でつながっていなければいけない。</p>
<p>実際にモデルを適用する前に、<span class="math inline">\((Depth_i - 0.2)_+\)</span>を以下のように定義する。</p>
<p><span class="math display">\[
(Depth_i - 0.2)_+ =
\begin{cases}
0 &amp; (Depth_i &lt; 0.2)\\
Depth_i - 0.2 &amp; (Depth_i ≧ 0.2)\\
\end{cases}
\]</span></p>
<p>Rでは以下のような関数<code>rhs</code>を作成してこうした変数を作成する。これは、ある変数<code>x</code>について閾値<code>TH</code>を境にそれ以下なら0、それ以上なら<span class="math inline">\(x - TH\)</span>となるような新しい変数を作成する関数である。</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="Chapter3.html#cb115-1" tabindex="-1"></a>rhs <span class="ot">&lt;-</span> <span class="cf">function</span>(x, TH) {</span>
<span id="cb115-2"><a href="Chapter3.html#cb115-2" tabindex="-1"></a>  <span class="fu">ifelse</span>(x <span class="sc">&gt;=</span> TH, x <span class="sc">-</span> TH, <span class="dv">0</span>)</span>
<span id="cb115-3"><a href="Chapter3.html#cb115-3" tabindex="-1"></a>}</span></code></pre></div>
<p>モデルは以下のようになる。<br />
<span class="math display">\[
\begin{aligned}
Sources_i &amp;= \alpha + \beta_1 \times Depth_i + \beta_{11} \times (Depth_i - 0.2)_+ + \epsilon_i \\
\epsilon_i &amp;\sim N(0,\sigma^2)
\end{aligned}
\]</span></p>
<p>Rでこれを実装すると以下のようになる。</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="Chapter3.html#cb116-1" tabindex="-1"></a>M3_3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Sources <span class="sc">~</span> Depth <span class="sc">+</span> <span class="fu">rhs</span>(Depth, <span class="fl">0.2</span>), <span class="at">data =</span> BL)</span></code></pre></div>
<p>モデルから推定された回帰曲線は以下のようになる(図<a href="Chapter3.html#fig:fig-fitted-M3-3">3.5</a>)。</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="Chapter3.html#cb117-1" tabindex="-1"></a>fitted_M3_3 <span class="ot">&lt;-</span> <span class="fu">predict</span>(M3_3, <span class="at">newdata =</span> nd_M3) <span class="sc">%&gt;%</span> </span>
<span id="cb117-2"><a href="Chapter3.html#cb117-2" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb117-3"><a href="Chapter3.html#cb117-3" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">fitted =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb117-4"><a href="Chapter3.html#cb117-4" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd_M3)</span>
<span id="cb117-5"><a href="Chapter3.html#cb117-5" tabindex="-1"></a></span>
<span id="cb117-6"><a href="Chapter3.html#cb117-6" tabindex="-1"></a>BL <span class="sc">%&gt;%</span> </span>
<span id="cb117-7"><a href="Chapter3.html#cb117-7" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Depth, <span class="at">y =</span> Sources))<span class="sc">+</span></span>
<span id="cb117-8"><a href="Chapter3.html#cb117-8" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">&quot;grey54&quot;</span>)<span class="sc">+</span></span>
<span id="cb117-9"><a href="Chapter3.html#cb117-9" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> fitted_M3_3,</span>
<span id="cb117-10"><a href="Chapter3.html#cb117-10" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">y =</span> fitted),</span>
<span id="cb117-11"><a href="Chapter3.html#cb117-11" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb117-12"><a href="Chapter3.html#cb117-12" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)<span class="sc">+</span></span>
<span id="cb117-13"><a href="Chapter3.html#cb117-13" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb117-14"><a href="Chapter3.html#cb117-14" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">120</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="fl">0.1</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb117-15"><a href="Chapter3.html#cb117-15" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Scaled depth&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Sources&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-fitted-M3-3"></span>
<img src="Introduction-to-GAM-using-R_files/figure-html/fig-fitted-M3-3-1.png" alt="Fitted line estimated from M3_3" width="432" />
<p class="caption">
図3.5: Fitted line estimated from M3_3
</p>
</div>
<p><br/></p>
<p>問題は、モデル<code>M3_3</code>が通常の直線回帰モデル(<code>M3_1</code>)や多項回帰モデル(<code>M3_2</code>)よりもよいモデルかどうかである。赤池情報量規準(AIC)を持ちると<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>、<code>M3_3</code>はより予測の良いモデルだということが分かる。</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="Chapter3.html#cb118-1" tabindex="-1"></a><span class="fu">AIC</span>(M3_1, M3_2, M3_3)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["df"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["AIC"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"3","2":"8146.538","_rn_":"M3_1"},{"1":"5","2":"7791.305","_rn_":"M3_2"},{"1":"4","2":"7689.034","_rn_":"M3_3"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>しかし、モデル<code>M3_3</code>にも問題点がいくつかある。<span class="math inline">\(Depth = 0.2\)</span>での傾きの変化が急激であるということと、0.2という数値の選択基準が恣意的である点である。</p>
<p>こうした問題点を解決する手段として、例えばデータを10等分してそれぞれについて回帰直線を当てはめるというようなものが考えられる。この場合、傾きは以下の9ポイント(第1から第9十分位数)で変わることになる。このようなポイントを<strong>ノット(knot)</strong>という。</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="Chapter3.html#cb119-1" tabindex="-1"></a>q_Depth <span class="ot">&lt;-</span> <span class="fu">quantile</span>(BL<span class="sc">$</span>Depth, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="fl">0.1</span>,<span class="fl">0.9</span>,<span class="fl">0.1</span>))</span></code></pre></div>
<p>このとき、モデル式は以下のように書ける。なお、<span class="math inline">\(k_j\)</span>は第j十分位数を表す。</p>
<p><span class="math display">\[
\begin{aligned}
Sources_i &amp;= \alpha + \beta_1 \times Depth_i + \sum_{j = 1}^9 \Bigl( \beta_{1j} \times (Depth_i - k_j)_+ \Bigl) + \epsilon_i \\
\epsilon_i &amp;\sim N(0,\sigma^2)
\end{aligned}
\]</span></p>
<p>このモデルはRで以下のように実装できる。</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="Chapter3.html#cb120-1" tabindex="-1"></a>M3_4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Sources <span class="sc">~</span> Depth <span class="sc">+</span> <span class="fu">rhs</span>(Depth, q_Depth[<span class="dv">1</span>]) <span class="sc">+</span> <span class="fu">rhs</span>(Depth, q_Depth[<span class="dv">2</span>]) <span class="sc">+</span></span>
<span id="cb120-2"><a href="Chapter3.html#cb120-2" tabindex="-1"></a>             <span class="fu">rhs</span>(Depth, q_Depth[<span class="dv">3</span>]) <span class="sc">+</span> <span class="fu">rhs</span>(Depth, q_Depth[<span class="dv">4</span>]) <span class="sc">+</span> <span class="fu">rhs</span>(Depth, q_Depth[<span class="dv">5</span>]) <span class="sc">+</span></span>
<span id="cb120-3"><a href="Chapter3.html#cb120-3" tabindex="-1"></a>             <span class="fu">rhs</span>(Depth, q_Depth[<span class="dv">6</span>]) <span class="sc">+</span> <span class="fu">rhs</span>(Depth, q_Depth[<span class="dv">7</span>]) <span class="sc">+</span> <span class="fu">rhs</span>(Depth, q_Depth[<span class="dv">8</span>]) <span class="sc">+</span> </span>
<span id="cb120-4"><a href="Chapter3.html#cb120-4" tabindex="-1"></a>             <span class="fu">rhs</span>(Depth, q_Depth[<span class="dv">9</span>]), <span class="at">data =</span> BL)</span></code></pre></div>
<p>このモデルによって推定された回帰曲線は以下のとおりである(図<a href="Chapter3.html#fig:fig-fitted-M3-4">3.6</a>)。</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="Chapter3.html#cb121-1" tabindex="-1"></a>fitted_M3_4 <span class="ot">&lt;-</span> <span class="fu">predict</span>(M3_4, <span class="at">newdata =</span> nd_M3) <span class="sc">%&gt;%</span> </span>
<span id="cb121-2"><a href="Chapter3.html#cb121-2" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb121-3"><a href="Chapter3.html#cb121-3" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">fitted =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb121-4"><a href="Chapter3.html#cb121-4" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd_M3)</span>
<span id="cb121-5"><a href="Chapter3.html#cb121-5" tabindex="-1"></a></span>
<span id="cb121-6"><a href="Chapter3.html#cb121-6" tabindex="-1"></a>BL <span class="sc">%&gt;%</span> </span>
<span id="cb121-7"><a href="Chapter3.html#cb121-7" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Depth, <span class="at">y =</span> Sources))<span class="sc">+</span></span>
<span id="cb121-8"><a href="Chapter3.html#cb121-8" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">&quot;grey54&quot;</span>)<span class="sc">+</span></span>
<span id="cb121-9"><a href="Chapter3.html#cb121-9" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> fitted_M3_4,</span>
<span id="cb121-10"><a href="Chapter3.html#cb121-10" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">y =</span> fitted),</span>
<span id="cb121-11"><a href="Chapter3.html#cb121-11" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb121-12"><a href="Chapter3.html#cb121-12" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)<span class="sc">+</span></span>
<span id="cb121-13"><a href="Chapter3.html#cb121-13" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb121-14"><a href="Chapter3.html#cb121-14" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">120</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="fl">0.1</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb121-15"><a href="Chapter3.html#cb121-15" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Scaled depth&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Sources&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-fitted-M3-4"></span>
<img src="Introduction-to-GAM-using-R_files/figure-html/fig-fitted-M3-4-1.png" alt="Fitted line estimated from M3_4" width="432" />
<p class="caption">
図3.6: Fitted line estimated from M3_4
</p>
</div>
<p><br/></p>
<p>先ほどよりもよりデータへの当てはまりはよくなっているが、まだカクカクした線になっている。より細かく<span class="math inline">\(Depth\)</span>を区分することは可能である。</p>
<p><code>model.matrix(M3_4)</code>によって得られるこのモデルのsmootherの要素となった以下のものは、smootherの基底(smoother)と呼ばれる。</p>
<p><span class="math display">\[
1, Depth_i, (Depth_i - k_1)_+, (Depth_i - k_2)_+, \dots, (Depth_i - k_9)_+
\]</span></p>
</div>
<div id="s3-5" class="section level2 hasAnchor" number="3.5">
<h2><span class="header-section-number">3.5</span> Quadratic spline regression<a href="Chapter3.html#s3-5" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>適切な<span class="math inline">\(f(Depth_i)\)</span>を探す試みとして線形スプライン回帰を行ったが、ノットで傾きがカクカクしてしまっていた。これに代わる方法として、二次スプライン回帰(quadratic spline regression)を考えることができる。モデルは以下のように書ける。</p>
<p><span class="math display" id="eq:qsr">\[
\begin{aligned}
Sources_i &amp;= \alpha + \beta_1 \times Depth_i + \beta_2 \times Depth_i^2 + \sum_{j = 1}^k \Bigl( \beta_{1j} \times (Depth_i - k_j)_+^2 \Bigl) + \epsilon_i \\
\epsilon_i &amp;\sim N(0,\sigma^2)
\end{aligned} \tag{3.2}
\]</span></p>
<p>そのため、<span class="math inline">\(Depth_i\)</span>を10等分するのであれば、このモデルにおける基底は以下の12個になる。<br />
<span class="math display">\[
1, Depth_i^2, (Depth_i - k_1)_+^2, (Depth_i - k_2)_+^2, \dots, (Depth_i - k_9)_+^2
\]</span></p>
<p>このモデルをRで実装するため、以下の関数を作成する。これは、ある変数<code>x</code>について閾値<code>TH</code>を境にそれ以下なら0、それ以上なら<span class="math inline">\((x - TH)^2\)</span>となるような新しい変数を作成する関数である。</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="Chapter3.html#cb122-1" tabindex="-1"></a>rhs2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x, TH) {</span>
<span id="cb122-2"><a href="Chapter3.html#cb122-2" tabindex="-1"></a>  <span class="fu">ifelse</span>(x <span class="sc">&gt;=</span> TH, (x <span class="sc">-</span> TH)<span class="sc">^</span><span class="dv">2</span>, <span class="dv">0</span>)</span>
<span id="cb122-3"><a href="Chapter3.html#cb122-3" tabindex="-1"></a>}</span></code></pre></div>
<p>モデルは以下のように実行できる。</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="Chapter3.html#cb123-1" tabindex="-1"></a>M3_5 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Sources <span class="sc">~</span> Depth <span class="sc">+</span> <span class="fu">I</span>(Depth<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">rhs2</span>(Depth, q_Depth[<span class="dv">1</span>]) <span class="sc">+</span> <span class="fu">rhs2</span>(Depth, q_Depth[<span class="dv">2</span>]) <span class="sc">+</span></span>
<span id="cb123-2"><a href="Chapter3.html#cb123-2" tabindex="-1"></a>             <span class="fu">rhs2</span>(Depth, q_Depth[<span class="dv">3</span>]) <span class="sc">+</span> <span class="fu">rhs2</span>(Depth, q_Depth[<span class="dv">4</span>]) <span class="sc">+</span> <span class="fu">rhs2</span>(Depth, q_Depth[<span class="dv">5</span>]) <span class="sc">+</span></span>
<span id="cb123-3"><a href="Chapter3.html#cb123-3" tabindex="-1"></a>             <span class="fu">rhs2</span>(Depth, q_Depth[<span class="dv">6</span>]) <span class="sc">+</span> <span class="fu">rhs2</span>(Depth, q_Depth[<span class="dv">7</span>]) <span class="sc">+</span> <span class="fu">rhs2</span>(Depth, q_Depth[<span class="dv">8</span>]) <span class="sc">+</span> </span>
<span id="cb123-4"><a href="Chapter3.html#cb123-4" tabindex="-1"></a>             <span class="fu">rhs2</span>(Depth, q_Depth[<span class="dv">9</span>]), <span class="at">data =</span> BL)</span></code></pre></div>
<p>このモデルによって推定された回帰曲線は以下のとおりである(図<a href="Chapter3.html#fig:fig-fitted-M3-5">3.7</a>)。線形スプライン回帰よりもなめらかな曲線になっていることが分かる。</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="Chapter3.html#cb124-1" tabindex="-1"></a>fitted_M3_5 <span class="ot">&lt;-</span> <span class="fu">predict</span>(M3_5, <span class="at">newdata =</span> nd_M3) <span class="sc">%&gt;%</span> </span>
<span id="cb124-2"><a href="Chapter3.html#cb124-2" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb124-3"><a href="Chapter3.html#cb124-3" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">fitted =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb124-4"><a href="Chapter3.html#cb124-4" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd_M3)</span>
<span id="cb124-5"><a href="Chapter3.html#cb124-5" tabindex="-1"></a></span>
<span id="cb124-6"><a href="Chapter3.html#cb124-6" tabindex="-1"></a>BL <span class="sc">%&gt;%</span> </span>
<span id="cb124-7"><a href="Chapter3.html#cb124-7" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Depth, <span class="at">y =</span> Sources))<span class="sc">+</span></span>
<span id="cb124-8"><a href="Chapter3.html#cb124-8" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">&quot;grey54&quot;</span>)<span class="sc">+</span></span>
<span id="cb124-9"><a href="Chapter3.html#cb124-9" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> fitted_M3_5,</span>
<span id="cb124-10"><a href="Chapter3.html#cb124-10" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">y =</span> fitted),</span>
<span id="cb124-11"><a href="Chapter3.html#cb124-11" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb124-12"><a href="Chapter3.html#cb124-12" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)<span class="sc">+</span></span>
<span id="cb124-13"><a href="Chapter3.html#cb124-13" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb124-14"><a href="Chapter3.html#cb124-14" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">120</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="fl">0.1</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb124-15"><a href="Chapter3.html#cb124-15" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Scaled depth&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Sources&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-fitted-M3-5"></span>
<img src="Introduction-to-GAM-using-R_files/figure-html/fig-fitted-M3-5-1.png" alt="Fitted line estimated from M3_5" width="432" />
<p class="caption">
図3.7: Fitted line estimated from M3_5
</p>
</div>
<p><br/></p>
<p>以下、モデルの結果を見てみよう。<code>rhs2</code>関数で作られた変数の多くが有意でないのは、これらが強く相関しており多重共線性の問題があることが原因だろう。</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="Chapter3.html#cb125-1" tabindex="-1"></a><span class="fu">summary</span>(M3_5)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Sources ~ Depth + I(Depth^2) + rhs2(Depth, q_Depth[1]) + 
##     rhs2(Depth, q_Depth[2]) + rhs2(Depth, q_Depth[3]) + rhs2(Depth, 
##     q_Depth[4]) + rhs2(Depth, q_Depth[5]) + rhs2(Depth, q_Depth[6]) + 
##     rhs2(Depth, q_Depth[7]) + rhs2(Depth, q_Depth[8]) + rhs2(Depth, 
##     q_Depth[9]), data = BL)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -42.285  -4.850  -1.006   2.705  63.710 
## 
## Coefficients:
##                          Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)               175.444     28.621   6.130 1.25e-09 ***
## Depth                   -1410.486    409.840  -3.442 0.000601 ***
## I(Depth^2)               3291.466   1430.389   2.301 0.021584 *  
## rhs2(Depth, q_Depth[1])  -549.110   2067.208  -0.266 0.790578    
## rhs2(Depth, q_Depth[2]) -2891.946   1340.997  -2.157 0.031269 *  
## rhs2(Depth, q_Depth[3])   368.134   1190.504   0.309 0.757212    
## rhs2(Depth, q_Depth[4])  -935.978   1061.824  -0.881 0.378262    
## rhs2(Depth, q_Depth[5])  1197.211    877.679   1.364 0.172843    
## rhs2(Depth, q_Depth[6])  -445.930    730.756  -0.610 0.541842    
## rhs2(Depth, q_Depth[7])    30.872    592.644   0.052 0.958466    
## rhs2(Depth, q_Depth[8])     5.152    400.189   0.013 0.989732    
## rhs2(Depth, q_Depth[9])  -152.712    295.507  -0.517 0.605421    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 9.148 on 1037 degrees of freedom
## Multiple R-squared:  0.6892, Adjusted R-squared:  0.6859 
## F-statistic: 209.1 on 11 and 1037 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>式<a href="Chapter3.html#eq:qsr">(3.2)</a>のモデルは正規分布の一般化加法モデルといえる。<code>mgvc</code>パッケージではより発展的なsmootherを用いており、多重共線性の問題などが生じないようなっている。</p>
<p>このモデルは第<a href="Chapter1.html#c1">1</a>章のときのように以下のように書ける。なお、<span class="math inline">\(\mathbf{y}\)</span>は目的変数をすべて含むベクトル、<span class="math inline">\(\mathbf{X}\)</span>は<code>model.matrix(M3_5)</code>によって得られる基底の行列、<span class="math inline">\(\mathbf{\beta}\)</span>は回帰係数をすべて含むベクトルである。この表現で書けるということは、第<a href="Chapter1.html#c1">1</a>章と全く同じ方法で標準誤差や自由度、信頼区間、予測区間を算出できるということである。<br />
<span class="math display">\[
\mathbf{y} = \mathbf{X} \times \mathbf{\beta} + \mathbf{\epsilon}
\]</span></p>
</div>
<div id="s3-6" class="section level2 hasAnchor" number="3.6">
<h2><span class="header-section-number">3.6</span> Cubic regression splines<a href="Chapter3.html#s3-6" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>より回帰曲線を滑らかにするのであれば、3次スプライン回帰を考えることもできる。モデル式は以下の通り。Rでも前節までと同様に実行することができる。</p>
<p><span class="math display" id="eq:csr">\[
\begin{aligned}
Sources_i &amp;= \alpha + \beta_1 \times Depth_i + \beta_2 \times Depth_i^2 + \beta_3 \times Depth_i^3 + \sum_{j = 1}^k \Bigl( \beta_{1j} \times (Depth_i - k_j)_+^3 \Bigl) + \epsilon_i \\
\epsilon_i &amp;\sim N(0,\sigma^2)
\end{aligned} \tag{3.3}
\]</span></p>
<p><span class="citation">Wood (<a href="#ref-Wood2017">2017</a>)</span> や <span class="citation">Zuur (<a href="#ref-Zuur2009">2009</a>)</span> では、さらに発展的な方法として以下のモデルを考えた。</p>
<p><span class="math display" id="eq:crs">\[
\begin{aligned}
Sources_i &amp;= \sum_{j = 1}^K \Bigl( \beta_{j} \times b_j(Depth_i) \Bigl) + \epsilon_i \\
\epsilon_i &amp;\sim N(0,\sigma^2)
\end{aligned} \tag{3.4}
\]</span></p>
<p>ここで、<span class="math inline">\(b_1(Depth_i) = 1, b_2(Depth_i) = Depth\)</span>であり、<span class="math inline">\(j ≧ 2\)</span>のときは<span class="math inline">\(B_j(Depth_i) = R(Depth_i, k_{j-2})\)</span>である。また、<span class="math inline">\(k_{j-2}\)</span>は<span class="math inline">\(j-2\)</span>番目のノットの値を表す。よって、以下のようにも書ける。</p>
<p><span class="math display" id="eq:crs2">\[
\begin{aligned}
Sources_i &amp;= \beta_1 + \beta_1 \times Depth_i + \sum_{j = 2}^K \Bigl( \beta_{j} \times R(Depth_i, k_{j-2}) \Bigl) + \epsilon_i \\
\epsilon_i &amp;\sim N(0,\sigma^2)
\end{aligned} \tag{3.5}
\]</span></p>
<p>なお、<span class="math inline">\((Depth_i, k_{j-2})\)</span>は以下のように定義される。</p>
<p><span class="math display">\[
R(X,z) = \frac{1}{4} \times \Bigl( (z - \frac{1}{2})^2 - \frac{1}{12} \Bigl) \times \Bigl( (X - \frac{1}{2})^2 - \frac{1}{12} \Bigl) - \frac{1}{24} \times \Bigl( (|X-z| - \frac{1}{2})^4 - \frac{1}{2}(|X-z| - \frac{1}{2})^2 + \frac{7}{240} \Bigl)
\]</span></p>
<p>Rでもこの関数を作成する。</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="Chapter3.html#cb127-1" tabindex="-1"></a>rk <span class="ot">&lt;-</span><span class="cf">function</span>(x, z){</span>
<span id="cb127-2"><a href="Chapter3.html#cb127-2" tabindex="-1"></a>  ((z<span class="fl">-0.5</span>)<span class="sc">^</span><span class="dv">2-1</span><span class="sc">/</span><span class="dv">12</span>)<span class="sc">*</span>((x<span class="fl">-0.5</span>)<span class="sc">^</span><span class="dv">2-1</span><span class="sc">/</span><span class="dv">12</span>)<span class="sc">/</span><span class="dv">4</span> <span class="sc">-</span> ((<span class="fu">abs</span>(x<span class="sc">-</span>z)<span class="sc">-</span><span class="fl">0.5</span>)<span class="sc">^</span><span class="dv">4</span><span class="fl">-0.5</span><span class="sc">*</span>(<span class="fu">abs</span>(x<span class="sc">-</span>z)<span class="sc">-</span> <span class="fl">0.5</span>)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span><span class="dv">7</span><span class="sc">/</span><span class="dv">240</span>)<span class="sc">/</span><span class="dv">24</span></span>
<span id="cb127-3"><a href="Chapter3.html#cb127-3" tabindex="-1"></a>}</span></code></pre></div>
<p>また、説明変数をすべて含む行列<span class="math inline">\(\mathbf{X}\)</span>を作成する必要がある。この行列は1列目は全て1、2列目は<span class="math inline">\(Depth_i\)</span>で、3列目以降は<span class="math inline">\(R(Depth_i, k_{j-2})\)</span>である。Rでは以下のように作成できる。</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="Chapter3.html#cb128-1" tabindex="-1"></a>spl.X <span class="ot">&lt;-</span><span class="cf">function</span>(x, xk){</span>
<span id="cb128-2"><a href="Chapter3.html#cb128-2" tabindex="-1"></a>  q <span class="ot">&lt;-</span><span class="fu">length</span>(xk) <span class="sc">+</span> <span class="dv">2</span> </span>
<span id="cb128-3"><a href="Chapter3.html#cb128-3" tabindex="-1"></a>  n <span class="ot">&lt;-</span><span class="fu">length</span>(x) </span>
<span id="cb128-4"><a href="Chapter3.html#cb128-4" tabindex="-1"></a>  X <span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="dv">1</span>, n, q) </span>
<span id="cb128-5"><a href="Chapter3.html#cb128-5" tabindex="-1"></a>  X[,<span class="dv">2</span>] <span class="ot">&lt;-</span>x </span>
<span id="cb128-6"><a href="Chapter3.html#cb128-6" tabindex="-1"></a>  X[,<span class="dv">3</span><span class="sc">:</span>q] <span class="ot">&lt;-</span><span class="fu">outer</span>(x, xk, <span class="at">FUN =</span> rk) </span>
<span id="cb128-7"><a href="Chapter3.html#cb128-7" tabindex="-1"></a>  X</span>
<span id="cb128-8"><a href="Chapter3.html#cb128-8" tabindex="-1"></a>}</span>
<span id="cb128-9"><a href="Chapter3.html#cb128-9" tabindex="-1"></a></span>
<span id="cb128-10"><a href="Chapter3.html#cb128-10" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">spl.X</span>(BL<span class="sc">$</span>Depth, q_Depth)</span></code></pre></div>
<p>Rでモデルを以下のように実行できる。なお、<span class="math inline">\(\mathbf{X}\)</span>にはすでに切片に相当する1列目が含まれているため、<code>Sources ~ X - 1</code>とする。</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="Chapter3.html#cb129-1" tabindex="-1"></a>M3_6 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Sources <span class="sc">~</span> X <span class="sc">-</span> <span class="dv">1</span>, <span class="at">data =</span> BL)</span></code></pre></div>
<p>このモデルによって推定された回帰曲線は以下のとおりである(図<a href="Chapter3.html#fig:fig-fitted-M3-6">3.8</a>)。2次スプライン回帰の結果と大きくは違わない。</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="Chapter3.html#cb130-1" tabindex="-1"></a>Xp <span class="ot">&lt;-</span> <span class="fu">spl.X</span>(nd_M3<span class="sc">$</span>Depth, q_Depth)</span>
<span id="cb130-2"><a href="Chapter3.html#cb130-2" tabindex="-1"></a></span>
<span id="cb130-3"><a href="Chapter3.html#cb130-3" tabindex="-1"></a>fitted_M3_6 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Depth =</span> nd_M3<span class="sc">$</span>Depth,</span>
<span id="cb130-4"><a href="Chapter3.html#cb130-4" tabindex="-1"></a>                          <span class="at">fitted =</span> Xp <span class="sc">%*%</span> <span class="fu">coef</span>(M3_6))</span>
<span id="cb130-5"><a href="Chapter3.html#cb130-5" tabindex="-1"></a></span>
<span id="cb130-6"><a href="Chapter3.html#cb130-6" tabindex="-1"></a>BL <span class="sc">%&gt;%</span> </span>
<span id="cb130-7"><a href="Chapter3.html#cb130-7" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb130-8"><a href="Chapter3.html#cb130-8" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Depth, <span class="at">y =</span> Sources),</span>
<span id="cb130-9"><a href="Chapter3.html#cb130-9" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">&quot;grey54&quot;</span>)<span class="sc">+</span></span>
<span id="cb130-10"><a href="Chapter3.html#cb130-10" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> fitted_M3_6,</span>
<span id="cb130-11"><a href="Chapter3.html#cb130-11" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> Depth, <span class="at">y =</span> fitted),</span>
<span id="cb130-12"><a href="Chapter3.html#cb130-12" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb130-13"><a href="Chapter3.html#cb130-13" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> q_Depth,</span>
<span id="cb130-14"><a href="Chapter3.html#cb130-14" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span></span>
<span id="cb130-15"><a href="Chapter3.html#cb130-15" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)<span class="sc">+</span></span>
<span id="cb130-16"><a href="Chapter3.html#cb130-16" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb130-17"><a href="Chapter3.html#cb130-17" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">120</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="fl">0.1</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb130-18"><a href="Chapter3.html#cb130-18" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Scaled depth&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Sources&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-fitted-M3-6"></span>
<img src="Introduction-to-GAM-using-R_files/figure-html/fig-fitted-M3-6-1.png" alt="Fitted line estimated from M3_6" width="432" />
<p class="caption">
図3.8: Fitted line estimated from M3_6
</p>
</div>
<p><br/></p>
</div>
<div id="the-number-of-knots" class="section level2 hasAnchor" number="3.7">
<h2><span class="header-section-number">3.7</span> The number of knots<a href="Chapter3.html#the-number-of-knots" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>第<a href="Chapter3.html#s3-4">3.4</a>から<a href="Chapter3.html#s3-6">3.6</a>節までは<span class="math inline">\(Depth_i\)</span>を10の区間に分けており、両端を除くとノット数は9だった。しかし、この数はあくまでも恣意的に選択したものに過ぎない。それでは、私たちは<strong>ノット数をいくつに設定するのが適切なのだろうか</strong>。</p>
<p>図<a href="Chapter3.html#fig:fig-fitted-all2">3.9</a>は両端を除くノット数を変化させたときの回帰曲線を図示したものである。結果を見てみると、ノット数による違いはそこまで大きくないように思える。</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="Chapter3.html#cb131-1" tabindex="-1"></a>num <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">9</span>,<span class="dv">11</span>,<span class="dv">13</span>,<span class="dv">15</span>,<span class="dv">17</span>, <span class="dv">19</span>, <span class="dv">31</span>)</span>
<span id="cb131-2"><a href="Chapter3.html#cb131-2" tabindex="-1"></a>q_Depth_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb131-3"><a href="Chapter3.html#cb131-3" tabindex="-1"></a>X_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb131-4"><a href="Chapter3.html#cb131-4" tabindex="-1"></a></span>
<span id="cb131-5"><a href="Chapter3.html#cb131-5" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(num)){</span>
<span id="cb131-6"><a href="Chapter3.html#cb131-6" tabindex="-1"></a>q_Depth_list[[i]] <span class="ot">&lt;-</span> <span class="fu">quantile</span>(BL<span class="sc">$</span>Depth, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">by =</span> <span class="dv">1</span><span class="sc">/</span>(num[i]<span class="sc">+</span><span class="dv">1</span>)))[<span class="dv">2</span><span class="sc">:</span>(num[i]<span class="sc">+</span><span class="dv">1</span>)]</span>
<span id="cb131-7"><a href="Chapter3.html#cb131-7" tabindex="-1"></a>X_list[[i]] <span class="ot">&lt;-</span> <span class="fu">spl.X</span>(BL<span class="sc">$</span>Depth, q_Depth_list[[i]])</span>
<span id="cb131-8"><a href="Chapter3.html#cb131-8" tabindex="-1"></a>}</span>
<span id="cb131-9"><a href="Chapter3.html#cb131-9" tabindex="-1"></a></span>
<span id="cb131-10"><a href="Chapter3.html#cb131-10" tabindex="-1"></a>M3_6_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb131-11"><a href="Chapter3.html#cb131-11" tabindex="-1"></a>Xp_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb131-12"><a href="Chapter3.html#cb131-12" tabindex="-1"></a>fitted_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb131-13"><a href="Chapter3.html#cb131-13" tabindex="-1"></a></span>
<span id="cb131-14"><a href="Chapter3.html#cb131-14" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(num)){</span>
<span id="cb131-15"><a href="Chapter3.html#cb131-15" tabindex="-1"></a>  M3_6_list[[i]] <span class="ot">&lt;-</span> <span class="fu">lm</span>(Sources <span class="sc">~</span> X_list[[i]] <span class="sc">-</span> <span class="dv">1</span>, <span class="at">data =</span> BL)</span>
<span id="cb131-16"><a href="Chapter3.html#cb131-16" tabindex="-1"></a>  Xp_list[[i]] <span class="ot">&lt;-</span> <span class="fu">spl.X</span>(nd_M3<span class="sc">$</span>Depth, q_Depth_list[[i]])</span>
<span id="cb131-17"><a href="Chapter3.html#cb131-17" tabindex="-1"></a>  fitted_list[[i]] <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Depth =</span> nd_M3<span class="sc">$</span>Depth,</span>
<span id="cb131-18"><a href="Chapter3.html#cb131-18" tabindex="-1"></a>                                 <span class="at">fitted =</span> Xp_list[[i]] <span class="sc">%*%</span> <span class="fu">coef</span>(M3_6_list[[i]]),</span>
<span id="cb131-19"><a href="Chapter3.html#cb131-19" tabindex="-1"></a>                                 <span class="at">knot =</span> num[i])</span>
<span id="cb131-20"><a href="Chapter3.html#cb131-20" tabindex="-1"></a>}</span>
<span id="cb131-21"><a href="Chapter3.html#cb131-21" tabindex="-1"></a></span>
<span id="cb131-22"><a href="Chapter3.html#cb131-22" tabindex="-1"></a><span class="fu">bind_rows</span>(fitted_list[<span class="dv">1</span>], fitted_list[[<span class="dv">2</span>]], fitted_list[[<span class="dv">3</span>]], fitted_list[[<span class="dv">4</span>]],</span>
<span id="cb131-23"><a href="Chapter3.html#cb131-23" tabindex="-1"></a>          fitted_list[[<span class="dv">5</span>]], fitted_list[[<span class="dv">6</span>]], fitted_list[[<span class="dv">7</span>]], fitted_list[[<span class="dv">8</span>]],</span>
<span id="cb131-24"><a href="Chapter3.html#cb131-24" tabindex="-1"></a>          fitted_list[[<span class="dv">9</span>]], fitted_list[[<span class="dv">10</span>]], fitted_list[[<span class="dv">11</span>]]) <span class="sc">%&gt;%</span> </span>
<span id="cb131-25"><a href="Chapter3.html#cb131-25" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">knot_text =</span> <span class="fu">str_c</span>(<span class="st">&quot;inner knot = &quot;</span>, knot)) <span class="sc">%&gt;%</span> </span>
<span id="cb131-26"><a href="Chapter3.html#cb131-26" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">knot_text =</span> <span class="fu">fct_reorder</span>(knot_text, knot))<span class="ot">-&gt;</span> fitted_all</span>
<span id="cb131-27"><a href="Chapter3.html#cb131-27" tabindex="-1"></a>  </span>
<span id="cb131-28"><a href="Chapter3.html#cb131-28" tabindex="-1"></a>BL <span class="sc">%&gt;%</span> </span>
<span id="cb131-29"><a href="Chapter3.html#cb131-29" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb131-30"><a href="Chapter3.html#cb131-30" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Depth, <span class="at">y =</span> Sources),</span>
<span id="cb131-31"><a href="Chapter3.html#cb131-31" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">&quot;grey54&quot;</span>)<span class="sc">+</span></span>
<span id="cb131-32"><a href="Chapter3.html#cb131-32" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> fitted_all,</span>
<span id="cb131-33"><a href="Chapter3.html#cb131-33" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> Depth, <span class="at">y =</span> fitted),</span>
<span id="cb131-34"><a href="Chapter3.html#cb131-34" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb131-35"><a href="Chapter3.html#cb131-35" tabindex="-1"></a>  <span class="fu">facet_rep_wrap</span>(<span class="sc">~</span>knot_text, <span class="at">repeat.tick.labels =</span> <span class="cn">TRUE</span>)<span class="sc">+</span></span>
<span id="cb131-36"><a href="Chapter3.html#cb131-36" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)<span class="sc">+</span></span>
<span id="cb131-37"><a href="Chapter3.html#cb131-37" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>,</span>
<span id="cb131-38"><a href="Chapter3.html#cb131-38" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb131-39"><a href="Chapter3.html#cb131-39" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>))<span class="sc">+</span></span>
<span id="cb131-40"><a href="Chapter3.html#cb131-40" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">120</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="fl">0.105</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb131-41"><a href="Chapter3.html#cb131-41" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Scaled depth&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Sources&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-fitted-all2"></span>
<img src="Introduction-to-GAM-using-R_files/figure-html/fig-fitted-all2-1.png" alt="Fitted smoothers for a quadratic spline regression model using different numbers of knots." width="1248" />
<p class="caption">
図3.9: Fitted smoothers for a quadratic spline regression model using different numbers of knots.
</p>
</div>
<p>AICなどによってこれらのモデルの比較を行うことはできる(図<a href="Chapter3.html#fig:fig-modelAIC">3.10</a>)。AICとAICcに基づくとノット数が7のモデルが最もよく(値が最も小さく)、そこからノット数が離れるほど予測がよくなくなる(= 値が大きくなる)。BICに基づくとノット数が5のときが最も予測が良い。</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="Chapter3.html#cb132-1" tabindex="-1"></a><span class="fu">compare_performance</span>(M3_6_list[[<span class="dv">1</span>]],M3_6_list[[<span class="dv">2</span>]],M3_6_list[[<span class="dv">3</span>]],</span>
<span id="cb132-2"><a href="Chapter3.html#cb132-2" tabindex="-1"></a>                    M3_6_list[[<span class="dv">4</span>]],M3_6_list[[<span class="dv">5</span>]],M3_6_list[[<span class="dv">6</span>]],</span>
<span id="cb132-3"><a href="Chapter3.html#cb132-3" tabindex="-1"></a>                    M3_6_list[[<span class="dv">7</span>]],M3_6_list[[<span class="dv">8</span>]],M3_6_list[[<span class="dv">9</span>]],</span>
<span id="cb132-4"><a href="Chapter3.html#cb132-4" tabindex="-1"></a>                    M3_6_list[[<span class="dv">10</span>]],M3_6_list[[<span class="dv">11</span>]]) <span class="sc">%&gt;%</span> </span>
<span id="cb132-5"><a href="Chapter3.html#cb132-5" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb132-6"><a href="Chapter3.html#cb132-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">knot =</span> num) <span class="sc">%&gt;%</span> </span>
<span id="cb132-7"><a href="Chapter3.html#cb132-7" tabindex="-1"></a>  <span class="fu">select</span>(knot, AIC, AICc, BIC, R2, R2_adjusted) <span class="sc">%&gt;%</span> </span>
<span id="cb132-8"><a href="Chapter3.html#cb132-8" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(AIC, AICc, BIC), <span class="at">names_to =</span> <span class="st">&quot;IC&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb132-9"><a href="Chapter3.html#cb132-9" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> knot, <span class="at">y =</span> value))<span class="sc">+</span></span>
<span id="cb132-10"><a href="Chapter3.html#cb132-10" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> IC, <span class="at">shape =</span> IC),</span>
<span id="cb132-11"><a href="Chapter3.html#cb132-11" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">5</span>, <span class="at">stroke =</span> <span class="dv">2</span>,</span>
<span id="cb132-12"><a href="Chapter3.html#cb132-12" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.7</span>)<span class="sc">+</span></span>
<span id="cb132-13"><a href="Chapter3.html#cb132-13" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">0</span>))<span class="sc">+</span></span>
<span id="cb132-14"><a href="Chapter3.html#cb132-14" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> num)<span class="sc">+</span></span>
<span id="cb132-15"><a href="Chapter3.html#cb132-15" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Information criteria&quot;</span>, <span class="at">color =</span> <span class="st">&quot;&quot;</span>, <span class="at">shape =</span> <span class="st">&quot;&quot;</span>)<span class="sc">+</span></span>
<span id="cb132-16"><a href="Chapter3.html#cb132-16" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb132-17"><a href="Chapter3.html#cb132-17" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-modelAIC"></span>
<img src="Introduction-to-GAM-using-R_files/figure-html/fig-modelAIC-1.png" alt="AIC, AICc, BIC of the models with different number of knots." width="480" />
<p class="caption">
図3.10: AIC, AICc, BIC of the models with different number of knots.
</p>
</div>
<p>しかし、毎回このように様々なノット数でモデリングを行い、情報量規準などに基づいた比較を行うのは時間がかかってしまう。そこで考えられたのが次節(<a href="Chapter3.html#s3-8">3.8</a>)で説明するpenalized sline modelと呼ばれるものである。</p>
</div>
<div id="s3-8" class="section level2 hasAnchor" number="3.8">
<h2><span class="header-section-number">3.8</span> Penalized quadratic spline regression<a href="Chapter3.html#s3-8" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>各モデルにおいて、回帰係数などのパラメータは最小二乗法によって推定されている。すなわち、以下で表される残差平方和が最小になるように推定を行っている。</p>
<p><span class="math display">\[
Minimize\; over \;\mathbf{\beta} : \sum_i \epsilon_i^2
\]</span></p>
<p>行列形式で表すと以下のようになる。<br />
<span class="math display">\[
Minimize\; over \;\mathbf{\beta} : ||\mathbf{\epsilon^2}|| = ||\mathbf{Y} - \mathbf{X} \times \mathbf{\beta}||^2
\]</span></p>
<p>このとき、<span class="math inline">\(\mathbf{\beta}\)</span>の推定値は以下の通りである(第<a href="Chapter1.html#c1">1</a>章も参照)。</p>
<p><span class="math display">\[
\hat{\mathbf{\beta}} = (\mathbf{X^t} \times \mathbf{X})^{-1} \times \mathbf{X^t} \times y
\]</span></p>
<p>さて、ここで式<a href="Chapter3.html#eq:qsr">(3.2)</a>に従う二次スプライン回帰モデルを考える。もし両端を除くノット数がKであるとき、<span class="math inline">\((Depth-k_j)_+^2\)</span>の回帰係数$<em>{11}, </em>{12}, , _{1K} $を推定することになる。これらのパラメータは平滑化曲線(回帰曲線)の形に柔軟性を与える(= 形を調整する)役割を担っている。</p>
<p>ノット数を変えることで曲線の形を調整することはできるが、図<a href="Chapter3.html#fig:fig-fitted-all2">3.9</a>で見たようにノット数によって曲線の形は大きくは変わらなかった。そこで、ノット数を変えるのではなく、ノット数は固定して<strong>推定されるパラメータに制限をかけることでsmootherの形を調整する</strong>アプローチを考える。例えば、パラメータ<span class="math inline">\(\beta_{11}, \beta_{12}, \dots, \beta_{1K}\)</span>の二乗がある定数<span class="math inline">\(C\)</span>以下になるように推定を行うことを考える。</p>
<p><span class="math display" id="eq:condition">\[
\beta_{11}^2 + \beta_{12}^2 + \cdots + \beta_{1K}^2 &lt; C \tag{3.6}
\]</span></p>
<p>こうした方法は<strong>制限付き最適化(constrained optimization)</strong>と呼ばれる。</p>
<p>ある条件内で残差平方和を最小化するパラメータは<strong>ラグランジュの未定乗数法</strong>と呼ばれる方法で推定できる。例として、条件下で以下の関数<span class="math inline">\(f(x,y)\)</span>を最大にする<span class="math inline">\(x,y\)</span>の組み合わせを探すことを考える。</p>
<p><span class="math display">\[
\begin{aligned}
f(x,y) = 2x^2 + 2y^2 \:\: subject \:\: to \:\: x + y = 1
\end{aligned}
\]</span></p>
<p>まず、以下の関数<span class="math inline">\(f(x,y,\lambda)\)</span>を考える。<br />
<span class="math display">\[
f(x,y,\lambda) = 2x^2 + 2y^2 + \lambda(x + y-1)
\]</span></p>
<p>次に、<span class="math inline">\(f(x,y,\lambda)\)</span>をそれぞれの変数について偏微分した値が全て0になるように連立方程式を解く。<br />
<span class="math display">\[
\begin{aligned}
4x + \lambda &amp;= 0\\
4y + \lambda &amp;= 0\\
x + y -1 &amp;= 0
\end{aligned}
\]</span></p>
<p>すると、簡単に<span class="math inline">\(x = 1/2, y= 1/2\)</span>と解けるが、これが条件の下で<span class="math inline">\(f(x,y)\)</span>を最大化する<span class="math inline">\(x\)</span>と<span class="math inline">\(y\)</span>の値である。制限付き最適化についてもまったく同じことを行う。式<a href="Chapter3.html#eq:condition">(3.6)</a>のような条件があるときに<span class="math inline">\(||\mathbf{Y} - \mathbf{X} \times \mathbf{\beta}||\)</span>を最小化するパラメータを求めるには、以下を最小化すればよい。</p>
<p><span class="math display" id="eq:LLM">\[
||\mathbf{Y} - \mathbf{X} \times \mathbf{\beta}|| + \lambda \times (\beta_{11}^2 + \beta_{12}^2 + \cdots + \beta_{1K}^2 + C) \tag{3.7}
\]</span></p>
<p>以下のような<span class="math inline">\(K+3\)</span>次元の行列(<span class="math inline">\(K\)</span>はノット数)<span class="math inline">\(\mathbf{D}\)</span>とベクトル<span class="math inline">\(\mathbf{\beta}\)</span>を定義する。<br />
<span class="math display">\[
\mathbf{D} =
\begin{bmatrix}
0 &amp; \cdots &amp; \quad &amp; \quad &amp; \cdots&amp; 0\\
\vdots &amp; 0 &amp; \quad &amp; \quad &amp; \quad &amp; \vdots\\
\quad &amp; \quad &amp;  0 &amp; \quad &amp; \quad &amp; \quad \\
\quad &amp; \quad &amp; \quad &amp; 1  \quad &amp; \quad &amp; \vdots\\
\vdots &amp; \quad &amp; \quad &amp; \quad &amp; \ddots &amp; 0\\
0 &amp; \cdots &amp; \quad &amp; \cdots &amp; 0 &amp; 1
\end{bmatrix}, \quad
\mathbf{\beta} = \begin{bmatrix}
\beta_1 \\
\beta_2\\
\beta_3\\
\beta_{11}\\
\vdots\\
\beta_{19}
\end{bmatrix}
\]</span></p>
<p>このとき、式<a href="Chapter3.html#eq:LLM">(3.7)</a>は以下のように変形できる。</p>
<p><span class="math display" id="eq:LLM2">\[
||\mathbf{Y} - \mathbf{X} \times \mathbf{\beta}|| + \lambda \times (\mathbf{\beta^t} \times \mathbf{D} \times \mathbf{\beta} - \mathbf{C}) \tag{3.8}
\]</span></p>
<p>これを<span class="math inline">\(\mathbf{\beta}\)</span>について解くと、その推定値は以下のようになる。もし<span class="math inline">\(\lambda = 0\)</span>ならば(= 何も条件がなければ)、推定値は通常の最小二乗法によるものと同じになる。<br />
<span class="math display" id="eq:estbeta">\[
\hat{\mathbf{\beta}} = (\mathbf{X^t} \times \mathbf{X} + \lambda \times \mathbf{D})^{-1} \times \mathbf{X^t} \times \mathbf{y} \tag{3.9}
\]</span></p>
<p><span class="math inline">\(\lambda\)</span>が特定の値を割り当てれば、smoother(<span class="math inline">\(f_{\lambda}\)</span>)を決定することができる。<span class="math inline">\(\hat{\beta}\)</span>は<span class="math inline">\(\lambda\)</span>の値によって変わるので、<span class="math inline">\(f_{\lambda}\)</span>も<span class="math inline">\(\lambda\)</span>によって変わる。<span class="math inline">\(\lambda\)</span>はペナルティの大きさを表すので、<strong>大きいほどスプライン回帰を行わない通常の線形回帰や多項式回帰の結果に近づき、0ならば罰則のないスプライン回帰の結果と同じになる</strong>。<br />
<span class="math display" id="eq:estf">\[
\hat{f_{\lambda}} = \mathbf{X} \times \mathbf{\hat{\beta}} \tag{3.10}
\]</span></p>
<p><span class="math inline">\(\lambda\)</span>の値ごとの曲線を図示したのが図<a href="Chapter3.html#fig:fig-fit-lambda">3.11</a>である。<span class="math inline">\(\lambda\)</span>が大きくなると2次の項までを含む普通の多項式回帰の結果に近づく。</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="Chapter3.html#cb133-1" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="dv">9</span></span>
<span id="cb133-2"><a href="Chapter3.html#cb133-2" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">3</span> <span class="sc">+</span> K))</span>
<span id="cb133-3"><a href="Chapter3.html#cb133-3" tabindex="-1"></a>D[<span class="dv">1</span>,<span class="dv">1</span>]<span class="ot">&lt;-</span>D[<span class="dv">2</span>,<span class="dv">2</span>]<span class="ot">&lt;-</span>D[<span class="dv">3</span>,<span class="dv">3</span>] <span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb133-4"><a href="Chapter3.html#cb133-4" tabindex="-1"></a></span>
<span id="cb133-5"><a href="Chapter3.html#cb133-5" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(M3_5)</span>
<span id="cb133-6"><a href="Chapter3.html#cb133-6" tabindex="-1"></a>lambdas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>,<span class="fl">0.7</span>, <span class="fl">0.75</span>, <span class="dv">1</span>,<span class="dv">10</span>)</span>
<span id="cb133-7"><a href="Chapter3.html#cb133-7" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb133-8"><a href="Chapter3.html#cb133-8" tabindex="-1"></a>Yhat <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb133-9"><a href="Chapter3.html#cb133-9" tabindex="-1"></a></span>
<span id="cb133-10"><a href="Chapter3.html#cb133-10" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(lambdas)){</span>
<span id="cb133-11"><a href="Chapter3.html#cb133-11" tabindex="-1"></a>  beta[[i]] <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">t</span>(X) <span class="sc">%*%</span> X <span class="sc">+</span> lambdas[i] <span class="sc">*</span> D) <span class="sc">%*%</span><span class="fu">t</span>(X) <span class="sc">%*%</span> BL<span class="sc">$</span>Sources</span>
<span id="cb133-12"><a href="Chapter3.html#cb133-12" tabindex="-1"></a>  MyDepth <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="at">length =</span><span class="dv">100</span>)</span>
<span id="cb133-13"><a href="Chapter3.html#cb133-13" tabindex="-1"></a>  XPred <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> MyDepth <span class="sc">+</span> <span class="fu">I</span>(MyDepth<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb133-14"><a href="Chapter3.html#cb133-14" tabindex="-1"></a>                        <span class="fu">rhs2</span>(MyDepth, q_Depth[<span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb133-15"><a href="Chapter3.html#cb133-15" tabindex="-1"></a>                        <span class="fu">rhs2</span>(MyDepth, q_Depth[<span class="dv">2</span>]) <span class="sc">+</span></span>
<span id="cb133-16"><a href="Chapter3.html#cb133-16" tabindex="-1"></a>                        <span class="fu">rhs2</span>(MyDepth, q_Depth[<span class="dv">3</span>]) <span class="sc">+</span></span>
<span id="cb133-17"><a href="Chapter3.html#cb133-17" tabindex="-1"></a>                        <span class="fu">rhs2</span>(MyDepth, q_Depth[<span class="dv">4</span>]) <span class="sc">+</span></span>
<span id="cb133-18"><a href="Chapter3.html#cb133-18" tabindex="-1"></a>                        <span class="fu">rhs2</span>(MyDepth, q_Depth[<span class="dv">5</span>]) <span class="sc">+</span></span>
<span id="cb133-19"><a href="Chapter3.html#cb133-19" tabindex="-1"></a>                        <span class="fu">rhs2</span>(MyDepth, q_Depth[<span class="dv">6</span>]) <span class="sc">+</span></span>
<span id="cb133-20"><a href="Chapter3.html#cb133-20" tabindex="-1"></a>                        <span class="fu">rhs2</span>(MyDepth, q_Depth[<span class="dv">7</span>]) <span class="sc">+</span></span>
<span id="cb133-21"><a href="Chapter3.html#cb133-21" tabindex="-1"></a>                        <span class="fu">rhs2</span>(MyDepth, q_Depth[<span class="dv">8</span>]) <span class="sc">+</span></span>
<span id="cb133-22"><a href="Chapter3.html#cb133-22" tabindex="-1"></a>                        <span class="fu">rhs2</span>(MyDepth, q_Depth[<span class="dv">9</span>]))</span>
<span id="cb133-23"><a href="Chapter3.html#cb133-23" tabindex="-1"></a></span>
<span id="cb133-24"><a href="Chapter3.html#cb133-24" tabindex="-1"></a>  Yhat[[i]] <span class="ot">&lt;-</span> XPred <span class="sc">%*%</span> <span class="fu">as.vector</span>(beta[[i]]) <span class="sc">%&gt;%</span> </span>
<span id="cb133-25"><a href="Chapter3.html#cb133-25" tabindex="-1"></a>    <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb133-26"><a href="Chapter3.html#cb133-26" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">fitted =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb133-27"><a href="Chapter3.html#cb133-27" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">lambda =</span> lambdas[i],</span>
<span id="cb133-28"><a href="Chapter3.html#cb133-28" tabindex="-1"></a>           <span class="at">Depth =</span> MyDepth)</span>
<span id="cb133-29"><a href="Chapter3.html#cb133-29" tabindex="-1"></a>}</span>
<span id="cb133-30"><a href="Chapter3.html#cb133-30" tabindex="-1"></a></span>
<span id="cb133-31"><a href="Chapter3.html#cb133-31" tabindex="-1"></a>fitted_lambda <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(Yhat[[<span class="dv">1</span>]], Yhat[[<span class="dv">2</span>]], Yhat[[<span class="dv">3</span>]], Yhat[[<span class="dv">4</span>]],</span>
<span id="cb133-32"><a href="Chapter3.html#cb133-32" tabindex="-1"></a>                           Yhat[[<span class="dv">5</span>]],Yhat[[<span class="dv">6</span>]]) <span class="sc">%&gt;%</span> </span>
<span id="cb133-33"><a href="Chapter3.html#cb133-33" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lambda_text =</span> <span class="fu">str_c</span>(<span class="st">&quot;lambda = &quot;</span>, lambda))</span>
<span id="cb133-34"><a href="Chapter3.html#cb133-34" tabindex="-1"></a></span>
<span id="cb133-35"><a href="Chapter3.html#cb133-35" tabindex="-1"></a>BL <span class="sc">%&gt;%</span> </span>
<span id="cb133-36"><a href="Chapter3.html#cb133-36" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb133-37"><a href="Chapter3.html#cb133-37" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Depth, <span class="at">y =</span> Sources),</span>
<span id="cb133-38"><a href="Chapter3.html#cb133-38" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">&quot;grey54&quot;</span>)<span class="sc">+</span></span>
<span id="cb133-39"><a href="Chapter3.html#cb133-39" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> fitted_lambda,</span>
<span id="cb133-40"><a href="Chapter3.html#cb133-40" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> Depth, <span class="at">y =</span> fitted),</span>
<span id="cb133-41"><a href="Chapter3.html#cb133-41" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb133-42"><a href="Chapter3.html#cb133-42" tabindex="-1"></a>  <span class="fu">facet_rep_wrap</span>(<span class="sc">~</span>lambda_text, <span class="at">repeat.tick.labels =</span> <span class="cn">TRUE</span>)<span class="sc">+</span></span>
<span id="cb133-43"><a href="Chapter3.html#cb133-43" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)<span class="sc">+</span></span>
<span id="cb133-44"><a href="Chapter3.html#cb133-44" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>,</span>
<span id="cb133-45"><a href="Chapter3.html#cb133-45" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb133-46"><a href="Chapter3.html#cb133-46" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>))<span class="sc">+</span></span>
<span id="cb133-47"><a href="Chapter3.html#cb133-47" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">120</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="fl">0.105</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb133-48"><a href="Chapter3.html#cb133-48" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Scaled depth&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Sources&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-fit-lambda"></span>
<img src="Introduction-to-GAM-using-R_files/figure-html/fig-fit-lambda-1.png" alt="Three smoothers using different values for λ" width="1152" />
<p class="caption">
図3.11: Three smoothers using different values for λ
</p>
</div>
</div>
<div id="other-smoothers" class="section level2 hasAnchor" number="3.9">
<h2><span class="header-section-number">3.9</span> Other smoothers<a href="Chapter3.html#other-smoothers" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><code>mgcv</code>パッケージや<code>gamlss</code>パッケージで用いられるsmootherには様々な種類がある。本節では、これらのいくつかについてまとめ、次節(<a href="Chapter3.html#s3-10">3.10</a>)では、3次平滑化スプラインについて詳しく解説する。</p>
<p>二次スプライン回帰(第<a href="Chapter3.html#s3-5">3.5</a>節)や罰則付きの二次スプライン回帰(第<a href="Chapter3.html#s3-8">3.8</a>節)では、以下の変数が説明変数(基底)となる。</p>
<p><span class="math display">\[
1, Depth_i^2, (Depth_i - k_1)_+^2, (Depth_i - k_2)_+^2, \dots, (Depth_i - k_9)_+^2
\]</span></p>
<p>これは<span class="math inline">\(p\)</span>次までの項を含むモデルについて以下のように一般化できる。このようなモデルは<strong>p次スプライン回帰モデル</strong>または<em>罰則付きp次スプライン回帰</em>と呼ばれる。<br />
<span class="math display">\[
1, Depth_i^2, (Depth_i - k_1)_+^p, (Depth_i - k_2)_+^p, \dots, (Depth_i - k_K)_+^p
\]</span></p>
<p>これらのモデルの問題点は各変数が強く相関している可能性が高いことである(特にノット数が多いときは)。<strong>Bスプライン平滑化(B-spline smoothing)</strong>と呼ばれる手法は、変数変換を施すことでこの問題を解決する。</p>
<p>絶対値の<span class="math inline">\(p\)</span>乗項を含むモデルを考えることもできる。そのようなsmootherは<strong>放射基底平滑化(radial basis smoother)</strong>と呼ばれ、以下の基底を含む。</p>
<p><span class="math display">\[
1, Depth_i^2, |Depth_i - k_1|^p, |Depth_i - k_2|^p, \dots, |Depth_i - k_K|^p
\]</span></p>
</div>
<div id="s3-10" class="section level2 hasAnchor" number="3.10">
<h2><span class="header-section-number">3.10</span> Cubic smoothing spline<a href="Chapter3.html#s3-10" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>第<a href="Chapter3.html#s3-8">3.8</a>節でやったように<span class="math inline">\(\beta_{11}, \dots, \beta_{1K}\)</span>に制限を設けるのではなく、smootherの二次導関数(二回微分値)の和に制限を設ける方法もある。その場合、以下を最小化するようなパラメータを推定する。このような方法を<strong>平滑化スプライン</strong>(smoothing spline)という。</p>
<p><span class="math display" id="eq:2deriviate">\[
||\mathbf{Y} - \mathbf{X} \times \mathbf{\beta}||^2 + \lambda \times 全ポイントでの二次導関数の和 \tag{3.11}
\]</span></p>
<p>一般にsmoother(<span class="math inline">\(f(x)\)</span>)の二次導関数を<span class="math inline">\(f&#39;&#39;(x)\)</span>とするとき、<span class="math inline">\(f&#39;&#39;(x)\)</span>の値が低いほど<span class="math inline">\(f(x)\)</span>はより直線的であることを示す。全ての<span class="math inline">\(x\)</span>について<span class="math inline">\(f&#39;&#39;(x)\)</span>の値を合計するためには、<span class="math inline">\(f&#39;&#39;(x)\)</span>を積分してやればよい。</p>
<p>そのため、式<a href="Chapter3.html#eq:2deriviate">(3.11)</a>は以下のように書き直せる。<br />
<span class="math display" id="eq:cubic">\[
||\mathbf{Y} - \mathbf{X} \times \mathbf{\beta}||^2 + \lambda \times \int f&#39;&#39;(x) dx \tag{3.12}
\]</span></p>
<p><span class="citation">Wood (<a href="#ref-Wood2017">2017</a>)</span> は、この基準で最小になる<span class="math inline">\(f(x)\)</span>が3次スプラインであることを証明している。また、式<a href="Chapter3.html#eq:cubic">(3.12)</a>は式<a href="Chapter3.html#eq:LLM2">(3.8)</a>のように書き直すことが分かっているので、<span class="math inline">\(\beta\)</span>の推定値を得るのに積分をする必要はなく、式<a href="Chapter3.html#eq:estbeta">(3.9)</a>で求めることができる。</p>
<p><span class="math inline">\(\mathbf{\beta}\)</span>を推定するためには、<span class="math inline">\(\mathbf{X}\)</span>とパラメータ<span class="math inline">\(\lambda\)</span>、罰則を表す行列<span class="math inline">\(\mathbf{D}\)</span>を知る必要がある。3次平滑化スプライン(cubic smoothing spline)の基本は3次回帰スプライン(cubic regression spline)と同じなので、<span class="math inline">\(\mathbf{X}\)</span>は同じものを用いることができる。</p>
<p>両端を除くノット数はこれまでと同様に9とする。</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="Chapter3.html#cb134-1" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">spl.X</span>(BL<span class="sc">$</span>Depth, q_Depth)</span></code></pre></div>
<p><span class="math inline">\(\mathbf{D}\)</span>は<span class="math inline">\(11\times 11\)</span>の正方行列で、成分は第<a href="Chapter3.html#s3-6">3.6</a>で出てきた<span class="math inline">\(R(X,z)\)</span>によって決まる。<span class="math inline">\(\mathbf{D}(i + 2, j + 2)\)</span>は<span class="math inline">\(R(x_i,x_j)\)</span>によって決まり、<span class="math inline">\(x_iとx_j\)</span>は両端を除くノットの値である。</p>
<p>Rでは以下の関数で計算できる。</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="Chapter3.html#cb135-1" tabindex="-1"></a>spl.S <span class="ot">&lt;-</span> <span class="cf">function</span>(xk){</span>
<span id="cb135-2"><a href="Chapter3.html#cb135-2" tabindex="-1"></a>  q <span class="ot">&lt;-</span> <span class="fu">length</span>(xk) <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb135-3"><a href="Chapter3.html#cb135-3" tabindex="-1"></a>  S <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> q, <span class="at">ncol =</span> q)</span>
<span id="cb135-4"><a href="Chapter3.html#cb135-4" tabindex="-1"></a>  S[<span class="dv">3</span><span class="sc">:</span>q, <span class="dv">3</span><span class="sc">:</span>q] <span class="ot">&lt;-</span> <span class="fu">outer</span>(xk, xk, <span class="at">FUN =</span> rk)</span>
<span id="cb135-5"><a href="Chapter3.html#cb135-5" tabindex="-1"></a>  S</span>
<span id="cb135-6"><a href="Chapter3.html#cb135-6" tabindex="-1"></a>}</span>
<span id="cb135-7"><a href="Chapter3.html#cb135-7" tabindex="-1"></a></span>
<span id="cb135-8"><a href="Chapter3.html#cb135-8" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="fu">spl.S</span>(q_Depth)</span></code></pre></div>
<p>最後に、<span class="math inline">\(\lambda\)</span>については交差検証(第<a href="Chapter2.html#s2-4">2.4</a>節を参照)を行うことで最適な値を決定する。例えば、<span class="math inline">\(\lambda\)</span>を0から0.01の間に25個とるとき、交差検証スコアは以下のように算出できる。</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="Chapter3.html#cb136-1" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="dv">25</span></span>
<span id="cb136-2"><a href="Chapter3.html#cb136-2" tabindex="-1"></a>OCV <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">length =</span> K)</span>
<span id="cb136-3"><a href="Chapter3.html#cb136-3" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="fl">0.001</span>, <span class="at">length.out =</span> K)</span>
<span id="cb136-4"><a href="Chapter3.html#cb136-4" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">nrow</span>(BL)</span>
<span id="cb136-5"><a href="Chapter3.html#cb136-5" tabindex="-1"></a></span>
<span id="cb136-6"><a href="Chapter3.html#cb136-6" tabindex="-1"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>K){</span>
<span id="cb136-7"><a href="Chapter3.html#cb136-7" tabindex="-1"></a>  lambdas <span class="ot">&lt;-</span> lambda[j]</span>
<span id="cb136-8"><a href="Chapter3.html#cb136-8" tabindex="-1"></a>  EP <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">length =</span> N)</span>
<span id="cb136-9"><a href="Chapter3.html#cb136-9" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N){</span>
<span id="cb136-10"><a href="Chapter3.html#cb136-10" tabindex="-1"></a>    <span class="co"># i番目のデータを除く</span></span>
<span id="cb136-11"><a href="Chapter3.html#cb136-11" tabindex="-1"></a>    Xi <span class="ot">&lt;-</span> X[<span class="sc">-</span>i, ]</span>
<span id="cb136-12"><a href="Chapter3.html#cb136-12" tabindex="-1"></a>    betai <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">t</span>(Xi) <span class="sc">%*%</span> Xi <span class="sc">+</span> lambdas <span class="sc">*</span> D) <span class="sc">%*%</span><span class="fu">t</span>(Xi) <span class="sc">%*%</span> BL<span class="sc">$</span>Sources[<span class="sc">-</span>i]</span>
<span id="cb136-13"><a href="Chapter3.html#cb136-13" tabindex="-1"></a>    Yi <span class="ot">&lt;-</span> X[i,] <span class="sc">%*%</span> betai</span>
<span id="cb136-14"><a href="Chapter3.html#cb136-14" tabindex="-1"></a>    EP[i] <span class="ot">&lt;-</span> BL<span class="sc">$</span>Sources[i] <span class="sc">-</span> Yi</span>
<span id="cb136-15"><a href="Chapter3.html#cb136-15" tabindex="-1"></a>  }</span>
<span id="cb136-16"><a href="Chapter3.html#cb136-16" tabindex="-1"></a>  OCV[j] <span class="ot">&lt;-</span> <span class="fu">sum</span>(EP<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>N</span>
<span id="cb136-17"><a href="Chapter3.html#cb136-17" tabindex="-1"></a>}</span></code></pre></div>
<p>図示すると以下のようになり、<span class="math inline">\(\lambda = 0.000208\)</span>のときに交差検証スコアが最も低くなることが分かる(図<a href="Chapter3.html#fig:fig-ocv-gam">3.12</a>)。</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="Chapter3.html#cb137-1" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">lambda =</span> lambda,</span>
<span id="cb137-2"><a href="Chapter3.html#cb137-2" tabindex="-1"></a>           <span class="at">OCV =</span> OCV) <span class="sc">%&gt;%</span> </span>
<span id="cb137-3"><a href="Chapter3.html#cb137-3" tabindex="-1"></a>  <span class="fu">arrange</span>(OCV) <span class="ot">-&gt;</span> ocv</span>
<span id="cb137-4"><a href="Chapter3.html#cb137-4" tabindex="-1"></a></span>
<span id="cb137-5"><a href="Chapter3.html#cb137-5" tabindex="-1"></a>ocv <span class="sc">%&gt;%</span> </span>
<span id="cb137-6"><a href="Chapter3.html#cb137-6" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> lambda, <span class="at">y =</span> OCV))<span class="sc">+</span></span>
<span id="cb137-7"><a href="Chapter3.html#cb137-7" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb137-8"><a href="Chapter3.html#cb137-8" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">x=</span> ocv[<span class="dv">1</span>,<span class="dv">1</span>], <span class="at">y =</span> ocv[<span class="dv">1</span>,<span class="dv">2</span>],</span>
<span id="cb137-9"><a href="Chapter3.html#cb137-9" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;red2&quot;</span>, <span class="at">size =</span> <span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb137-10"><a href="Chapter3.html#cb137-10" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>,</span>
<span id="cb137-11"><a href="Chapter3.html#cb137-11" tabindex="-1"></a>          <span class="at">x=</span> ocv[<span class="dv">1</span>,<span class="dv">1</span>]<span class="sc">+</span> <span class="fl">0.000002</span>, <span class="at">y =</span> ocv[<span class="dv">1</span>,<span class="dv">2</span>] <span class="sc">+</span> <span class="fl">0.05</span>,</span>
<span id="cb137-12"><a href="Chapter3.html#cb137-12" tabindex="-1"></a>          <span class="at">label =</span> <span class="fu">str_c</span>(<span class="st">&quot;lambda = &quot;</span>, <span class="fu">round</span>(ocv[<span class="dv">1</span>,<span class="dv">1</span>],<span class="dv">5</span>)))<span class="sc">+</span></span>
<span id="cb137-13"><a href="Chapter3.html#cb137-13" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">x=</span> ocv[<span class="dv">1</span>,<span class="dv">1</span>] <span class="sc">+</span> <span class="fl">0.00002</span>, <span class="at">y =</span> ocv[<span class="dv">1</span>,<span class="dv">2</span>] <span class="sc">+</span> <span class="fl">0.04</span>,</span>
<span id="cb137-14"><a href="Chapter3.html#cb137-14" tabindex="-1"></a>               <span class="at">xend =</span> ocv[<span class="dv">1</span>,<span class="dv">1</span>], <span class="at">yend =</span> ocv[<span class="dv">1</span>,<span class="dv">2</span>])<span class="sc">+</span></span>
<span id="cb137-15"><a href="Chapter3.html#cb137-15" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb137-16"><a href="Chapter3.html#cb137-16" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-ocv-gam"></span>
<img src="Introduction-to-GAM-using-R_files/figure-html/fig-ocv-gam-1.png" alt="OCV score plotted versus λ for the cubic smoothing spline." width="432" />
<p class="caption">
図3.12: OCV score plotted versus λ for the cubic smoothing spline.
</p>
</div>
<p><br/></p>
<p>データが多いときには上記の交差検証スコアを算出するのは非常に時間がかかるが、交差検証スコアは以下の式で計算できることが数学的にわかっている。なお、<span class="math inline">\(A_{ii}\)</span>はハット行列<span class="math inline">\(\mathbf{S}\)</span>の対角成分である(後述)。</p>
<p><span class="math display">\[
V_0 =  \frac{1}{n}\sum_{i = 1} ^n (Y_i - \hat{f(X_i)})^2/(1-A_{ii})
\]</span></p>
<p>こちらの交差検証スコアは以下のように計算できる。</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="Chapter3.html#cb138-1" tabindex="-1"></a>OCV2 <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">length =</span> K)</span>
<span id="cb138-2"><a href="Chapter3.html#cb138-2" tabindex="-1"></a></span>
<span id="cb138-3"><a href="Chapter3.html#cb138-3" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>K){</span>
<span id="cb138-4"><a href="Chapter3.html#cb138-4" tabindex="-1"></a>    lambdas <span class="ot">&lt;-</span> lambda[i]</span>
<span id="cb138-5"><a href="Chapter3.html#cb138-5" tabindex="-1"></a>    S <span class="ot">&lt;-</span> X<span class="sc">%*%</span><span class="fu">solve</span>(<span class="fu">t</span>(X) <span class="sc">%*%</span> X <span class="sc">+</span> lambdas <span class="sc">*</span> D) <span class="sc">%*%</span><span class="fu">t</span>(X) </span>
<span id="cb138-6"><a href="Chapter3.html#cb138-6" tabindex="-1"></a>    Sii <span class="ot">&lt;-</span> <span class="fu">diag</span>(S)</span>
<span id="cb138-7"><a href="Chapter3.html#cb138-7" tabindex="-1"></a>    fit <span class="ot">&lt;-</span> S <span class="sc">%*%</span> BL<span class="sc">$</span>Sources</span>
<span id="cb138-8"><a href="Chapter3.html#cb138-8" tabindex="-1"></a>    E <span class="ot">&lt;-</span> BL<span class="sc">$</span>Sources <span class="sc">-</span> fit</span>
<span id="cb138-9"><a href="Chapter3.html#cb138-9" tabindex="-1"></a>    OCV2[i] <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">/</span>N) <span class="sc">*</span><span class="fu">sum</span>((E<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>Sii))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb138-10"><a href="Chapter3.html#cb138-10" tabindex="-1"></a>}</span></code></pre></div>
<p>これは先ほど計算した交差検証スコアと全く同じ値を与える。</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="Chapter3.html#cb139-1" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">lambda =</span> lambda,</span>
<span id="cb139-2"><a href="Chapter3.html#cb139-2" tabindex="-1"></a>           <span class="at">OCV =</span> OCV,</span>
<span id="cb139-3"><a href="Chapter3.html#cb139-3" tabindex="-1"></a>           <span class="at">OCV2 =</span>OCV2)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["lambda"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["OCV"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["OCV2"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"0.000000e+00","2":"85.00039","3":"85.00039"},{"1":"4.166667e-05","2":"84.94973","3":"84.94973"},{"1":"8.333333e-05","2":"84.91676","3":"84.91676"},{"1":"1.250000e-04","2":"84.89619","3":"84.89619"},{"1":"1.666667e-04","2":"84.88462","3":"84.88462"},{"1":"2.083333e-04","2":"84.87980","3":"84.87980"},{"1":"2.500000e-04","2":"84.88016","3":"84.88016"},{"1":"2.916667e-04","2":"84.88457","3":"84.88457"},{"1":"3.333333e-04","2":"84.89221","3":"84.89221"},{"1":"3.750000e-04","2":"84.90246","3":"84.90246"},{"1":"4.166667e-04","2":"84.91485","3":"84.91485"},{"1":"4.583333e-04","2":"84.92900","3":"84.92900"},{"1":"5.000000e-04","2":"84.94464","3":"84.94464"},{"1":"5.416667e-04","2":"84.96151","3":"84.96151"},{"1":"5.833333e-04","2":"84.97944","3":"84.97944"},{"1":"6.250000e-04","2":"84.99826","3":"84.99826"},{"1":"6.666667e-04","2":"85.01786","3":"85.01786"},{"1":"7.083333e-04","2":"85.03811","3":"85.03811"},{"1":"7.500000e-04","2":"85.05895","3":"85.05895"},{"1":"7.916667e-04","2":"85.08028","3":"85.08028"},{"1":"8.333333e-04","2":"85.10204","3":"85.10204"},{"1":"8.750000e-04","2":"85.12418","3":"85.12418"},{"1":"9.166667e-04","2":"85.14665","3":"85.14665"},{"1":"9.583333e-04","2":"85.16941","3":"85.16941"},{"1":"1.000000e-03","2":"85.19243","3":"85.19243"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><br/></p>
<p>さて、ここまでの説明で<span class="math inline">\(\mathbf{X}\)</span>、<span class="math inline">\(\mathbf{D}\)</span>、<span class="math inline">\(\lambda\)</span>を求めることができたので、<span class="math inline">\(\mathbf{\beta}\)</span>を求めてsmootherを描くことができる。</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="Chapter3.html#cb140-1" tabindex="-1"></a><span class="do">## 先敵のlambda</span></span>
<span id="cb140-2"><a href="Chapter3.html#cb140-2" tabindex="-1"></a>lambda_opt <span class="ot">&lt;-</span> ocv[<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb140-3"><a href="Chapter3.html#cb140-3" tabindex="-1"></a></span>
<span id="cb140-4"><a href="Chapter3.html#cb140-4" tabindex="-1"></a><span class="do">## betaの推定値</span></span>
<span id="cb140-5"><a href="Chapter3.html#cb140-5" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">t</span>(X) <span class="sc">%*%</span> X <span class="sc">+</span> lambda_opt<span class="sc">*</span>D) <span class="sc">%*%</span> <span class="fu">t</span>(X) <span class="sc">%*%</span> BL<span class="sc">$</span>Sources</span>
<span id="cb140-6"><a href="Chapter3.html#cb140-6" tabindex="-1"></a></span>
<span id="cb140-7"><a href="Chapter3.html#cb140-7" tabindex="-1"></a><span class="do">## 図示用の行列X</span></span>
<span id="cb140-8"><a href="Chapter3.html#cb140-8" tabindex="-1"></a>nd <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Depth =</span> <span class="fu">seq</span>(<span class="fu">min</span>(BL<span class="sc">$</span>Depth), <span class="fu">max</span>(BL<span class="sc">$</span>Depth), <span class="at">length =</span> <span class="dv">100</span>))</span>
<span id="cb140-9"><a href="Chapter3.html#cb140-9" tabindex="-1"></a>Xp <span class="ot">&lt;-</span> <span class="fu">spl.X</span>(nd<span class="sc">$</span>Depth, q_Depth)</span>
<span id="cb140-10"><a href="Chapter3.html#cb140-10" tabindex="-1"></a></span>
<span id="cb140-11"><a href="Chapter3.html#cb140-11" tabindex="-1"></a><span class="do">## smoother</span></span>
<span id="cb140-12"><a href="Chapter3.html#cb140-12" tabindex="-1"></a>fitted_css <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">fit =</span> Xp<span class="sc">%*%</span>beta) <span class="sc">%&gt;%</span> </span>
<span id="cb140-13"><a href="Chapter3.html#cb140-13" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd)</span></code></pre></div>
<p>図<a href="Chapter3.html#fig:fig-fit-css">3.13</a>は推定された回帰曲線を図示したものである。</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="Chapter3.html#cb141-1" tabindex="-1"></a>BL <span class="sc">%&gt;%</span> </span>
<span id="cb141-2"><a href="Chapter3.html#cb141-2" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb141-3"><a href="Chapter3.html#cb141-3" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Depth, <span class="at">y =</span> Sources),</span>
<span id="cb141-4"><a href="Chapter3.html#cb141-4" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">&quot;grey54&quot;</span>)<span class="sc">+</span></span>
<span id="cb141-5"><a href="Chapter3.html#cb141-5" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> fitted_css,</span>
<span id="cb141-6"><a href="Chapter3.html#cb141-6" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> Depth, <span class="at">y =</span> fit),</span>
<span id="cb141-7"><a href="Chapter3.html#cb141-7" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb141-8"><a href="Chapter3.html#cb141-8" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)<span class="sc">+</span></span>
<span id="cb141-9"><a href="Chapter3.html#cb141-9" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>,</span>
<span id="cb141-10"><a href="Chapter3.html#cb141-10" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb141-11"><a href="Chapter3.html#cb141-11" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>))<span class="sc">+</span></span>
<span id="cb141-12"><a href="Chapter3.html#cb141-12" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">120</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="fl">0.105</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb141-13"><a href="Chapter3.html#cb141-13" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Scaled depth&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Sources&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-fit-css"></span>
<img src="Introduction-to-GAM-using-R_files/figure-html/fig-fit-css-1.png" alt="Estimated cubic smoothing spline for the bioluminescence data." width="432" />
<p class="caption">
図3.13: Estimated cubic smoothing spline for the bioluminescence data.
</p>
</div>
</div>
<div id="summary-of-smoother-types" class="section level2 hasAnchor" number="3.11">
<h2><span class="header-section-number">3.11</span> Summary of smoother types<a href="Chapter3.html#summary-of-smoother-types" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>これまで見てきた手法では、以下の4つの手法でsmootherの形を調整してきた。</p>
<ol style="list-style-type: decimal">
<li>移動平均や局所回帰の範囲を変更する。<br />
</li>
<li>スプライン回帰のノット数を変更する(= linear or quadratic spline regression)。<br />
</li>
<li>パラメータに対して制限を設ける(= 制限付き最適化)<br />
</li>
<li>二次導関数に対して制限を設ける(= cubic smoothing spline)</li>
</ol>
</div>
<div id="degree-of-freedom-of-smoother" class="section level2 hasAnchor" number="3.12">
<h2><span class="header-section-number">3.12</span> Degree of freedom of smoother<a href="Chapter3.html#degree-of-freedom-of-smoother" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>式<a href="Chapter3.html#eq:estbeta">(3.9)</a>回帰係数のパラメータ<span class="math inline">\(\mathbf{\beta}\)</span>は以下の式で与えられる。</p>
<p><span class="math display">\[
\hat{\mathbf{\beta}} = (\mathbf{X^t} \times \mathbf{X} + \lambda \times \mathbf{D})^{-1} \times \mathbf{X^t} \times \mathbf{y}
\]</span></p>
<p>また、式<a href="Chapter3.html#eq:estf">(3.10)</a>で見たようにsmootherは以下のように書ける。<br />
<span class="math display">\[
\hat{f(_{\lambda})} = \mathbf{X} \times \hat{\mathbf{\beta}}
\]</span></p>
<p>これらを合わせると、以下のように書ける。<br />
<span class="math display">\[
\begin{aligned}
\hat{y} &amp;= \hat{f_{\lambda}} = \mathbf{X} \times (\mathbf{X^t} \times \mathbf{X} + \mathbf{\lambda} \times \mathbf{D})^{-1} \times \mathbf{X^t} \times \mathbf{y} \\
&amp;= S_{\mathbf{\lambda}} \times \mathbf{y}
\end{aligned}
\]</span></p>
<p>ここで、<span class="math inline">\(\mathbf{S_{\lambda}}\)</span>は重回帰分析のときに出たハット行列(第<a href="Chapter1.html#c1">1</a>章参照)と同じ役割を持っている。第<a href="Chapter1.html#c1">1</a>章で、重回帰分析については自由度はハット行列の対角成分を合計することで得られることを見た。smootherの自由度も<span class="math inline">\(\mathbf{S_{\lambda}}\)</span>の対角成分の合計によって求めることができる。</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="Chapter3.html#cb142-1" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">spl.X</span>(BL<span class="sc">$</span>Depth, q_Depth)</span>
<span id="cb142-2"><a href="Chapter3.html#cb142-2" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="fu">spl.S</span>(q_Depth)</span>
<span id="cb142-3"><a href="Chapter3.html#cb142-3" tabindex="-1"></a>lambda_opt <span class="ot">&lt;-</span> ocv[<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb142-4"><a href="Chapter3.html#cb142-4" tabindex="-1"></a></span>
<span id="cb142-5"><a href="Chapter3.html#cb142-5" tabindex="-1"></a><span class="do">## Sを求める</span></span>
<span id="cb142-6"><a href="Chapter3.html#cb142-6" tabindex="-1"></a>S.lambda <span class="ot">&lt;-</span> X <span class="sc">%*%</span> <span class="fu">solve</span>(<span class="fu">t</span>(X)<span class="sc">%*%</span>X <span class="sc">+</span> lambda_opt<span class="sc">*</span>D) <span class="sc">%*%</span><span class="fu">t</span>(X)</span>
<span id="cb142-7"><a href="Chapter3.html#cb142-7" tabindex="-1"></a></span>
<span id="cb142-8"><a href="Chapter3.html#cb142-8" tabindex="-1"></a><span class="do">## 自由度を求める  </span></span>
<span id="cb142-9"><a href="Chapter3.html#cb142-9" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">diag</span>(S.lambda))</span>
<span id="cb142-10"><a href="Chapter3.html#cb142-10" tabindex="-1"></a></span>
<span id="cb142-11"><a href="Chapter3.html#cb142-11" tabindex="-1"></a>df1</span></code></pre></div>
<pre><code>## [1] 10.1985</code></pre>
<p>よって、smootherの自由度は10.1985018である。なお、<span class="math inline">\(\lambda\)</span>の値が大きいほど自由度は小さくなる。<span class="math inline">\(\lambda\)</span>の値によって自由度がどう変わるかをプロットしたのが図<a href="Chapter3.html#fig:fig-df-smoother">3.14</a>)だが、このことが確かめられる。</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="Chapter3.html#cb144-1" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">vector</span>()</span>
<span id="cb144-2"><a href="Chapter3.html#cb144-2" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="at">length =</span> <span class="dv">200</span>)</span>
<span id="cb144-3"><a href="Chapter3.html#cb144-3" tabindex="-1"></a></span>
<span id="cb144-4"><a href="Chapter3.html#cb144-4" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(lambda)){</span>
<span id="cb144-5"><a href="Chapter3.html#cb144-5" tabindex="-1"></a>  S.lambda <span class="ot">&lt;-</span> X <span class="sc">%*%</span> <span class="fu">solve</span>(<span class="fu">t</span>(X)<span class="sc">%*%</span>X <span class="sc">+</span> lambda[i]<span class="sc">*</span>D) <span class="sc">%*%</span><span class="fu">t</span>(X)</span>
<span id="cb144-6"><a href="Chapter3.html#cb144-6" tabindex="-1"></a>  df[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">diag</span>(S.lambda))</span>
<span id="cb144-7"><a href="Chapter3.html#cb144-7" tabindex="-1"></a>}</span>
<span id="cb144-8"><a href="Chapter3.html#cb144-8" tabindex="-1"></a></span>
<span id="cb144-9"><a href="Chapter3.html#cb144-9" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">lambda =</span> lambda,</span>
<span id="cb144-10"><a href="Chapter3.html#cb144-10" tabindex="-1"></a>           <span class="at">df =</span> df) <span class="sc">%&gt;%</span> </span>
<span id="cb144-11"><a href="Chapter3.html#cb144-11" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> lambda, <span class="at">y =</span> df))<span class="sc">+</span></span>
<span id="cb144-12"><a href="Chapter3.html#cb144-12" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb144-13"><a href="Chapter3.html#cb144-13" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb144-14"><a href="Chapter3.html#cb144-14" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-df-smoother"></span>
<img src="Introduction-to-GAM-using-R_files/figure-html/fig-df-smoother-1.png" alt="Effective degrees of freedom plotted versus λ." width="432" />
<p class="caption">
図3.14: Effective degrees of freedom plotted versus λ.
</p>
</div>
</div>
<div id="bias-variance-trade-off" class="section level2 hasAnchor" number="3.13">
<h2><span class="header-section-number">3.13</span> Bias-variance trade-off<a href="Chapter3.html#bias-variance-trade-off" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>続いて、smootherの信頼区間を計算することを考える。その前に、“bias-variance trade off”について学ぶ必要がある。</p>
<p>あるsmootherについての平均二乗誤差(mean squared error: MSE)は以下のように定義できる。なお、<span class="math inline">\(f(Depth_i)\)</span>は真のsmootherである。</p>
<p><span class="math display">\[
MSE(\hat{f_{\lambda}}(Depth_i)) = E \Bigl( \bigl( \hat{f_{\lambda}}(Depth_i) - f(Depth_i) \bigl)^2 \Bigl)
\]</span></p>
<p>これは、以下のように変形することができる。式の前半部分はバイアス(推定されたsmootherと真のsmootherの差)を表し、後半部分は推定されたsmootherの分散を表す。<span class="math inline">\(\lambda\)</span>が小さいとき、推定されたsmootherはより非線形性が強いのでバイアスは小さくなるが、推定されたsmoother内でのばらつきは大きくなる。<span class="math inline">\(\lambda\)</span>が大きいときはこの逆である。すなわち、バイアスと分散の間にはトレードオフの関係がある。</p>
<p><span class="math display">\[
MSE(\hat{f_{\lambda}}(Depth_i)) = \Bigl(E \bigl( \hat{f_{\lambda}}(Depth_i) \bigl)- f(Depth_i) \Bigl) ^2 + var \bigl(\hat{f_{\lambda}}(Depth_i)\bigl)
\]</span></p>
</div>
<div id="confidence-intervals" class="section level2 hasAnchor" number="3.14">
<h2><span class="header-section-number">3.14</span> Confidence intervals<a href="Chapter3.html#confidence-intervals" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>今回取り上げたsmootherについて、モデルから推定される高原の数の推定値(<span class="math inline">\(\hat{\mathbf{y}}\)</span>)とその分散共分散行列は以下のように書ける。標準偏差は分散共分散行列の対角成分の1/2乗であり、信頼区間はそれの-2倍と2倍した区間となる(正確には自由度を考慮する必要がある)。</p>
<p><span class="math display">\[
\begin{aligned}
\hat{\mathbf{y}} &amp;= \hat{f} = \mathbf{S_{\lambda}} \times \mathbf{y}\\
cov(\hat{f}) &amp;= \sigma^2 \times \mathbf{S_{\lambda}} \times \mathbf{S_{\lambda}}^t
\end{aligned}
\]</span></p>
<p>分散<span class="math inline">\(\sigma^2\)</span>を求めるためには、error degrees of freedomを求める必要がある。これは、以下の式で求められる。なお、<span class="math inline">\(tr()\)</span>は行列の対角成分の和を計算する関数である。</p>
<p><span class="math display">\[
N - tr(2 \times \mathbf{S_{\lambda}} - \mathbf{S_{\lambda}} \times \mathbf{S_{\lambda}}^t)
\]</span></p>
<p>分散の推定値は以下の式で求められる。なお、<span class="math inline">\(df_{e}\)</span>はerror degrees of freedom</p>
<p><span class="math display">\[
(\mathbf{y} - \mathbf{X} \times \hat{\beta})^2/df_{error}
\]</span></p>
<p>Rでは以下のように求められる。</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="Chapter3.html#cb145-1" tabindex="-1"></a><span class="do">## error degrees of freedom</span></span>
<span id="cb145-2"><a href="Chapter3.html#cb145-2" tabindex="-1"></a>df.Error <span class="ot">&lt;-</span> <span class="fu">nrow</span>(BL) <span class="sc">-</span> <span class="fu">sum</span>(<span class="fu">diag</span>(<span class="dv">2</span><span class="sc">*</span>S.lambda <span class="sc">-</span> S.lambda <span class="sc">%*%</span> <span class="fu">t</span>(S.lambda)))</span>
<span id="cb145-3"><a href="Chapter3.html#cb145-3" tabindex="-1"></a></span>
<span id="cb145-4"><a href="Chapter3.html#cb145-4" tabindex="-1"></a><span class="do">## sigma</span></span>
<span id="cb145-5"><a href="Chapter3.html#cb145-5" tabindex="-1"></a>sigma2 <span class="ot">&lt;-</span> <span class="fu">sum</span>((BL<span class="sc">$</span>Sources <span class="sc">-</span> X<span class="sc">%*%</span>beta)<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>df.Error</span>
<span id="cb145-6"><a href="Chapter3.html#cb145-6" tabindex="-1"></a>(sigma <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(sigma2))</span></code></pre></div>
<pre><code>## [1] 9.11692</code></pre>
<p>さて、それでは<span class="math inline">\(\sigma\)</span>が求まったのが標準誤差を計算することができる。図<a href="Chapter3.html#fig:fig-fit-css">3.13</a>で回帰曲線を描いたときに使用した行列<span class="math inline">\(X_p\)</span>について標準誤差を算出すると以下のようになる。<code>se_predY</code>がそれぞれの<span class="math inline">\(Depth\)</span>の値のときの標準誤差である。</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="Chapter3.html#cb147-1" tabindex="-1"></a>Sp.lambda <span class="ot">&lt;-</span> Xp <span class="sc">%*%</span> <span class="fu">solve</span>(<span class="fu">t</span>(Xp)<span class="sc">%*%</span>Xp <span class="sc">+</span> lambda_opt<span class="sc">*</span>D) <span class="sc">%*%</span><span class="fu">t</span>(Xp)</span>
<span id="cb147-2"><a href="Chapter3.html#cb147-2" tabindex="-1"></a>cov_predY <span class="ot">&lt;-</span> sigma2 <span class="sc">*</span> Sp.lambda <span class="sc">%*%</span> <span class="fu">t</span>(Sp.lambda)</span>
<span id="cb147-3"><a href="Chapter3.html#cb147-3" tabindex="-1"></a>se_predY <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">diag</span>(cov_predY))</span></code></pre></div>
<p>よって、95%信頼区間付きの回帰曲線は以下のように書ける(図<a href="Chapter3.html#fig:fig-fit-css2">3.15</a>)。</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="Chapter3.html#cb148-1" tabindex="-1"></a>fitted_css <span class="sc">%&gt;%</span> </span>
<span id="cb148-2"><a href="Chapter3.html#cb148-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lower =</span> fit <span class="sc">-</span> se_predY<span class="sc">*</span><span class="fu">qt</span>(<span class="fl">0.975</span>, <span class="at">df =</span> df1),</span>
<span id="cb148-3"><a href="Chapter3.html#cb148-3" tabindex="-1"></a>         <span class="at">upper =</span> fit <span class="sc">+</span> se_predY<span class="sc">*</span><span class="fu">qt</span>(<span class="fl">0.975</span>, <span class="at">df =</span> df1)) <span class="ot">-&gt;</span> fitted_css2</span>
<span id="cb148-4"><a href="Chapter3.html#cb148-4" tabindex="-1"></a></span>
<span id="cb148-5"><a href="Chapter3.html#cb148-5" tabindex="-1"></a>BL <span class="sc">%&gt;%</span> </span>
<span id="cb148-6"><a href="Chapter3.html#cb148-6" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb148-7"><a href="Chapter3.html#cb148-7" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Depth, <span class="at">y =</span> Sources),</span>
<span id="cb148-8"><a href="Chapter3.html#cb148-8" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">color =</span> <span class="st">&quot;grey54&quot;</span>)<span class="sc">+</span></span>
<span id="cb148-9"><a href="Chapter3.html#cb148-9" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> fitted_css2,</span>
<span id="cb148-10"><a href="Chapter3.html#cb148-10" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> Depth, <span class="at">y =</span> fit),</span>
<span id="cb148-11"><a href="Chapter3.html#cb148-11" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb148-12"><a href="Chapter3.html#cb148-12" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> fitted_css2,</span>
<span id="cb148-13"><a href="Chapter3.html#cb148-13" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> Depth, <span class="at">y =</span> fit, <span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper),</span>
<span id="cb148-14"><a href="Chapter3.html#cb148-14" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb148-15"><a href="Chapter3.html#cb148-15" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb148-16"><a href="Chapter3.html#cb148-16" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)<span class="sc">+</span></span>
<span id="cb148-17"><a href="Chapter3.html#cb148-17" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>,</span>
<span id="cb148-18"><a href="Chapter3.html#cb148-18" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb148-19"><a href="Chapter3.html#cb148-19" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>))<span class="sc">+</span></span>
<span id="cb148-20"><a href="Chapter3.html#cb148-20" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">120</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="fl">0.105</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb148-21"><a href="Chapter3.html#cb148-21" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Scaled depth&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Sources&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-fit-css2"></span>
<img src="Introduction-to-GAM-using-R_files/figure-html/fig-fit-css2-1.png" alt="Estimated cubic smoothing spline for the bioluminescence data with 95% confidence interval." width="432" />
<p class="caption">
図3.15: Estimated cubic smoothing spline for the bioluminescence data with 95% confidence interval.
</p>
</div>
<p><br/></p>
<p>しかし、こうして求めた信頼区間には問題がある。求めた信頼区間は、<strong>推定されたsmoother</strong>(<code>yfit = Xp %*% beta</code>)<strong>がバイアスのない推定値だと仮定したうえで計算されたもの</strong>である。もしsmootherの推定値にバイアスがあるのであれば、図<a href="Chapter3.html#fig:fig-fit-css2">3.15</a>で図示した区間を信頼区間とはみなせない。</p>
<p><code>mgcv</code>パッケージでは、<u>バイアスに対処するために補正を行っている</u>。</p>
</div>
<div id="using-the-function-gam-in-mgcv" class="section level2 hasAnchor" number="3.15">
<h2><span class="header-section-number">3.15</span> Using the function gam in mgcv<a href="Chapter3.html#using-the-function-gam-in-mgcv" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><code>mgcv</code>パッケージを用いたGAMは以下のように実行できる。<code>gam</code>関数は前節までの方法と似ているが、より洗練された方法を用いてsmootherの推定を行っている。</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="Chapter3.html#cb149-1" tabindex="-1"></a>M3_7 <span class="ot">&lt;-</span> <span class="fu">gam</span>(Sources <span class="sc">~</span> <span class="fu">s</span>(Depth), <span class="at">data =</span> BL)</span></code></pre></div>
<p>推定結果は以下の通り。smootherの自由度は8.496で推定された切片は16.7455である。<code>GCV score</code>は、一般化交差検証のスコアである。</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="Chapter3.html#cb150-1" tabindex="-1"></a><span class="fu">summary</span>(M3_7)</span></code></pre></div>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## Sources ~ s(Depth)
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  16.7455     0.2847   58.83   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##            edf Ref.df   F p-value    
## s(Depth) 8.496  8.921 251  &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.681   Deviance explained = 68.4%
## GCV = 85.778  Scale est. = 85.001    n = 1049</code></pre>
<p>推定された回帰曲線(smoother)は以下のとおりである(図<a href="Chapter3.html#fig:fig-fit-M3-7">3.16</a>)。</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="Chapter3.html#cb152-1" tabindex="-1"></a>pred_M3_7 <span class="ot">&lt;-</span> <span class="fu">fitted_values</span>(M3_7, <span class="at">data =</span> nd) </span>
<span id="cb152-2"><a href="Chapter3.html#cb152-2" tabindex="-1"></a></span>
<span id="cb152-3"><a href="Chapter3.html#cb152-3" tabindex="-1"></a><span class="do">## 描画</span></span>
<span id="cb152-4"><a href="Chapter3.html#cb152-4" tabindex="-1"></a>pred_M3_7 <span class="sc">%&gt;%</span> </span>
<span id="cb152-5"><a href="Chapter3.html#cb152-5" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Depth, <span class="at">y =</span> fitted))<span class="sc">+</span></span>
<span id="cb152-6"><a href="Chapter3.html#cb152-6" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb152-7"><a href="Chapter3.html#cb152-7" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper),</span>
<span id="cb152-8"><a href="Chapter3.html#cb152-8" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb152-9"><a href="Chapter3.html#cb152-9" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb152-10"><a href="Chapter3.html#cb152-10" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> BL,</span>
<span id="cb152-11"><a href="Chapter3.html#cb152-11" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> Sources),</span>
<span id="cb152-12"><a href="Chapter3.html#cb152-12" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">color =</span> <span class="st">&quot;grey54&quot;</span>)<span class="sc">+</span></span>
<span id="cb152-13"><a href="Chapter3.html#cb152-13" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)<span class="sc">+</span></span>
<span id="cb152-14"><a href="Chapter3.html#cb152-14" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>,</span>
<span id="cb152-15"><a href="Chapter3.html#cb152-15" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb152-16"><a href="Chapter3.html#cb152-16" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>))<span class="sc">+</span></span>
<span id="cb152-17"><a href="Chapter3.html#cb152-17" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">120</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="fl">0.105</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb152-18"><a href="Chapter3.html#cb152-18" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Scaled depth&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Sources&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-fit-M3-7"></span>
<img src="Introduction-to-GAM-using-R_files/figure-html/fig-fit-M3-7-1.png" alt="Estimated smoother obtained by the gam function from the package mgcv for the bioluminescence data." width="432" />
<p class="caption">
図3.16: Estimated smoother obtained by the gam function from the package mgcv for the bioluminescence data.
</p>
</div>
<p><br/></p>
<p>それでは、<code>gam</code>関数では実際にどのような手順で推定が行われているのだろうか。まず、<code>s(Depth)</code>としたときに何が行われているのだろうか。関数<code>s()</code>の引数はいくつかあるが、そのうちデフォルトで与えられているのは以下の3つである。</p>
<p><code>k = -1, fx = FALSE, bs = "tp"</code></p>
<p><code>fx = FALSE</code>は、罰則付きの回帰スプラインが使われていることを表し、もし<code>fx = TRUE</code>ならば自由度を固定した回帰スプラインが行われる。<code>k</code>はsmootherの基底の次元を表し、<span class="math inline">\(k-1\)</span>がsmootherの自由度の上限になる。<code>k = -1</code>ではデフォルトの値が選ばれる。<code>bs</code>は使用されるsmootherが指定される。詳しい説明は<code>?smoother.terms</code>とすれば見ることができる。</p>
<p>つまり、引数を何も指定しないときは罰則付きの回帰スプラインが適用され、自由度は交差検証によって決定される。自由度を固定してGAMを実行するときは以下のようにすればよい。<code>k = 5</code>にするとsmootherの自由度は4になる。</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="Chapter3.html#cb153-1" tabindex="-1"></a>M2_8 <span class="ot">&lt;-</span> <span class="fu">gam</span>(Sources <span class="sc">~</span> <span class="fu">s</span>(Depth, <span class="at">fx =</span> <span class="cn">TRUE</span>, <span class="at">k =</span> <span class="dv">5</span>), <span class="at">data =</span> BL)</span></code></pre></div>
<p>使われるsmootherの種類による推定結果の違いは小さいが、データ数によっては種類を変えることで推定が効率的になったりする。デフォルトの<code>bs = "tp"</code>では<strong>薄板平滑化スプライン</strong>(thin plate regression spline)と呼ばれる方法が用いられる。この方法では交互作用項を含めた平滑化を行うことができるようだ(詳しくは<a href="https://qiita.com/saltcooky/items/d5a1a62756d10273b008">こちら</a>や<a href="chrome-extension://efaidnbmnnnibpcajpcglclefindmkaj/http://ibis.t.u-tokyo.ac.jp/suzuki/lecture/2015/dataanalysis/L12.pdf">こちら</a>)。</p>
<p><code>bs = "cr"</code>では、罰則付きの3次スプライン回帰が適用され、<code>bs = "cc"</code>では説明変数の両端のポイントが接続される場合(例えば月データの分析)に使える3次スプライン回帰である。</p>
<p>さて、最初のモデル(<code>M3_7</code>)の説明に戻ろう。モデルの予測値は<code>fitted()</code>関数で求めることができる。</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="Chapter3.html#cb154-1" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">fitted</span>(M3_7), <span class="at">n =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##  [1] 59.75170 56.23345 52.72462 49.93488 46.49023 43.12257 39.86806 36.76435
##  [9] 34.41493 31.67422</code></pre>
<p>パラメータ(回帰係数)の推定値は以下のように求められる。</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="Chapter3.html#cb156-1" tabindex="-1"></a><span class="fu">coef</span>(M3_7)</span></code></pre></div>
<pre><code>## (Intercept)  s(Depth).1  s(Depth).2  s(Depth).3  s(Depth).4  s(Depth).5 
##    16.74551   -46.31747   -56.49162   -34.94561   -43.55188   -38.29367 
##  s(Depth).6  s(Depth).7  s(Depth).8  s(Depth).9 
##    38.83802   -31.02217   -83.19786   -55.07702</code></pre>
<p><code>predict()</code>関数で<code>type = "lpmatrix"</code>とすると、モデルの説明変数を含む行列を得ることができる。</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="Chapter3.html#cb158-1" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">predict</span>(M3_7, <span class="at">type =</span> <span class="st">&quot;lpmatrix&quot;</span>)</span></code></pre></div>
<p>よって、モデルの予測値は以下のように求めることができる。</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="Chapter3.html#cb159-1" tabindex="-1"></a>mu <span class="ot">&lt;-</span> X <span class="sc">%*%</span> <span class="fu">coef</span>(M3_7)</span></code></pre></div>
<p>また、予測値の分散共分散行列は<span class="math inline">\(\mathbf{X} \times cov(\mathbf{\beta}) \times \mathbf{X^t}\)</span>で求めることができるので(第<a href="Chapter1.html#c1">1</a>章参照)、以下のように求められる、</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="Chapter3.html#cb160-1" tabindex="-1"></a>cov_mu <span class="ot">&lt;-</span> X <span class="sc">%*%</span> M3_7<span class="sc">$</span>Vp <span class="sc">%*%</span> <span class="fu">t</span>(X)</span></code></pre></div>
</div>
<div id="the-danger-of-using-gam" class="section level2 hasAnchor" number="3.16">
<h2><span class="header-section-number">3.16</span> The danger of using GAM<a href="Chapter3.html#the-danger-of-using-gam" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>これまで様々な方法でsmootherを推定してきたが、その多くではスケール化された水深が0.3から0.4のあたりで光源の数がわずかに増加していると推定された。しかし、これまではサンプリングを行ったステーションの影響は無視して分析を行ってきた(第<a href="Chapter3.html#s3-1">3.1</a>節も参照)。推定されたsmotherのパターンがこうした影響を受けていることはないだろうか。</p>
<p>まず、モデルの診断を行う。図<a href="Chapter3.html#fig:fig-diagnosis-M3-7">3.17</a>はモデルの予測値と残差の関係をプロットしたものである。明確なパターンがあり、等分散性の仮定が満たされていないことが分かる。</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="Chapter3.html#cb161-1" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">fit =</span> <span class="fu">fitted</span>(M3_7),</span>
<span id="cb161-2"><a href="Chapter3.html#cb161-2" tabindex="-1"></a>           <span class="at">resid =</span> <span class="fu">resid</span>(M3_7)) <span class="sc">%&gt;%</span> </span>
<span id="cb161-3"><a href="Chapter3.html#cb161-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fit, <span class="at">y =</span> resid))<span class="sc">+</span></span>
<span id="cb161-4"><a href="Chapter3.html#cb161-4" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb161-5"><a href="Chapter3.html#cb161-5" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>,</span>
<span id="cb161-6"><a href="Chapter3.html#cb161-6" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>)<span class="sc">+</span></span>
<span id="cb161-7"><a href="Chapter3.html#cb161-7" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb161-8"><a href="Chapter3.html#cb161-8" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb161-9"><a href="Chapter3.html#cb161-9" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Residuals&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Fitted values&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-diagnosis-M3-7"></span>
<img src="Introduction-to-GAM-using-R_files/figure-html/fig-diagnosis-M3-7-1.png" alt="Residuals  plotted   versus   fitted   values  for    the    GAM    using    only  depth as smoother." width="432" />
<p class="caption">
図3.17: Residuals plotted versus fitted values for the GAM using only depth as smoother.
</p>
</div>
<p><br/></p>
<p>図<a href="Chapter3.html#fig:fig-diagnosis-M3-7-b">3.18</a>は、ステーションごとの残差をプロットしたものである。ステーションごとにパターン(0以上が多い/0以下が多いなど)があることが分かる。</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="Chapter3.html#cb162-1" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">resid =</span> <span class="fu">resid</span>(M3_7),</span>
<span id="cb162-2"><a href="Chapter3.html#cb162-2" tabindex="-1"></a>           <span class="at">Station =</span> <span class="fu">as.factor</span>(BL<span class="sc">$</span>Station)) <span class="sc">%&gt;%</span> </span>
<span id="cb162-3"><a href="Chapter3.html#cb162-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Station, <span class="at">y =</span> resid))<span class="sc">+</span></span>
<span id="cb162-4"><a href="Chapter3.html#cb162-4" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()<span class="sc">+</span></span>
<span id="cb162-5"><a href="Chapter3.html#cb162-5" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>,</span>
<span id="cb162-6"><a href="Chapter3.html#cb162-6" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>)<span class="sc">+</span></span>
<span id="cb162-7"><a href="Chapter3.html#cb162-7" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb162-8"><a href="Chapter3.html#cb162-8" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb162-9"><a href="Chapter3.html#cb162-9" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Residuals&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-diagnosis-M3-7-b"></span>
<img src="Introduction-to-GAM-using-R_files/figure-html/fig-diagnosis-M3-7-b-1.png" alt="Residuals plotted versus station for the GAM using only depth as smoother." width="432" />
<p class="caption">
図3.18: Residuals plotted versus station for the GAM using only depth as smoother.
</p>
</div>
<p><br/></p>
<p>また、水深と残差の関係をステーションごとにプロットすると(図<a href="Chapter3.html#fig:fig-diagnosis-M3-7-c">3.19</a>)、ステーションごとに違う傾向があることが分かる。以上より、smootherとして<span class="math inline">\(f(Depth_i)\)</span>だけを考えることが適当ではないことが示唆された。</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="Chapter3.html#cb163-1" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">resid =</span> <span class="fu">resid</span>(M3_7),</span>
<span id="cb163-2"><a href="Chapter3.html#cb163-2" tabindex="-1"></a>           <span class="at">Station =</span> BL<span class="sc">$</span>Station,</span>
<span id="cb163-3"><a href="Chapter3.html#cb163-3" tabindex="-1"></a>           <span class="at">Depth =</span> BL<span class="sc">$</span>Depth) <span class="sc">%&gt;%</span> </span>
<span id="cb163-4"><a href="Chapter3.html#cb163-4" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Depth, <span class="at">y =</span> resid))<span class="sc">+</span></span>
<span id="cb163-5"><a href="Chapter3.html#cb163-5" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb163-6"><a href="Chapter3.html#cb163-6" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb163-7"><a href="Chapter3.html#cb163-7" tabindex="-1"></a>  <span class="fu">facet_rep_wrap</span>(<span class="sc">~</span>Station, <span class="at">repeat.tick.labels =</span> <span class="cn">TRUE</span>)<span class="sc">+</span></span>
<span id="cb163-8"><a href="Chapter3.html#cb163-8" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb163-9"><a href="Chapter3.html#cb163-9" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>,</span>
<span id="cb163-10"><a href="Chapter3.html#cb163-10" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb163-11"><a href="Chapter3.html#cb163-11" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>))<span class="sc">+</span></span>
<span id="cb163-12"><a href="Chapter3.html#cb163-12" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Residuals&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-diagnosis-M3-7-c"></span>
<img src="Introduction-to-GAM-using-R_files/figure-html/fig-diagnosis-M3-7-c-1.png" alt="Residuals plotted versus depth for each station for the GAM using only depth as smoother." width="960" />
<p class="caption">
図3.19: Residuals plotted versus depth for each station for the GAM using only depth as smoother.
</p>
</div>
<p><br/></p>
<p>この問題を解決する方法としては、各ステーションに異なるsmootherを適用することなどがあるが、数が多すぎる。他の方法としては、渦巻き(<code>Eddy</code>)の有無によってsmootherを変えるというものである。</p>
<p>図<a href="Chapter3.html#fig:fig-plot-by-eddy">3.20</a>は、渦巻きの有無ごとに水深と光源の数の関係を描いた図である。明らかに渦巻きの有無ごとに傾きが異なっていることが分かる。 　　</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="Chapter3.html#cb164-1" tabindex="-1"></a>BL <span class="sc">%&gt;%</span> </span>
<span id="cb164-2"><a href="Chapter3.html#cb164-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Station =</span> <span class="fu">as.factor</span>(Station)) <span class="sc">%&gt;%</span> </span>
<span id="cb164-3"><a href="Chapter3.html#cb164-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Depth, <span class="at">y =</span> Sources))<span class="sc">+</span></span>
<span id="cb164-4"><a href="Chapter3.html#cb164-4" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> Station))<span class="sc">+</span></span>
<span id="cb164-5"><a href="Chapter3.html#cb164-5" tabindex="-1"></a>  <span class="fu">facet_rep_wrap</span>(<span class="sc">~</span>Eddy)<span class="sc">+</span></span>
<span id="cb164-6"><a href="Chapter3.html#cb164-6" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb164-7"><a href="Chapter3.html#cb164-7" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>,</span>
<span id="cb164-8"><a href="Chapter3.html#cb164-8" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb164-9"><a href="Chapter3.html#cb164-9" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-plot-by-eddy"></span>
<img src="Introduction-to-GAM-using-R_files/figure-html/fig-plot-by-eddy-1.png" alt="Source s profiles plotted versus scaled depth for absence (left) and presence (right) of eddies. Each line corresponds to a station." width="960" />
<p class="caption">
図3.20: Source s profiles plotted versus scaled depth for absence (left) and presence (right) of eddies. Each line corresponds to a station.
</p>
</div>
<p><br/></p>
<p>そこで、以下の渦巻きの有無ごとにsmootherが異なるモデルを考える。なお,<span class="math inline">\(j = 1,2\)</span>で<span class="math inline">\(f_1(Depth_i)\)</span>は渦巻きがないときのsmootherである。<code>Station</code>は説明変数に入れた。</p>
<p><span class="math display">\[
\begin{aligned}
Sources_i &amp;= \alpha + f_j(Depth_i) + Station_i + \epsilon_i \\
\epsilon_i &amp;\sim N(0,\sigma^2)
\end{aligned}
\]</span></p>
<p>Rでは、第<a href="Chapter2.html#s2-6">2.6</a>節で見たように<code>by =</code>とすることで渦巻きの有無ごとのsmootherを推定できる。以下では、渦巻きの有無ごとにsmootherを推定する場合としない場合のモデルを作成する。</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="Chapter3.html#cb165-1" tabindex="-1"></a>M3_8 <span class="ot">&lt;-</span> <span class="fu">gam</span>(Sources <span class="sc">~</span> <span class="fu">s</span>(Depth) <span class="sc">+</span> <span class="fu">factor</span>(Station), <span class="at">data =</span> BL)</span>
<span id="cb165-2"><a href="Chapter3.html#cb165-2" tabindex="-1"></a>M3_9 <span class="ot">&lt;-</span>  <span class="fu">gam</span>(Sources <span class="sc">~</span> <span class="fu">s</span>(Depth, <span class="at">by =</span> <span class="fu">factor</span>(Eddy)) <span class="sc">+</span> <span class="fu">factor</span>(Station), <span class="at">data =</span> BL)</span></code></pre></div>
<p>AICを比較すると、渦巻きの有無ごとにsmootherを推定したモデルの方がよいモデルであることが分かる。</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="Chapter3.html#cb166-1" tabindex="-1"></a><span class="fu">AIC</span>(M3_8, M3_9)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["df"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["AIC"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"23.63606","2":"7219.884","_rn_":"M3_8"},{"1":"30.62869","2":"7081.822","_rn_":"M3_9"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>推定された渦巻きの有無ごとのsmootherを図示したのが図<a href="Chapter3.html#fig:fig-smoother-by-eddy">3.21</a>である。両者が異なるパターンを示していることが分かる。渦巻きがあり(<code>Eddy = 1</code>)のときに水深が深いところで95%信頼区間が狭くなっているのは、そのあたりのデータが少ないからである。</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="Chapter3.html#cb167-1" tabindex="-1"></a><span class="do">## M3_8</span></span>
<span id="cb167-2"><a href="Chapter3.html#cb167-2" tabindex="-1"></a><span class="fu">smooth_estimates</span>(M3_9) <span class="sc">%&gt;%</span> </span>
<span id="cb167-3"><a href="Chapter3.html#cb167-3" tabindex="-1"></a>  <span class="fu">add_confint</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb167-4"><a href="Chapter3.html#cb167-4" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Eddy =</span> <span class="dv">7</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb167-5"><a href="Chapter3.html#cb167-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Eddy =</span> <span class="fu">str_c</span>(<span class="st">&quot;Eddy = &quot;</span>, Eddy)) <span class="sc">%&gt;%</span> </span>
<span id="cb167-6"><a href="Chapter3.html#cb167-6" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Depth, <span class="at">y =</span> est))<span class="sc">+</span></span>
<span id="cb167-7"><a href="Chapter3.html#cb167-7" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(),</span>
<span id="cb167-8"><a href="Chapter3.html#cb167-8" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb167-9"><a href="Chapter3.html#cb167-9" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower_ci, <span class="at">ymax =</span> upper_ci),</span>
<span id="cb167-10"><a href="Chapter3.html#cb167-10" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="dv">0</span>,</span>
<span id="cb167-11"><a href="Chapter3.html#cb167-11" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb167-12"><a href="Chapter3.html#cb167-12" tabindex="-1"></a>              <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb167-13"><a href="Chapter3.html#cb167-13" tabindex="-1"></a>              <span class="at">linewidth =</span> <span class="fl">0.7</span>)<span class="sc">+</span></span>
<span id="cb167-14"><a href="Chapter3.html#cb167-14" tabindex="-1"></a>  <span class="fu">facet_rep_wrap</span>(<span class="sc">~</span>Eddy, <span class="at">repeat.tick.labels =</span> <span class="cn">TRUE</span>)<span class="sc">+</span></span>
<span id="cb167-15"><a href="Chapter3.html#cb167-15" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb167-16"><a href="Chapter3.html#cb167-16" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>,</span>
<span id="cb167-17"><a href="Chapter3.html#cb167-17" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb167-18"><a href="Chapter3.html#cb167-18" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-smoother-by-eddy"></span>
<img src="Introduction-to-GAM-using-R_files/figure-html/fig-smoother-by-eddy-1.png" alt="Estimated smoothers for depth for absence (left) and presence (right) of eddies." width="864" />
<p class="caption">
図3.21: Estimated smoothers for depth for absence (left) and presence (right) of eddies.
</p>
</div>
<p><br/></p>
<p>他の方法はランダム効果を用いる方法であるが、これについては別の本で解説を行っている<span class="citation">(<a href="#ref-Zuur2014">Zuur et al. 2014</a>)</span>。</p>
</div>
<div id="additive-models-with-multiple-smoothers" class="section level2 hasAnchor" number="3.17">
<h2><span class="header-section-number">3.17</span> Additive models with multiple smoothers<a href="Chapter3.html#additive-models-with-multiple-smoothers" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>これまでのモデルは、一つの変数のsmootherのみを用いていた。これを二つ以上の変数のsmootherに拡張するのはシンプルである。</p>
<p>ここでは、蛍光物質(クロロフィル)の量(mg/L)(<code>flcugl</code>)のsmootherも加えたモデルを考える。
<span class="math display">\[
\begin{aligned}
Sources_i &amp;= \alpha + f_1(Depth_i) + f_2(flcugl_i) +  Station_i + \epsilon_i \\
\epsilon_i &amp;\sim N(0,\sigma^2)
\end{aligned}
\]</span></p>
<p>図<a href="Chapter3.html#fig:fig-datacheck">3.22</a>は<code>Depth</code>と<code>flcugl</code>、<code>flcugl</code>と<code>Sources</code>の関係をプロットしたものである。<code>flcugl</code>には一つだけ外れ値があるので、以後の分析ではこれは除く。</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="Chapter3.html#cb168-1" tabindex="-1"></a>BL <span class="sc">%&gt;%</span> </span>
<span id="cb168-2"><a href="Chapter3.html#cb168-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Depth, <span class="at">y =</span> flcugl))<span class="sc">+</span></span>
<span id="cb168-3"><a href="Chapter3.html#cb168-3" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>)<span class="sc">+</span></span>
<span id="cb168-4"><a href="Chapter3.html#cb168-4" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb168-5"><a href="Chapter3.html#cb168-5" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>) <span class="ot">-&gt;</span> p1</span>
<span id="cb168-6"><a href="Chapter3.html#cb168-6" tabindex="-1"></a></span>
<span id="cb168-7"><a href="Chapter3.html#cb168-7" tabindex="-1"></a>BL <span class="sc">%&gt;%</span> </span>
<span id="cb168-8"><a href="Chapter3.html#cb168-8" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span>flcugl, <span class="at">y =</span> Sources))<span class="sc">+</span></span>
<span id="cb168-9"><a href="Chapter3.html#cb168-9" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>)<span class="sc">+</span></span>
<span id="cb168-10"><a href="Chapter3.html#cb168-10" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb168-11"><a href="Chapter3.html#cb168-11" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>) <span class="ot">-&gt;</span> p2</span>
<span id="cb168-12"><a href="Chapter3.html#cb168-12" tabindex="-1"></a></span>
<span id="cb168-13"><a href="Chapter3.html#cb168-13" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-datacheck"></span>
<img src="Introduction-to-GAM-using-R_files/figure-html/fig-datacheck-1.png" alt="Scatterplot of flcugl versus depth (left) and sources versus flcugl (right)." width="864" />
<p class="caption">
図3.22: Scatterplot of flcugl versus depth (left) and sources versus flcugl (right).
</p>
</div>
<p><br/></p>
<p>これまでと同様に、それぞれのsmootherは以下のように書ける。それぞれのsmootherについてノットの数と位置を決定する必要があるが、これは同じでも違くてもよい。また、それぞれのsmootherについて基底(<span class="math inline">\(b_{1j}(Depth_i),b_{2j}(flcugl_i)\)</span>)を決める必要がある。例えば、<span class="math inline">\(Depth\)</span>については線形スプライン回帰を適用するが、<span class="math inline">\(flcugl\)</span>については3次平滑化スプラインを適用する、ということもできる。<br />
<span class="math display">\[
\begin{aligned}
f_1(Depth_i) &amp;= \sum_{j =1}^K \beta_{1j} \times b_{1j}(Depth_i)\\
f_2(flcugl_i) &amp;= \sum_{j =1}^K \beta_{2j} \times b_{2j}(flcugl_i)\\
\end{aligned}
\]</span></p>
<p>モデル全体の切片<span class="math inline">\(\alpha\)</span>があるので、各smootherの切片は除いて0の周りで周辺化する。各smootherのパラメータ<span class="math inline">\(\lambda_1, \lambda_2\)</span>は交差検証によって決定され、自由度もそれに基づいて別々に計算される。</p>
<p>Rでは以下のように実行する。ここでは、両方のsmootherに3次平滑化スプラインを用いる。</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="Chapter3.html#cb169-1" tabindex="-1"></a>BL2 <span class="ot">&lt;-</span> BL <span class="sc">%&gt;%</span> <span class="fu">filter</span>(flcugl <span class="sc">&lt;</span> <span class="fl">0.03</span>)</span>
<span id="cb169-2"><a href="Chapter3.html#cb169-2" tabindex="-1"></a></span>
<span id="cb169-3"><a href="Chapter3.html#cb169-3" tabindex="-1"></a>M3_10 <span class="ot">&lt;-</span> <span class="fu">gam</span>(Sources <span class="sc">~</span> <span class="fu">s</span>(Depth, <span class="at">bs =</span> <span class="st">&quot;cr&quot;</span>) <span class="sc">+</span> <span class="fu">s</span>(flcugl, <span class="at">bs =</span> <span class="st">&quot;cr&quot;</span>) <span class="sc">+</span> <span class="fu">factor</span>(Station),</span>
<span id="cb169-4"><a href="Chapter3.html#cb169-4" tabindex="-1"></a>             <span class="at">data =</span> BL2)</span></code></pre></div>
<p>推定された各smootherは以下の通り(図<a href="Chapter3.html#fig:fig-multsmoother">3.23</a>)。<code>flcugl</code>のsmootherはゆっくり増加したのち、急激に減少していることが分かる。<code>Depth</code>の方はほとんど変わらない。</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="Chapter3.html#cb170-1" tabindex="-1"></a><span class="fu">draw</span>(M3_10)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-multsmoother"></span>
<img src="Introduction-to-GAM-using-R_files/figure-html/fig-multsmoother-1.png" alt="Estimated cubic smoothing splines for Depth and fclugl." width="864" />
<p class="caption">
図3.23: Estimated cubic smoothing splines for Depth and fclugl.
</p>
</div>
<p>モデルの要約は以下の通り。いずれのsmootherも有意であるが、このモデルでは渦巻きの有無の効果を無視している。<code>flcugl</code>の効果も渦巻きの有無によって異なるかもしれない。</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="Chapter3.html#cb171-1" tabindex="-1"></a><span class="fu">summary</span>(M3_10)</span></code></pre></div>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## Sources ~ s(Depth, bs = &quot;cr&quot;) + s(flcugl, bs = &quot;cr&quot;) + factor(Station)
## 
## Parametric coefficients:
##                   Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)        22.8401     0.8599  26.562  &lt; 2e-16 ***
## factor(Station)53  -2.9374     1.6827  -1.746 0.081177 .  
## factor(Station)54  -7.8883     1.1299  -6.981 5.27e-12 ***
## factor(Station)56   7.3880     1.3155   5.616 2.52e-08 ***
## factor(Station)58  -0.6668     1.1631  -0.573 0.566615    
## factor(Station)60   2.8120     1.6417   1.713 0.087039 .  
## factor(Station)62  -5.2367     1.3584  -3.855 0.000123 ***
## factor(Station)64  -7.1549     1.1269  -6.349 3.25e-10 ***
## factor(Station)66 -10.3260     1.1471  -9.002  &lt; 2e-16 ***
## factor(Station)68 -11.1717     1.2177  -9.175  &lt; 2e-16 ***
## factor(Station)70  -6.7784     1.2997  -5.216 2.22e-07 ***
## factor(Station)72 -11.4385     1.1723  -9.757  &lt; 2e-16 ***
## factor(Station)74 -10.2104     1.1278  -9.053  &lt; 2e-16 ***
## factor(Station)76 -13.6073     1.5054  -9.039  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##             edf Ref.df       F  p-value    
## s(Depth)  8.567  8.937 214.603  &lt; 2e-16 ***
## s(flcugl) 5.338  6.529   5.856 3.45e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.791   Deviance explained = 79.7%
## GCV = 57.163  Scale est. = 55.641    n = 1048</code></pre>
<p>そこで、以下の7つのモデルを作成してAICによるモデル比較を行う。交互作用を考慮する2次元のsmootherがあるモデル(<code>M3_11_h</code>と<code>M3_11_i</code>)については第<a href="#c6"><strong>??</strong></a>章で触れる。</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="Chapter3.html#cb173-1" tabindex="-1"></a><span class="do">## Depthのみ、Eddyによる違いなし</span></span>
<span id="cb173-2"><a href="Chapter3.html#cb173-2" tabindex="-1"></a>M3_11_a <span class="ot">&lt;-</span> <span class="fu">gam</span>(Sources <span class="sc">~</span> <span class="fu">s</span>(Depth, <span class="at">bs =</span> <span class="st">&quot;cr&quot;</span>) <span class="sc">+</span> <span class="fu">factor</span>(Station), <span class="at">data =</span> BL2)</span>
<span id="cb173-3"><a href="Chapter3.html#cb173-3" tabindex="-1"></a></span>
<span id="cb173-4"><a href="Chapter3.html#cb173-4" tabindex="-1"></a><span class="do">## flcuglのみ、Eddyによる違いなし</span></span>
<span id="cb173-5"><a href="Chapter3.html#cb173-5" tabindex="-1"></a>M3_11_b <span class="ot">&lt;-</span> <span class="fu">gam</span>(Sources <span class="sc">~</span> <span class="fu">s</span>(flcugl, <span class="at">bs =</span> <span class="st">&quot;cr&quot;</span>) <span class="sc">+</span> <span class="fu">factor</span>(Station), <span class="at">data =</span> BL2)</span>
<span id="cb173-6"><a href="Chapter3.html#cb173-6" tabindex="-1"></a></span>
<span id="cb173-7"><a href="Chapter3.html#cb173-7" tabindex="-1"></a><span class="do">## Depthとflcugl。DepthのみEddyによる違いあり  </span></span>
<span id="cb173-8"><a href="Chapter3.html#cb173-8" tabindex="-1"></a>M3_11_c <span class="ot">&lt;-</span> <span class="fu">gam</span>(Sources <span class="sc">~</span> <span class="fu">s</span>(Depth, <span class="at">bs =</span> <span class="st">&quot;cr&quot;</span>, <span class="at">by =</span> <span class="fu">factor</span>(Eddy)) <span class="sc">+</span></span>
<span id="cb173-9"><a href="Chapter3.html#cb173-9" tabindex="-1"></a>                 <span class="fu">s</span>(flcugl, <span class="at">bs =</span> <span class="st">&quot;cr&quot;</span>) <span class="sc">+</span> <span class="fu">factor</span>(Station), <span class="at">data =</span> BL2)</span>
<span id="cb173-10"><a href="Chapter3.html#cb173-10" tabindex="-1"></a></span>
<span id="cb173-11"><a href="Chapter3.html#cb173-11" tabindex="-1"></a><span class="do">## Depthとflcugl。flcuglのみEddyによる違いあり  </span></span>
<span id="cb173-12"><a href="Chapter3.html#cb173-12" tabindex="-1"></a>M3_11_d <span class="ot">&lt;-</span> <span class="fu">gam</span>(Sources <span class="sc">~</span> <span class="fu">s</span>(Depth, <span class="at">bs =</span> <span class="st">&quot;cr&quot;</span>) <span class="sc">+</span></span>
<span id="cb173-13"><a href="Chapter3.html#cb173-13" tabindex="-1"></a>                 <span class="fu">s</span>(flcugl, <span class="at">bs =</span> <span class="st">&quot;cr&quot;</span>, <span class="at">by =</span> <span class="fu">factor</span>(Eddy)) <span class="sc">+</span> <span class="fu">factor</span>(Station), <span class="at">data =</span> BL2)</span>
<span id="cb173-14"><a href="Chapter3.html#cb173-14" tabindex="-1"></a></span>
<span id="cb173-15"><a href="Chapter3.html#cb173-15" tabindex="-1"></a><span class="do">## Depthとflcugl、両方がEddyによって異なる  </span></span>
<span id="cb173-16"><a href="Chapter3.html#cb173-16" tabindex="-1"></a>M3_11_e <span class="ot">&lt;-</span> <span class="fu">gam</span>(Sources <span class="sc">~</span> <span class="fu">s</span>(Depth, <span class="at">bs =</span> <span class="st">&quot;cr&quot;</span>, <span class="at">by =</span> <span class="fu">factor</span>(Eddy)) <span class="sc">+</span></span>
<span id="cb173-17"><a href="Chapter3.html#cb173-17" tabindex="-1"></a>                 <span class="fu">s</span>(flcugl, <span class="at">bs =</span> <span class="st">&quot;cr&quot;</span>, <span class="at">by =</span> <span class="fu">factor</span>(Eddy)) <span class="sc">+</span> <span class="fu">factor</span>(Station), <span class="at">data =</span> BL2)</span>
<span id="cb173-18"><a href="Chapter3.html#cb173-18" tabindex="-1"></a></span>
<span id="cb173-19"><a href="Chapter3.html#cb173-19" tabindex="-1"></a><span class="do">## DepthのみでEddyによって異なる。flcuglは普通の説明変数として入れる。  </span></span>
<span id="cb173-20"><a href="Chapter3.html#cb173-20" tabindex="-1"></a>M3_11_f <span class="ot">&lt;-</span> <span class="fu">gam</span>(Sources <span class="sc">~</span> <span class="fu">s</span>(Depth, <span class="at">bs =</span> <span class="st">&quot;cr&quot;</span>, <span class="at">by =</span> <span class="fu">factor</span>(Eddy)) <span class="sc">+</span> flcugl <span class="sc">+</span> <span class="fu">factor</span>(Station),</span>
<span id="cb173-21"><a href="Chapter3.html#cb173-21" tabindex="-1"></a>               <span class="at">data =</span> BL2)</span>
<span id="cb173-22"><a href="Chapter3.html#cb173-22" tabindex="-1"></a></span>
<span id="cb173-23"><a href="Chapter3.html#cb173-23" tabindex="-1"></a><span class="do">## DepthのみでEddyによって異なる。flcuglとEddyの交互作用を入れる。 </span></span>
<span id="cb173-24"><a href="Chapter3.html#cb173-24" tabindex="-1"></a>M3_11_g <span class="ot">&lt;-</span> <span class="fu">gam</span>(Sources <span class="sc">~</span> <span class="fu">s</span>(Depth, <span class="at">bs =</span> <span class="st">&quot;cr&quot;</span>, <span class="at">by =</span> <span class="fu">factor</span>(Eddy)) <span class="sc">+</span> flcugl<span class="sc">*</span><span class="fu">factor</span>(Eddy) <span class="sc">+</span></span>
<span id="cb173-25"><a href="Chapter3.html#cb173-25" tabindex="-1"></a>                 <span class="fu">factor</span>(Station), <span class="at">data =</span> BL2)</span>
<span id="cb173-26"><a href="Chapter3.html#cb173-26" tabindex="-1"></a></span>
<span id="cb173-27"><a href="Chapter3.html#cb173-27" tabindex="-1"></a><span class="do">## Depthとflcuglの交互作用を考える。Eddyによる傾きの違いなし。    </span></span>
<span id="cb173-28"><a href="Chapter3.html#cb173-28" tabindex="-1"></a>M3_11_h <span class="ot">&lt;-</span> <span class="fu">gam</span>(Sources <span class="sc">~</span> <span class="fu">te</span>(Depth, flcugl) <span class="sc">+</span> <span class="fu">factor</span>(Station), <span class="at">data =</span> BL2)</span>
<span id="cb173-29"><a href="Chapter3.html#cb173-29" tabindex="-1"></a></span>
<span id="cb173-30"><a href="Chapter3.html#cb173-30" tabindex="-1"></a><span class="do">## Depthとflcuglの交互作用を考える。Eddyによる傾きの違いあり。 </span></span>
<span id="cb173-31"><a href="Chapter3.html#cb173-31" tabindex="-1"></a>M3_11_i <span class="ot">&lt;-</span> <span class="fu">gam</span>(Sources <span class="sc">~</span> <span class="fu">te</span>(Depth, flcugl,  <span class="at">by =</span> <span class="fu">factor</span>(Eddy)) </span>
<span id="cb173-32"><a href="Chapter3.html#cb173-32" tabindex="-1"></a>               <span class="sc">+</span> <span class="fu">factor</span>(Station), <span class="at">data =</span> BL2)</span></code></pre></div>
<p>モデル比較の結果、どちらのsmootherも渦巻きの有無によって異なる<code>M3_11_e</code>が最も良いよう。</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="Chapter3.html#cb174-1" tabindex="-1"></a><span class="fu">AIC</span>(M3_10, M3_11_a, M3_11_b,M3_11_c,M3_11_d,M3_11_e,M3_11_f,M3_11_g,M3_11_h,M3_11_i) <span class="sc">%&gt;%</span> </span>
<span id="cb174-2"><a href="Chapter3.html#cb174-2" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb174-3"><a href="Chapter3.html#cb174-3" tabindex="-1"></a>  <span class="fu">arrange</span>(AIC)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["df"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["AIC"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"39.58972","2":"7128.686","_rn_":"M3_11_e"},{"1":"34.15194","2":"7139.508","_rn_":"M3_11_c"},{"1":"30.76981","2":"7144.689","_rn_":"M3_11_f"},{"1":"31.76623","2":"7146.688","_rn_":"M3_11_g"},{"1":"32.75932","2":"7189.901","_rn_":"M3_11_d"},{"1":"28.90505","2":"7215.444","_rn_":"M3_10"},{"1":"23.44499","2":"7248.547","_rn_":"M3_11_a"},{"1":"47.11579","2":"7314.772","_rn_":"M3_11_i"},{"1":"37.16531","2":"7436.562","_rn_":"M3_11_h"},{"1":"20.02307","2":"8305.927","_rn_":"M3_11_b"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><code>M3_11_e</code>のsmootherを図示すると以下のようになる(図<a href="Chapter3.html#fig:fig-multsmoother2">3.24</a>)。</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="Chapter3.html#cb175-1" tabindex="-1"></a><span class="fu">smooth_estimates</span>(M3_11_e) <span class="sc">%&gt;%</span> </span>
<span id="cb175-2"><a href="Chapter3.html#cb175-2" tabindex="-1"></a>  <span class="fu">add_confint</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb175-3"><a href="Chapter3.html#cb175-3" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(Depth, flcugl)) <span class="sc">%&gt;%</span> </span>
<span id="cb175-4"><a href="Chapter3.html#cb175-4" tabindex="-1"></a>  <span class="fu">drop_na</span>(value) <span class="sc">%&gt;%</span> </span>
<span id="cb175-5"><a href="Chapter3.html#cb175-5" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Eddy =</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb175-6"><a href="Chapter3.html#cb175-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Eddy =</span> <span class="fu">str_c</span>(<span class="st">&quot;Eddy = &quot;</span>, Eddy)) <span class="sc">%&gt;%</span> </span>
<span id="cb175-7"><a href="Chapter3.html#cb175-7" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> est))<span class="sc">+</span></span>
<span id="cb175-8"><a href="Chapter3.html#cb175-8" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb175-9"><a href="Chapter3.html#cb175-9" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower_ci, <span class="at">ymax =</span> upper_ci),</span>
<span id="cb175-10"><a href="Chapter3.html#cb175-10" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;grey29&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.9</span>,</span>
<span id="cb175-11"><a href="Chapter3.html#cb175-11" tabindex="-1"></a>              <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span></span>
<span id="cb175-12"><a href="Chapter3.html#cb175-12" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;x&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span>)<span class="sc">+</span></span>
<span id="cb175-13"><a href="Chapter3.html#cb175-13" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb175-14"><a href="Chapter3.html#cb175-14" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb175-15"><a href="Chapter3.html#cb175-15" tabindex="-1"></a>  <span class="fu">facet_rep_grid</span>(Eddy<span class="sc">~</span>name, <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>,</span>
<span id="cb175-16"><a href="Chapter3.html#cb175-16" tabindex="-1"></a>                 <span class="at">repeat.tick.labels =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-multsmoother2"></span>
<img src="Introduction-to-GAM-using-R_files/figure-html/fig-multsmoother2-1.png" alt="Estimated smoothers for mM3_11_e." width="960" />
<p class="caption">
図3.24: Estimated smoothers for mM3_11_e.
</p>
</div>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Heger2008" class="csl-entry">
Heger A, Ieno EN, King NJ, et al (2008) Deep-sea pelagic bioluminescence over the <span>Mid-Atlantic</span> ridge. Deep Sea Res Part 2 Top Stud Oceanogr 55:126–136
</div>
<div id="ref-Wood2017" class="csl-entry">
Wood SN (2017) Generalized additive models: An introduction with r, second edition. CRC Press
</div>
<div id="ref-Zuur2009" class="csl-entry">
Zuur AF (2009) Mixed effects models and extensions in ecology with <span>R</span>. Springer, New York, NY
</div>
<div id="ref-Zuur2014" class="csl-entry">
Zuur AF, Saveliev AA, Ieno EN (2014) A beginner’s guide to generalised additive mixed models with <span>R</span>. Highland Statistics, Newburgh, Scotland
</div>
</div>
<div class="footnotes">
<hr />
<ol start="3">
<li id="fn3"><p>AICは簡単に言えばより予測の良い(≠ 当てはまりが良い)モデルを選ぶための基準で、低いほど良い。<a href="Chapter3.html#fnref3" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="Chapter2.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="sessioninfo.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
